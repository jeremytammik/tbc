<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:at="http://www.sixapart.com/ns/at" xmlns:fb="http://www.facebook.com/2008/fbml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Edit Post - The Building Coder | TypePad</title>
    <meta name="viewport" content="width=1000" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="stylesheet" href="http://static.typepad.com/.shared:va84928f:typepad:en_us/css/app/global/reset.css?/css/app/global/core.css,/css/app/global/app.css" type="text/css" />
    <link rel="stylesheet" href="http://static.typepad.com/.shared:va84928f:typepad:en_us/css/app/modules/chrome.css?/css/app/modules/contacts.css,/css/app/modules/contentnav.css,/css/app/modules/messages.css,/css/app/modules/settings.css,/css/app/modules/lists.css,/css/app/modules/flyouts.css,/css/app/modules/editor.css,/css/app/modules/buttons.css,/css/app/modules/related.css,/css/app/modules/quickadd.css,/css/app/modules/tableselect.css,/css/app/modules/thumbselect.css,/css/app/modules/upsells.css,/css/app/modules/boxes.css,/css/app/modules/compose.css" type="text/css" />
    <link rel="stylesheet" href="http://static.typepad.com/.shared:va84928f:typepad:en_us/css/flyout-types.css" type="text/css" />
    <link rel="stylesheet" href="http://static.typepad.com/.shared:va84928f:typepad:en_us/yui/2.9.0/container/assets/container-core.css" type="text/css" />
    <link rel="stylesheet" href="http://static.typepad.com/.shared:va84928f:typepad:en_us/yui/2.9.0/calendar/assets/calendar-core.css" type="text/css" />
    <link rel="stylesheet" href="http://static.typepad.com/.shared:va84928f:typepad:en_us/yui/2.9.0/container/assets/skins/tp2/container-skin.css" type="text/css" />
    <link rel="stylesheet" href="http://static.typepad.com/.shared:va84928f:typepad:en_us/yui/2.9.0/calendar/assets/skins/tp2/calendar-skin.css" type="text/css" />
    <link rel="stylesheet" href="http://static.typepad.com/.shared:va84928f:typepad:en_us/yui/2.9.0/colorpicker/assets/skins/tp2/colorpicker-skin.css" type="text/css" />
<!--[if IE]>
    <link rel="stylesheet" href="http://static.typepad.com/.shared:va84928f:typepad:en_us/css/app/browsers/ie.css" type="text/css" />
<![endif]-->
    <link rel="shortcut icon" href="http://www.typepad.com/favicon.ico" />
    <link rel="apple-touch-icon-precomposed" href="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/app/favicons/atip-129si.png" />
    <script type="text/javascript" src="http://static.typepad.com/.shared:va84928f:typepad:en_us/yui/2.9.0/yahoo-dom-event/yahoo-dom-event.js?/yui/2.9.0/element/element-min.js,/yui/2.9.0/connection/connection-min.js,/yui/2.9.0/json/json-min.js,/yui/2.9.0/container/container-min.js,/yui/2.9.0/calendar/calendar-min.js,/yui/2.9.0/dragdrop/dragdrop-min.js,/yui/2.9.0/slider/slider-min.js,/yui/2.9.0/colorpicker/colorpicker-min.js,/yui/2.9.0/event-simulate/event-simulate-min.js,/yui/2.9.0/get/get-min.js,/js/tc-min.js,/js/tc/tableselect-min.js,/js/tc/jsonrpc-client-min.js,/js/common/dirty-min.js,/js/common/list-min.js,/js/common/dialog-min.js,/js/common/tools-min.js,/js/common/settings-min.js,/js/common/colorpicker-min.js,/js/app/editor-textarea-formatting-min.js,/js/json-min.js,/js/jquery/jquery-1.4.2.min.js,/js/common/apiproxy-min.js,/js/tc.js,/js/tc/jsonrpc-client.js,/js/app/flyouts-min.js,/js/app/profile-flyouts-min.js"></script>
</head>
<body class="yui-skin-tp2  display-notags display-noexcerpt display-nokeywords display-nosticky_post display-nofilename display-nopublicize display-bottom">


<script type="text/javascript">
    if( !TPApp ) { var TPApp = {}; };
    TPApp.app_uri = "http://www.typepad.com/";
</script>

<div id="main">    <div id="nav">
        <div id="nav-inner" class="pkg">
            <div class="nav-group-left nav-group pkg">
                <div class="nav-item-home nav-item-first nav-item">
                    <a id="navtypepad" href="http://www.typepad.com/dashboard" class="nav-link">
                        <span class="nav-border">
                            <span class="nav-button">
                                <img src="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/app/global/nav-logo.png" alt="TypePad" width="80" height="16" />
                            </span>
                        </span>
                    </a>
                </div>
                <div class="nav-item-dashboard nav-item">
                    <a id="navdashboard" href="http://www.typepad.com/dashboard" class="nav-link">
                        <span class="nav-border">
                            <span class="nav-button">
                                Dashboard
                            </span>
                        </span>
                    </a>
                </div>
                <div class="nav-item-blogs nav-item-yah nav-item">
                    <div>
                        <a id="navblogs" class="flyout-init-global-user-blogs flyout-init nav-link" href="#">
                            <span class="nav-border">
                                <span class="nav-button">
                                    <span class="nav-arrow">
                                        Blogs
                                    </span>
                                </span>
                            </span>
                        </a>
                    </div>
                    <div class="nav-menu">
                        <div class="nav-menu-inner">
                            <div class="nav-menu-group-first nav-menu-group">
                                <div class="nav-menu-group-header">TypePad Blogs</div>
                                <div class="nav-menu-group-content">
                                    <div class="nav-menu-item-typepad nav-menu-item-yah nav-menu-item">
                                        <a id="navblogs-1" href="http://www.typepad.com/site/blogs/6a00e553e16897883300e553fcc7418834/dashboard" class="nav-menu-link">
                                            <span class="nav-menu-label">
                                                The Building Coder
                                            </span>
                                        </a>
                                    </div>
                                    <div class="nav-menu-item-typepad nav-menu-item">
                                        <a id="navblogs-2" href="http://www.typepad.com/site/blogs/6a0167607c2431970b0168e5d2171f970c/dashboard" class="nav-menu-link">
                                            <span class="nav-menu-label">
                                                AEC DevBlog
                                            </span>
                                        </a>
                                    </div>
                                    <div class="nav-menu-item-typepad nav-menu-item">
                                        <a id="navblogs-3" href="http://www.typepad.com/site/blogs/6a0167607c2431970b0168ebc3adf1970c/dashboard" class="nav-menu-link">
                                            <span class="nav-menu-label">
                                                Cloud and Mobile
                                            </span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="nav-menu-group-last nav-menu-group">
                                <div class="nav-menu-group-content">
                                    <div class="nav-menu-item-add nav-menu-item">
                                        <a id="navaddblog" href="http://www.typepad.com/site/blogs" class="nav-menu-link">
                                            <span class="nav-menu-label">
                                                Add a blog
                                            </span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="nav-item-library nav-item-last nav-item">
                    <div>
                        <a id="navlibrary" class="flyout-init-global-user-library flyout-init nav-link" href="#">
                            <span class="nav-border">
                                <span class="nav-button">
                                    <span class="nav-arrow">
                                        Library
                                    </span>
                                </span>
                            </span>
                        </a>
                    </div>
                    <div class="nav-menu">
                        <div class="nav-menu-inner">
                            <div class="nav-menu-group-first nav-menu-group-last nav-menu-group">
                                <div class="nav-menu-group-content">
                                    <div class="nav-menu-item-albums nav-menu-item">
                                        <a id="navphotoalbums" href="http://www.typepad.com/site/albums" class="nav-menu-link">
                                            <span class="nav-menu-label">
                                                Photo Albums
                                            </span>
                                        </a>
                                    </div>
                                    <div class="nav-menu-item-lists nav-menu-item">
                                        <a id="navtypelists" href="http://www.typepad.com/site/lists" class="nav-menu-link">
                                            <span class="nav-menu-label">
                                                TypeLists
                                            </span>
                                        </a>
                                    </div>
                                    <div class="nav-menu-item-files nav-menu-item">
                                        <a id="navfilemanager" href="http://www.typepad.com/account/files" class="nav-menu-link">
                                            <span class="nav-menu-label">
                                                File Manager
                                            </span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="nav-group-right nav-group pkg">
                <div class="nav-item-profile nav-item-first nav-item">
                    <a id="navprofile" href="http://profile.typepad.com/jeremytammik" class="nav-link">
                        <span class="nav-border">
                            <span class="nav-button-avatar nav-button">
                                <img src="http://up7.typepad.com/6a00e553e1689788330120a50f97f6970b-50si" alt="Jeremy Tammik" width="16" height="16" />
                                Jeremy Tammik
                            </span>
                        </span>
                    </a>
                </div>
                <div class="nav-item-account nav-item">
                    <a id="navaccount" href="http://www.typepad.com/account" class="nav-link">
                        <span class="nav-border">
                            <span class="nav-button">
                                Account
                            </span>
                        </span>
                    </a>
                </div>
                <div class="nav-item-help nav-item">
                    <a id="navhelp" href="http://www.typepad.com/account/help" class="nav-link">
                        <span class="nav-border">
                            <span class="nav-button">
                                Help
                            </span>
                        </span>
                    </a>
                </div>
                <div class="nav-item-signout nav-item-last nav-item">
                    <a id="navsignout" href="http://www.typepad.com/services/signout" class="nav-link">
                        <span class="nav-border">
                            <span class="nav-button">
                                Sign Out
                            </span>
                        </span>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div id="header">
        <div id="header-inner" class="pkg">
            <div class="blog-name">
                <h2><a href="http://www.typepad.com/site/blogs/6a00e553e16897883300e553fcc7418834/dashboard">The Building Coder</a></h2>
            </div>
            <div class="blog-nav nav">
                <ul>
                    <li id="blog-nav-compose-menu" class="blog-nav-compose-menubutton blog-nav-compose nav-item">
                        <div>
                            <a href="http://www.typepad.com/site/blogs/6a00e553e16897883300e553fcc7418834/post/compose">
                                <span class="compose-button">Compose</span>
                            </a>
                            <a class="flyout-init-blog-compose flyout-init" href="#">
                                <span class="compose-menu"><img src="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/app/global/arrow-brown-on-yellow.png" alt="Show compose menu" width="9" height="7" /></span>
                            </a>
                        </div>
                        <div class="menu">
                            <ul>
                                <li class="menu-first"><a href="http://www.typepad.com/site/blogs/6a00e553e16897883300e553fcc7418834/post/compose"><span class="menu-label">New Post</span></a></li>
                                <li class="menu-last"><a href="http://www.typepad.com/site/blogs/6a00e553e16897883300e553fcc7418834/page/compose"><span class="menu-label">New Page</span></a></li>
                            </ul>
                        </div>
                    </li>
                    <li class="nav-item"><a href="http://www.typepad.com/site/blogs/6a00e553e16897883300e553fcc7418834/dashboard">Overview</a></li>
                    <li class="nav-item"><a href="http://www.typepad.com/site/blogs/6a00e553e16897883300e553fcc7418834/posts">Posts</a></li>
                    <li class="nav-item"><a href="http://www.typepad.com/site/blogs/6a00e553e16897883300e553fcc7418834/comments">Comments</a></li>
                    <li class="nav-item"><a href="http://www.typepad.com/site/blogs/6a00e553e16897883300e553fcc7418834/design">Design</a></li>
                    <li class="nav-item"><a href="http://www.typepad.com/site/blogs/6a00e553e16897883300e553fcc7418834/configure">Settings</a></li>
                </ul>
            </div>
            <div class="external-nav"><a href="http://thebuildingcoder.typepad.com/blog/" target="_blank">View blog</a></div>
        </div>
    </div>

    <div id="content">
        <div id="content-inner">
<div class="inapp-message message">
    <div class="message-content">
        <p><strong>Making edits?</strong> Check out the <em>List Posts</em> and <em>List Pages</em> links above the editor to quickly see your content.</p>
    </div>
    <div class="message-close">
        <a id="message-close" href="#" title="Close" at:message-area="blog-compose" at:message-date="2013-02-21T19:46:15"><img src="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/weblog/design/content/remove.png" alt="Close" width="14" height="14" /></a>
    </div>
</div>
<script type="text/javascript">
var client = new TC.JSONRPCClient( 'http://www.typepad.com/services/json-rpc' );
var close = YAHOO.util.Dom.get( 'message-close' );

YAHOO.util.Event.on( close, 'click', function( ev ) {
    YAHOO.util.Event.stopEvent( ev );
    close.parentNode.parentNode.className = 'hidden';
    client.request( {
        method: 'System.Messaging.Dismiss',
        params: {
            date: close.getAttribute( 'at:message-date' ),
            area: close.getAttribute( 'at:message-area' )
        },
        callback: function( r ) {
            if( r.error )
                alert( r.error );
        }
    } );
} );
</script>



<!-- need to override content-inner for compose only to 1100px, accommodating ads/iframe.tt adcall in right hand column -->
<style>
#content-inner {
    width: 1100px;
}
#header-inner {
    width: 1100px;
}
#nav-inner {
    width: 1120px;
}
#nav .nav-group-right {
    margin-right: 90px;
}
#header .external-nav {
    margin-right: 90px;
}
#image-hover {
    background: #000;
}
</style>




<script type="text/javascript" src="http://static.typepad.com/.shared:va84928f:typepad:en_us/tiny_mce/3.3.9.4/tiny_mce.js"></script>

<script type="text/javascript">
TP_UseAviary = true;
</script>


<script type="text/javascript">
  function textCounter(field,maxlimit) {
      var cntfield = $(field).siblings(".tweet-counter");
      cntfield.val(maxlimit - $(field).val().length);
  }
  function rmvSpc(element, isTwitter) {
      element.value=element.value.replace(/\s+/g, " ");
      if( (element.value == '' || element.value == ' ') && isTwitter ){
         element.value="Enter a Tweet. If left blank, we'll use the Title of your post."; element.style.color='#AAA';
      } else if( (element.value == '' || element.value == ' ') && !isTwitter ){
         element.value="Enter a short message about your blog post to get people excited to come read it."; element.style.color='#AAA';
      }
  }
  function pubTextFoc(txtr, isTwitter) {
      if ( isTwitter ) {
          if ( txtr.value == "Enter a Tweet. If left blank, we'll use the Title of your post." ) {
              txtr.value=''; txtr.style.color='black'; txtr.onclick=null;
          }
      } else {
          if ( txtr.value == "Enter a short message about your blog post to get people excited to come read it." ) {
              txtr.value=''; txtr.style.color='black'; txtr.onclick=null;
          }
      }
  }
  function showTxtArea(elem, account) {
      if(account == 'Facebook') {
          if ( $(elem).attr("checked") ) {
              var pubText = $(elem).siblings(".publicize-text-Facebook");
              if ( pubText.val() == "Enter a short message about your blog post to get people excited to come read it." ) {
                  pubText.css('color',"#AAA");
              }
              pubText.show();
          } else {
              $(elem).siblings(".publicize-text-Facebook").hide();
          }
      } else if(account == 'Twitter'){
          if ( $(elem).attr("checked") ) {
              var pubText = $(elem).siblings(".publicize-text-Twitter");
              if ( $("#name").val() != "" ) {
                  pubText.text($("#name").val());
                  pubText.css('color','black');
                  pubText.show();
                  $(elem).siblings(".caption-text").show();
                  $(elem).siblings(".tweet-counter").show();
              } else {
                  pubText.show();
                  pubText.css('color','#AAA');
                  $(elem).siblings(".caption-text").show();
                  $(elem).siblings(".tweet-counter").show();
              }
          } else {
              $(elem).siblings(".publicize-text-Twitter").hide();
              $(elem).siblings(".caption-text").hide();
              $(elem).siblings(".tweet-counter").hide();
          }
      }
  }

  $(document).ready(function(){
      $.each($(".publicize-acct"), function(index, item) {
           if ( $(item).attr("checked") ) {
               if ( $(item).siblings(".publicize-text-Twitter").length  > 0 ) {
                   $(item).siblings(".publicize-text-Twitter").css("color","#AAA");
                   $(item).siblings(".publicize-text-Twitter").show();
                   $(item).siblings(".caption-text").show();
                   $(item).siblings(".tweet-counter").show();
               } else {
                   $(item).siblings(".publicize-text-Facebook").css("color","#AAA");
                   $(item).siblings(".publicize-text-Facebook").show();
               }
          }
      });

});

</script>

<script type="text/javascript">
    window.ZemantaAuthCode = "f309bda339a9221112c27c93738251762b35d70fa87392efb232974e12189bfb";
    window.ZemantaDate = "2013-05-29-22-39-43";
    window.ZemantaTypePadBlogID = "6a00e553e16897883300e553fcc7418834";
    window.ZemantaBlogSettings = "";
    
    window.ZemantaPostSettings =  "";
    
    window.ZemantaEmail = "jeremy.tammik@autodesk.com";
    window.ZemantaBlogUrl = "http://thebuildingcoder.typepad.com/blog/";
    window.ZemantaGetAPIKey = function () { return "hjd3pzxkvimkb8ufkd35xq36"; }
</script>
<script id="zemanta-loader" type="text/javascript" src="http://fstatic.zemanta.com/plugins/typepad.com/loader.js"></script>
<script type="text/javascript">
function log(msg) {
    window.console && window.console.log && console.log(msg);
}

if ( !window.SixApart )
    window.SixApart = { widget: {}, util: {}, data: { local: {} }, loc: null };

SixApart.loc = function( strObj ) {
    if ( typeof(strObj) == 'string' )
        return SixApart.data.local[ strObj ] || ( '__' + strObj + '__' );
    else {
        for ( key in strObj )
            if ( YAHOO.util.Lang.hasOwnProperty( strObj, key ) )
                SixApart.data.local[ key ] = strObj[ key ];
    }
};

window.atp_editor = {
    insertHTML: function( html ) {
        var ed = tinyMCE.activeEditor;
        if ( ed.isHidden() ) {
            window.htmlToolbar.setSelection( html );
        } else {
            ed.execCommand( 'mceInsertContent', false, html );
        }
    },
    insertImageHTML: function( html, args ) {
        atp_editor.insertHTML( html );
    },
    cancelInsertImage: function() {},
    getHTML: function() {
        var ed = tinyMCE.get( 'body' ),
            ta = YAHOO.util.Dom.get( 'body' );
        if ( ed.isHidden() ) {
            return ta.value;
        } else {
            return ed.getContent();
        }
    },
    setHTML: function( html ) {
        var ed = tinyMCE.activeEditor;
        if ( ed.isHidden() ) {
            window.htmlToolbar.setSelection( html );
        } else {
            ed.execCommand( 'mceSetContent', false, html );
        }
    },
    saveHTML: function() {
        var ed = tinyMCE.get( 'body' );

        if( ed ) {
            /* Only trigger a save (move editor contents to textarea) if
               the editor is not hidden. */
            if ( !ed.isHidden() ) {
                tinymce.triggerSave();
            }

            /* Always turn off the dirty flag. */
            ed.isNotDirty = 1;
        }
    },
    setSourceMode: function( mode ) {
        var ed = tinyMCE.get( 'body' ),
            ta = YAHOO.util.Dom.get( 'body' ),
            toolbar = window.htmlToolbar;

        if ( mode == 'on' ) {
            if ( ed && !ed.isHidden() ) {
                ta.style.height = ed.getContentAreaContainer().offsetHeight + 24 + 'px';
                ta.style.width = ed.getContentAreaContainer().offsetWidth + 'px';
                ed.hide();
            }

            if ( toolbar && toolbar.isHidden() )
                toolbar.show();

            YAHOO.util.Dom.addClass( 'lite-switch-container', 'hidden' );
        } else {
            if ( ed && ed.isHidden() )
                ed.show();

            if ( toolbar && !toolbar.isHidden() )
                toolbar.hide();

            YAHOO.util.Dom.removeClass( 'lite-switch-container', 'hidden' );
        }
    }
};
</script>

<script type="text/javascript">
var client = new TC.JSONRPCClient( 'http://www.typepad.com/services/json-rpc' );

SixApart.loc( {
    TOOLBAR_INSERT_PAGE_BREAK: 'Split Extended Entry',
    TOOLBAR_SPELLCHECK: 'Check Spelling',
    TOOLBAR_INSERT_FILE: 'Insert File',
    TOOLBAR_INSERT_VIDEO: 'Insert a Video',
    TOOLBAR_INSERT_AUDIO: 'Insert Audio',
    TOOLBAR_INSERT_EMOTICON: 'Insert Emoticon',
    TOOLBAR_EMOTICON_NOTE: 'For continuous input, Shift + Click.',
    TOOLBAR_STRIKETHROUGH: 'Strikethrough',
    TOOLBAR_GROUP_PLUGINS: 'Plugins',
    TOOLBAR_FULLSCREEN: 'Full Screen',
    CREATE_LINK_URL: 'Link URL',
    CREATELINK_DIALOG_LINK_NEW_WINDOW: 'Open in a new window.',
    CREATELINK_DIALOG_LINK_TEXT: 'Link Text',
    CREATELINK_DIALOG_OK_BUTTON: 'OK',
    CREATELINK_DIALOG_REMOVE_BUTTON: 'Remove',
    CREATELINK_DIALOG_LINK_TITLE: 'Description',
    DOMPATH_EDITING_HTML_SOURCE: 'Editing HTML Source',
    SPELLCHECK_NO_SUGGESTIONS: 'No Suggestions',
    SPELLCHECK_SUGGESTIONS: 'Spelling Suggestions',
    SPELLCHECK_SKIP_WORD: 'Skip',
    SPELLCHECK_WAIT: 'Spell Checking, Please wait...',
    SPELLCHECK_CANCEL_BUTTON: 'Cancel',
    IMAGE_COPY: '<span class="tip"><span class="icon icon-info"></span><strong>Note:</strong>To move this image just highlight it, cut, and paste where ever you\'d like.</span>',
    IMAGE_HERE: 'Image Url Here',
    IMAGE_ORIG_SIZE: 'Original Size',
    IMAGE_PROP_TITLE: 'Image Options',
    IMAGE_SIZE_LABEL: 'Size',
    IMAGE_SIZE_FULL: 'Full',
    IMAGE_SIZE_LARGE: 'Large',
    IMAGE_SIZE_MEDIUM: 'Medium',
    IMAGE_SIZE_SMALL: 'Small',
    IMAGE_SIZE_TEXT: 'Text',
    IMAGE_SIZE_CUSTOM: 'Custom',
    IMAGE_TEXTFLOW_LABEL: 'Text Flow',
    IMAGE_TEXTFLOW_NONE: 'None',
    IMAGE_TEXTFLOW_INLINE: 'Inline',
    IMAGE_TEXTFLOW_BLOCK: 'Block',
    IMAGE_TEXTFLOW_CENTER: 'Center',
    IMAGE_TEXTFLOW_LEFT: 'Left',
    IMAGE_TEXTFLOW_RIGHT: 'Right',
    IMAGE_BORDER_LABEL: 'Border',
    IMAGE_BORDER_SIZE: 'Border Size',
    IMAGE_BORDER_TYPE: 'Border Type',
    IMAGE_BORDER_COLOR: 'Border Color',
    IMAGE_PADDING_LABEL: 'Padding',
    IMAGE_TITLE: 'Description',
    IMAGE_URL: 'Image Url',
    LINK_NEW_WINDOW: 'Open in a new window.',
    LINK_PROP_TITLE: 'Link Options',
    LOCAL_FILE_WARNING: '<span class="tip"><span class="icon icon-warn"></span><strong>Note:</strong>This image/link points to a file on your computer and will not be accessible to others on the internet.</span>',
    NONE: 'none',
    AUTOSAVE_SAVING: 'Auto-saving...'
} );

YAHOO.util.Event.on( window, 'load', function() {

    tinyMCE.init({
        width: '648',
        height: '255',

        // General options
        mode : "specific_textareas",
        editor_selector : "tp-editor",
        theme : "advanced",
        skin : "typepad",
        language: "6a",
        apply_source_formatting : true,
        remove_linebreaks : false,
        forced_root_block : false,

        onpageload : function() {
            //can also access like this: tinyMCE.i18n['6a.spellchecker.desc']
        
            tinyMCE.addI18n('6a.spellchecker',{
                desc:"Check Spelling",
                menu:"Spellchecker settings",
                ignore_word:"Ignore word",
                ignore_words:"Ignore all",
                langs:"Languages",
                wait:"Please wait...",
                sug:"Suggestions",
                no_sug:"No suggestions",
                no_mpell:"No misspellings found."
            });
        
        
            tinyMCE.addI18n('6a.pagebreak',{
                desc: "Split Extended Entry"
            });
            tinyMCE.addI18n('6a.fullscreen',{
                desc: "Full Screen"
            });
            tinyMCE.addI18n('6a.autosave',{
                restore_content: "Restore Auto-Save Content",
                unload_msg:"The changes you made will be lost if you navigate away from this page.",
                warning_message:"If you restore the saved content, you will lose all the content that is currently in the editor.\\n\\nAre you sure you want to restore the saved content?."
            });
            tinyMCE.addI18n('6a',{
                more_colors:"More colors"
            });
            tinyMCE.addI18n('6a.advanced',{
                forecolor_desc:"Font Color",
                backcolor_desc:"Background Color",
                bold_desc:"Bold (Ctrl+B)",
                italic_desc:"Italic (Ctrl+I)",
                underline_desc:"Underline (Ctrl+U)",
                striketrough_desc:"Strikethrough",
                justifyleft_desc:"Align Left",
                justifycenter_desc:"Align Center",
                justifyright_desc:"Align Right",
                justifyfull_desc:"Align Full",
                bullist_desc:"Unordered List",
                numlist_desc:"Ordered List",
                outdent_desc:"Outdent",
                indent_desc:"Indent",
                undo_desc:"Undo (Ctrl+Z)",
                redo_desc:"Redo (Ctrl+Y)",
                sub_desc:"Subscript",
                sup_desc:"Superscript",
                hr_desc:"Insert Horizontal Ruler",
                blockquote_desc:"Blockquote",
                font_size:"Font size",
                fontdefault:"Font family",
                block:"Formatting",
                removeformat_desc:"Remove Formatting"
            });
            //typepad plugin
            tinyMCE.addI18n('6a.typepad', {
                tp_link: "Insert Link",
                tp_image: "Insert Image",
                tp_audio: "Insert Audio",
                tp_video: "Insert Video",
                tp_file: "Insert File"
            });
        },
        plugins : "autosave,fullscreen,pagebreak,paste,typepad,wordcount,media,spellchecker",
        theme_advanced_resize_horizontal : false,

        oninit: function() {
            ed = tinyMCE.get( 'body' );
            log("oninit: ");
            log(ed);

//             ed.dom.bind(ed.dom.getRoot(), 'dragend', function(e) {
//                 log('DRAGEND?');
//             });
/*
            We turn off drag for images in wrapper divs
            */
//             ed.onInit.add(function(editor) {
//                 log('add dragstart');
//                 tinymce.dom.Event.add(editor.getBody(), "dragstart", function(ev) {
//                     log('dragstart!');
//                     log(editor.dom.getParent(ev.target, "div.photo-wrap"));
//                     if (!tinymce.isGecko && ev.target.nodeName == "IMG" && editor.dom.getParent(ev.target, "div.photo-wrap")) {
//                         return tinymce.dom.Event.cancel(f)
//                     }
//                 })
//             });

            window.htmlToolbar = new typepad.TextareaFormatting( ed, 'body-formatting-toolbar' );


            /* If we're not in rich text mode on initial load of the editor,
               save the contents of the textarea and reinitialize after
               we init/hide the editor. Otherwise we'll go through a roundtrip
               with the editor, which changes the formatting of the HTML. */
            var current_format = getCurrentFormat();
            if ( current_format.sourceMode ) {
                var contents = YAHOO.util.Dom.get( 'body' ).value;
            }

            doSelectEditorMode();

            if ( current_format.sourceMode ) {
                YAHOO.util.Dom.get( 'body' ).value = contents;
            }
        },

        // Neutralize the window popup within the editor
        init_instance_callback: function (t) {
            var script = t.dom.create('script', { type: 'text/javascript' });
            script.text = 'window.open = function() {};';
            t.dom.select('head')[0].appendChild(script);
        },

        // Theme options
        theme_advanced_buttons1 : "bold,italic,underline,|,justifyleft,justifycenter,justifyright,justifyfull,|,blockquote,bullist,numlist,|,tp_link,tp_image,tp_video,tp_audio,tp_file,|,pagebreak,spellchecker,restoredraft,fullscreen",
        theme_advanced_buttons2 : "formatselect,fontselect,fontsizeselect,|,indent,outdent,|,sub,sup,|,forecolor,backcolor,|,removeformat,strikethrough",
        theme_advanced_buttons3 : "",
        theme_advanced_buttons4 : "",
        theme_advanced_toolbar_location : "top",
        theme_advanced_toolbar_align : "left",
        theme_advanced_statusbar_location : "bottom",
        theme_advanced_resizing : true,
        theme_advanced_path : false,
        theme_advanced_font_sizes: "8pt,10pt,11pt,12pt,13pt,14pt,15pt,18pt,20pt,24pt,36pt",
        theme_advanced_blockformats: "Header 1=h1,Header 2=h2,Header 3=h3,Header 4=h4,Header 5=h5,Header 6=h6",
        // "More colors" is A) broken due to unsafe domain mismatch, and B)
        // not currently localizable under our scheme.
        theme_advanced_more_colors: false,
                theme_advanced_text_colors: "111111,2D2D2D,434343,5B5B5B,737373,8B8B8B,A2A2A2,B9B9B9,BFBF00,FFFF00,FFFF40,FFFF80,FFFFBF,525330,898A49,AEA945,60BF00,80FF00,A0FF40,C0FF80,DFFFBF,3B5738,668F5A,7F9757,00BF00,00FF80,40FFA0,80FFC0,BFFFDF,033D21,438059,7FA37C,00BFBF,00FFFF,40FFFF,80FFFF,BFFFFF,033D3D,347D7E,609A9F,0060BF,0080FF,40A0FF,80C0FF,BFDFFF,1B2C48,385376,57708F,0000BF,0000FF,4040FF,8080FF,BFBFFF,212143,373E68,444F75,6000BF,8000FF,A040FF,C080FF,DFBFFF,302449,54466F,655A7F,BF00BF,FF00FF,FF40FF,FF80FF,FFBFFF,4A234A,794A72,936386,BF005F,FF007F,FF409F,FF80BF,FFBFDF,451528,823857,A94A76,C00000,FF0000,FF4040,FF8080,FFC0C0,441415,82393C,AA4D4E,BF5F00,FF7F00,FF9F40,FFBF80,FFDFBF,482C1B,855A40,B27C51,000000,D0D0D0,E6E6E6,FFFFFF,7F7F00,C3BE71,E0DCAA,FCFAE1,407F00,8A9B55,B7C296,E6EBD5,007F40,8DAE94,ACC6B5,DDEBE2,007F7F,96BDC4,B5D1D7,E2F1F4,00407F,7792AC,A8BED1,DEEBF6,00007F,585E82,8687A4,D2D1E1,40007F,726284,9E8FA9,DCD1DF,7F007F,9D7292,C0A0B6,ECDAE5,7F003F,BC6F95,D8A5BB,F7DDE9,800000,BC6E6E,D8A3A4,F8DDDD,7F3F00,C49B71,E1C4A8,FDEEE0",
        
                theme_advanced_background_colors: "111111,2D2D2D,434343,5B5B5B,737373,8B8B8B,A2A2A2,B9B9B9,BFBF00,FFFF00,FFFF40,FFFF80,FFFFBF,525330,898A49,AEA945,60BF00,80FF00,A0FF40,C0FF80,DFFFBF,3B5738,668F5A,7F9757,00BF00,00FF80,40FFA0,80FFC0,BFFFDF,033D21,438059,7FA37C,00BFBF,00FFFF,40FFFF,80FFFF,BFFFFF,033D3D,347D7E,609A9F,0060BF,0080FF,40A0FF,80C0FF,BFDFFF,1B2C48,385376,57708F,0000BF,0000FF,4040FF,8080FF,BFBFFF,212143,373E68,444F75,6000BF,8000FF,A040FF,C080FF,DFBFFF,302449,54466F,655A7F,BF00BF,FF00FF,FF40FF,FF80FF,FFBFFF,4A234A,794A72,936386,BF005F,FF007F,FF409F,FF80BF,FFBFDF,451528,823857,A94A76,C00000,FF0000,FF4040,FF8080,FFC0C0,441415,82393C,AA4D4E,BF5F00,FF7F00,FF9F40,FFBF80,FFDFBF,482C1B,855A40,B27C51,000000,D0D0D0,E6E6E6,FFFFFF,7F7F00,C3BE71,E0DCAA,FCFAE1,407F00,8A9B55,B7C296,E6EBD5,007F40,8DAE94,ACC6B5,DDEBE2,007F7F,96BDC4,B5D1D7,E2F1F4,00407F,7792AC,A8BED1,DEEBF6,00007F,585E82,8687A4,D2D1E1,40007F,726284,9E8FA9,DCD1DF,7F007F,9D7292,C0A0B6,ECDAE5,7F003F,BC6F95,D8A5BB,F7DDE9,800000,BC6E6E,D8A3A4,F8DDDD,7F3F00,C49B71,E1C4A8,FDEEE0",
        
        

        /* Clean up Word and other formatting when pasting text. */
        paste_auto_cleanup_on_paste : true,
        paste_remote_styles: true,
        paste_remove_spans: true,
        paste_strip_class_attributes: 'all',

        spellchecker_rpc_url: 'http://www.typepad.com/services/spelling',

        autosave_interval: '15s',

        pagebreak_separator: '<hr class="at-page-break" />',

        content_css: 'http://www.typepad.com/site/blogs/6a00e553e16897883300e553fcc7418834/compose_content_css',

        /* Don't override the submit handler for our form; we'll handle
           it ourselves in atp_editor.saveHTML. */
        submit_patch: false,

        /* Don't convert URLs to relative to the current script host. */
        convert_urls: false,
        relative_urls: false,

        /* Only convert the following characters to named entities. */
        entities: '38,amp,60,lt,62,gt,160,nbsp',
        entity_encoding: 'named',

        /* Keep the tp:largeuri and tp:fulluri attributes used by
           the thumbnail gallery.
           Also, keep the iframe and its attributes as we do in the old editor. */
        extended_valid_elements: '-li[class|tp::largeuri|tp::fulluri],iframe[*]',

        setup: function(ed) {
            /* Hooking on the tab key to insert 4 spaces instead of focusing on the next element. */
            ed.onKeyDown.add(function(ed, ev) {
                if (ev.keyCode != 9) return;
                atp_editor.insertHTML("&nbsp;&nbsp;&nbsp;&nbsp;");
                tinymce.dom.Event.cancel(ev);
            });

            /* Removing p tags with no content to avoid being added unexpected new lines. Case 98786 */
            ed.onBeforeSetContent.add(function(ed, o) {
                o.content = o.content.replace(/<p>\s*<\/p>/gi, '');
            });

            ed.onBeforeExecCommand.add(function(ed, cmd, ui, val, o) {
                if ( hooksBeforeExecCommand[ cmd ] )
                    hooksBeforeExecCommand[ cmd ]( ed, cmd, ui, val, o );
            });

            var hooksBeforeExecCommand = {
                /*
                 * Overriding ForeColor command to put color style on an anchor tag
                 * rather than wrapping the one by <span style="color: #..."> which
                 * is mostly unexpected behavior.
                 *
                 * This part is only for the case that a user selects a whole text inside an anchor tag.
                 * So, if a content inside of an anchor tag doesn't match the one that a user actually selects,
                 * then return immediately and let the original method handle the rest.
                 *
                 * Note: Changing color doesn't get reflected in the editor form with Firefox. But it's working.
                 */
                'ForeColor' : function( ed, cmd, ui, val, o ) {
                    var sel = ed.selection;
                    var elm = sel.getNode();

                    if (elm && elm.nodeName.toUpperCase() == 'A') {
                        if (tinymce.isIE) {
                            if (elm.innerHTML != sel.getRng().text) return;
                        } else {
                            if (elm.innerHTML != sel.getRng().toString()) return;
                        }

                        // toggle style
                        var cur = ed.dom.getStyle(elm, 'color');
                        if (cur) cur = ed.dom.toHex(cur);
                        if (val.toUpperCase() == cur.toUpperCase()) val = undefined;

                        ed.dom.setStyle(elm, 'color', val);
                        o.terminate = true; // telling the caller to stop processing
                    }
                },

                'mcePageBreak' : function( ed, cmd, ui, val, o ) {
                    return; // disable it for now
                    var badElements = new RegExp("^(blockquote|form|table)$", "i");

                    var node;
                    tinymce.DOM.getParents( ed.selection.getNode(), function( elm ) {
                        if ( elm.nodeName.match( badElements ) )
                            node = elm;
                    } );

                    if ( node ) {
                        // Moving cursor to the end of a proper node.
                        ed.selection.select( tinymce.DOM.getParent( node ) );
                        ed.selection.collapse( false );

                        alert( 'A pagebreak will be inserted into where it should be.' );
                    }
                }
            };
        }
    });
} );

function validateFilenameField( f ) {
    f.filename.value = YAHOO.lang.trim( f.filename.value );
    if( f.filename.value.length > 255 ) {
        alert( 'The filename of your post cannot exceed 255 characters.' );
        return false;
    }
    
    if( f.filename.value.length == 0 ) {
        alert( 'You must enter a permalink for your post.' );
        return false;
    }
    if( !TC.Tools.isValidAlias( f.filename.value ) ) {
        alert( 'The filename of your post must be comprised of letters and/or numbers. (Hyphens and underscores are also allowed.)' );
        return false;
    }
    return true;
}

function doSetTimestamp( epoch, text, visible ) {
    var epoch_node = YAHOO.util.Dom.get( 'issued-epoch' );
    var text_node = YAHOO.util.Dom.get( 'issued-text' );
    var timestamp_node = YAHOO.util.Dom.get( 'timestamp' );
    var preview_epoch_node = YAHOO.util.Dom.get( 'preview-issued-epoch' );

    if( !epoch_node || !text_node || !timestamp_node || !preview_epoch_node )
        return;

    epoch_node.value = epoch;
    preview_epoch_node.value = epoch;
    text_node.innerHTML = text;

    if( visible ) {
        YAHOO.util.Dom.removeClass( timestamp_node, 'hidden' );
    } else {
        YAHOO.util.Dom.addClass( timestamp_node, 'hidden' );
    }

    doSetPermalinkDate( epoch );
}

function doSetPermalinkDate( epoch ) {
    var year = YAHOO.util.Dom.get( 'permalink-year' );
    var month = YAHOO.util.Dom.get( 'permalink-month' );

    if( !year || !month )
        return;

    var dt = new Date();
    if( epoch )
        dt.setTime( epoch * 1000 );
    var dt_year = dt.getFullYear().toString();
    var dt_month = ( dt.getMonth() + 1 ).toString();
    if( dt_month.length < 2 )
        dt_month = '0' + dt_month;

    year.innerHTML = dt_year;
    month.innerHTML = dt_month;
}

var dt = new Date();
dt.setTime( 1369904400000 );
var original_issued_epoch = '1369904400';
var original_issued_text = dt.toLocaleString();


YAHOO.util.Event.on( ['technorati-ta', 'keywords-ta', 'summary'], 'keydown', function( ev ) {
    setDirty();
} );
YAHOO.util.Event.on( ['allow-comments-1', 'allow-comments-2', 'allow-comments-3', 'allow-trackbacks-1', 'allow-trackbacks-2'], 'change', function( ev ) {
    setDirty();
} );

YAHOO.util.Event.on( 'add-category', 'click', function( ev ) {
    YAHOO.util.Event.stopEvent( ev );
    TC.dialogs.categoryCreator.show();
    setDirty();
} );

function confirmDelete( msg ) {
    msg = msg || 'This change can NOT be undone. Delete?';
    return confirm( msg );
}

var dirty = false;
YAHOO.util.Event.on( window, 'beforeunload', function( ev ) {
    return checkDirty( ev, 'You have unsaved changes to your post that will be lost.' );
} );

function toggleStickyStatus( status ) {
    var f = YAHOO.util.Dom.get( 'sticky-field' );
    var c = YAHOO.util.Dom.get( 'sticky_post' );
    var b = YAHOO.util.Dom.get( 'sticky_post-backup' );

    switch( status ) {
        case 'enable':
            c.disabled = false;
            c.checked = b.value == 1 ? true : false;
            YAHOO.util.Dom.removeClass( f, 'field-disabled' );
            break;
        case 'disable':
            b.value = c.checked ? 1 : 0;
            c.disabled = true;
            c.checked = false;
            YAHOO.util.Dom.addClass( f, 'field-disabled' );
            break;
    }

    return true;
}



function doSelectPostingStatus( f ) {
    var status = f.options[ f.selectedIndex ].value;
    var is_new = 0;
    var is_draft = 0;
    var is_future = 1;
    var is_post = 1;

    var dt = new Date();
    var now_issued_epoch = dt.getTime() / 1000;
    var now_issued_text = dt.toLocaleString();

    switch( status ) {
        case 'publish':
            if( is_new || is_draft )
                doSetTimestamp( '', '', false );
            else if( is_future )
                doSetTimestamp( now_issued_epoch, now_issued_text, false );
            else
                doSetTimestamp( original_issued_epoch, original_issued_text, true );
            if( is_post ) {
                toggleStickyStatus( 'enable' );

                TC.settings.toggle( 'enable', 'publicize', { restore: 'checkbox-list' } );
                for( var i = defaultAccounts.length; i--; ) {
                    var el = document.getElementById( 'publicize-' + defaultAccounts[ i ] );
                    if ( el )
                        el.checked = true;
                }
            }

            updateSubmitButtonLabel( 'Publish' );
            break;
        case 'draft':
            if( is_new )
                doSetTimestamp( '', '', false );
            else
                doSetTimestamp( original_issued_epoch, original_issued_text, true );
            if( is_post ) {
                toggleStickyStatus( 'disable' );
                TC.settings.toggle( 'disable', 'publicize', { restore: 'checkbox-list' } );
            }

            updateSubmitButtonLabel( 'Save' );
            break;
        case 'future':
            doOpenSchedule();
            if( is_post ) {
                toggleStickyStatus( 'enable' );

                TC.settings.toggle( 'enable', 'publicize', { restore: 'checkbox-list' } );
                for( var i = defaultAccounts.length; i--; ) {
                    var el = document.getElementById( 'publicize-' + defaultAccounts[ i ] );
                    if ( el )
                        el.checked = true;
                }
            }

            updateSubmitButtonLabel( 'Schedule' );
            break;
    }

    return true;
}

function updateSubmitButtonLabel( label ) {
    var submit_buttons = YAHOO.util.Dom.getElementsByClassName( 'save-entry', 'a', 'entry-form' );
    for( var i = 0; i < submit_buttons.length; i++ ) {
        submit_buttons[ i ].innerHTML = label;
    }
}

function max_textarea( limitField, limitNum ) {
    if( limitField.value.length > limitNum ) {
        limitField.value = limitField.value.substring( 0, limitNum );
    }
}

var custom_filename = false;

function updatePermalinkFilename( str ) {
    var field = YAHOO.util.Dom.get( 'filename' );
    var preview = YAHOO.util.Dom.get( 'permalink-text-preview' );

    if( custom_filename || !field || !preview )
        return;

    var dirified_str = TC.Tools.dirify( str ).substr( 0, 100 );

    if( str )
        preview.innerHTML = dirified_str + '.html';
    else
        preview.innerHTML = '...';

    field.value = dirified_str;
}

function updatePermalinkPreview( str ) {
    var preview = YAHOO.util.Dom.get( 'permalink-text-preview' );

    if( !preview )
        return;

    if( str ) {
        preview.innerHTML = str + '.html';
    } else {
        preview.innerHTML = '...';
        custom_filename = false;
    }
}

function savePermalinkFilename( str ) {
    var form = YAHOO.util.Dom.get( 'entry-form' );
    var preview = YAHOO.util.Dom.get( 'permalink-text-preview' );
    var field = YAHOO.util.Dom.get( 'permalink-text-field' );
    var edit = YAHOO.util.Dom.get( 'edit-permalink' );
    var save = YAHOO.util.Dom.get( 'save-permalink' );
    var filename = YAHOO.util.Dom.get( 'filename' );

    if( !form || !preview || !field || !edit || !save || !filename )
        return;

    if( validateFilenameField( form ) ) {
        YAHOO.util.Dom.addClass( field, 'hidden' );
        YAHOO.util.Dom.addClass( save, 'hidden' );
        YAHOO.util.Dom.removeClass( preview, 'hidden' );
        YAHOO.util.Dom.removeClass( edit, 'hidden' );

        updatePermalinkPreview( str );
    }
    setDirty();
}

YAHOO.util.Event.on( 'edit-permalink', 'click', function( ev ) {
    YAHOO.util.Event.stopEvent( ev );

    var answer = confirm( 'Changing the permalink of an existing post can have a negative effect on your traffic and stats. Are you sure you want to change your permalink?' );
    if( !answer )
        return;

    var preview = YAHOO.util.Dom.get( 'permalink-text-preview' );
    var field = YAHOO.util.Dom.get( 'permalink-text-field' );
    var edit = YAHOO.util.Dom.get( 'edit-permalink' );
    var save = YAHOO.util.Dom.get( 'save-permalink' );
    var filename = YAHOO.util.Dom.get( 'filename' );

    if( !preview || !field || !edit || !save || !filename )
        return;

    YAHOO.util.Dom.addClass( preview, 'hidden' );
    YAHOO.util.Dom.addClass( edit, 'hidden' );
    YAHOO.util.Dom.removeClass( field, 'hidden' );
    YAHOO.util.Dom.removeClass( save, 'hidden' );

    filename.focus();
    custom_filename = true;
} );

YAHOO.util.Event.on( 'save-permalink', 'click', function( ev ) {
    YAHOO.util.Event.stopEvent( ev );
    savePermalinkFilename( this.value );
} );

YAHOO.util.Event.on( 'filename', 'blur', function( ev ) {
    savePermalinkFilename( this.value );
} );

YAHOO.util.Event.on( 'filename', 'keydown', function( ev ) {
    if( ev.keyCode != 13 || ev.which != 13 )
        return;

    YAHOO.util.Event.stopEvent( ev );
    savePermalinkFilename( this.value );
} );


/*YAHOO.util.Event.on( 'body', 'change', function( ev ) {
    setDirty();
} );
*/

YAHOO.util.Event.on( 'keywords', 'keyup', function( ev ) {
    max_textarea( this, 32000 );
} );

YAHOO.util.Event.on( 'status', 'change', function( ev ) {
    doSelectPostingStatus( this );
    setDirty();
} );

YAHOO.util.Event.on( 'issued-link', 'click', function( ev ) {
    YAHOO.util.Event.stopEvent( ev );
    doOpenSchedule();
} );

YAHOO.util.Event.on( 'sticky_post', 'click', function( ev ) {
    var w = YAHOO.util.Dom.get( 'sticky_post-warning' );
    var backup = YAHOO.util.Dom.get( 'sticky_post-backup' );
    backup.value = this.checked ? 1 : 0;

    if( this.checked )
        YAHOO.util.Dom.removeClass( w, 'hidden' );
    else
        YAHOO.util.Dom.addClass( w, 'hidden' );

    setDirty();

    return true;
} );

YAHOO.util.Event.on( 'ping_urls', 'keyup', function( ev ) {
    max_textarea( this, 32000 );
    setDirty();
} );

function saveEntry() {
    atp_editor.saveHTML();
}

function updateEntry(html) {
   atp_editor.setHTML(html);
}

function process_base64_images (postform) {
    var postContent = atp_editor.getHTML();

    var pattern = /data:image\/(gif|png|jpeg);base64,([\w=\+\/]+)/gi;
    var images =  postContent.match(pattern);

    //if there is no base64 encoded images, save the contents and publish the post.
    if (!images) {
        saveEntry();
        postform.submit();
        return;
    }

    var jsonParamValues;

    jsonParamValues = {
        images: images,
        blog_xid: "6a00e553e16897883300e553fcc7418834",
        user_xid: "6p00e553e168978833" };

    var data = client.request( {
        method: 'Post.CreateImage',
        params: jsonParamValues,
        callback: function( r ) {
            var message = r.result.message;
            var image_urls = r.result.image_urls;

            if ( message == 'error') {
                alert("Error creating the images in the post! Please use the 'Insert Image' option to add images to the post!");
                return false;
            }
            for (var i = 0;i < image_urls.length; i++) {
                postContent = postContent.replace(images[i], image_urls[i]);
            }

            updateEntry(postContent);
            saveEntry();
            postform.submit();
        }
    });
}

YAHOO.util.Event.onDOMReady( function() {

    // initialize the editor mode onDOMReady since TinyMCE doesn't init on all browsers
    doSelectEditorMode();

    var hide_wysiwyg_editor = getHideWysiwygEditor();
    var html_format_option_label;
    if( hide_wysiwyg_editor ) {
        html_format_option_label = YAHOO.util.Dom.get( 'format-option-source-0' );
        html_format_option_label.innerHTML = 'HTML';
    }

    YAHOO.util.Dom.getElementsByClassName( 'save-entry', 'a', 'entry-form', function( el ) {
        YAHOO.util.Event.on( el, 'click', function( ev ) {
            YAHOO.util.Event.stopEvent( ev );
   
            var zem_post_set = window.ZemantaPostSettings;

            /* Remove this after zemanta appevent need is over */
            if ( YAHOO.util.Dom.hasClass('zemanta-links-wrapper','open') ) {
                $( '#zemanta_viewed' ).val(1);
            } else {
                $( '#zemanta_viewed' ).val(0);
            }
            /* Done Zemanta appevent */

            /* Assign zemantaPostSettings value to hidden field zemanta_post_settings */
            //alert(zem_post_set);
            $( '#zemanta_post_settings' ).val(zem_post_set);
            /* Done */


            var postform = YAHOO.util.Dom.get( 'entry-form' );
            if( validateFilenameField( postform ) ) {
                /* disable the submit to avoid any double submits */
                /*
                YAHOO.util.Dom.getElementsByClassName( 'save-entry', 'a', 'entry-form', function( el ) {
                    el.disabled = 'disabled';
                } );
                */
                clearDirty();
                process_base64_images( postform);
            }
        } );
    } );

    YAHOO.util.Dom.getElementsByClassName( 'preview-entry', 'a', 'entry-form', function( el ) {
        YAHOO.util.Event.on( el, 'click', function( ev ) {
            YAHOO.util.Event.stopEvent( ev );

            var newwindow = window.open( "", "preview", "width=950,height=600,location=no,toolbar=no,resizable=yes,scrollbars=yes" );

            if( !newwindow ) {
                alert( 'A pop-up blocker prevented the preview window from opening! Please enable pop-ups for this feature.' );
                return false;
            }

            var form = YAHOO.util.Dom.get( 'preview-form' );

            form.body.value = atp_editor.getHTML();

            el = YAHOO.util.Dom.get( 'name' );
            if (el){
                form.name.value = el.value;
            }
            el = YAHOO.util.Dom.get( 'typepad_text_formatting' );
            if (el){
                form.typepad_text_formatting.value = el.value;
            }
            el = YAHOO.util.Dom.get( 'allow_comments' );
            if (el){
                form.allow_comments.value = el.value;
            }
            el = YAHOO.util.Dom.get( 'allow_pings' );
            if (el){
                form.allow_pings.value = el.checked;
            }
            form.submit();
            if (window.focus) {newwindow.focus()} //bring to the front for ie
        } );
    } );

    YAHOO.util.Dom.getElementsByClassName( 'delete-entry', 'a', 'entry-form', function( el ) {
        YAHOO.util.Event.on( el, 'click', function( ev ) {
            YAHOO.util.Event.stopEvent( ev );
            clearDirty();
            deleteAssets( [ '6a00e553e1689788330192aa7d9f92970d' ], 'http://www.typepad.com/site/blogs/6a00e553e16897883300e553fcc7418834/posts?deleted_single=1', 'Are you sure you want to permanently delete this entry?' );
        } );
    } );

    /* On setup bookmarklet close, hide the box */
    YAHOO.util.Event.on( 'bookmarklet-setup-close', 'click', function ( e ) {
        YAHOO.util.Event.stopEvent(e);
        var el = document.getElementById('bookmarklet-setup-close').parentNode.parentNode; /* bookmarklet setup box */
        var anim  = new YAHOO.util.Anim(el, { opacity: { to: 0 } }, .25, YAHOO.util.Easing.easeNone);
        anim.onComplete.subscribe( function() {
            el.parentNode.removeChild(el);
            doMethod( 'Dashboard.SavePref', { hide_setup_bookmarklet: 1 }, function( r ) { } );
        });
        anim.animate();
    } );

} );

var editor_modes = [ {
    id: 'wysiwyg',
    name: 'Rich Text',
    sourceMode: 'off',
    showWysiwyg: true,
    enableMenu: false
}, {
    id: '0',
    name: 'HTML',
    sourceMode: 'on',
    showWysiwyg: true,
    enableMenu: true
}, {
    id: '__default__',
    name: 'Convert Line Breaks',
    sourceMode: 'on',
    showWysiwyg: false,
    enableMenu: true
}, {
    id: 'markdown',
    name: 'Markdown',
    sourceMode: 'on',
    showWysiwyg: false,
    enableMenu: true
} ];

function doSelectEditorMode() {
    var current_format = getCurrentFormat();
    var wysiwyg_tab    = YAHOO.util.Dom.get( 'format-tab-wysiwyg' );
    var source_tab     = YAHOO.util.Dom.get( 'format-tab-source' );
    var source_label   = YAHOO.util.Dom.get( 'format-option-source-label' );

    // update the editor for the current format
    atp_editor.setSourceMode( current_format.sourceMode );

    // show/hide wysiwyg tab
    if( current_format.showWysiwyg )
        YAHOO.util.Dom.removeClass( wysiwyg_tab, 'hidden' );
    else
        YAHOO.util.Dom.addClass( wysiwyg_tab, 'hidden' );

    // highlight correct tab
    if( current_format.id == 'wysiwyg' ) {
        YAHOO.util.Dom.addClass( wysiwyg_tab, 'selected' );
        YAHOO.util.Dom.removeClass( source_tab, 'selected' );
    } else {
        YAHOO.util.Dom.removeClass( wysiwyg_tab, 'selected' );
        YAHOO.util.Dom.addClass( source_tab, 'selected' );
    }

    // set source label
    if( current_format.id != 'wysiwyg' )
        source_label.innerHTML = current_format.name;
    else
        source_label.innerHTML = 'HTML';

    // highlight correct source menu option
    var footer_option = YAHOO.util.Dom.get( 'format-option-source-' + current_format.id );
    YAHOO.util.Dom.addClass( footer_option, 'selected' );

    return true;
}

function toggleDrawer( id, display ) {
    if( YAHOO.util.Dom.hasClass( id, 'open' ) )
        YAHOO.util.Dom.removeClass( id, 'open' );
    else
        YAHOO.util.Dom.addClass( id, 'open' );

    var fields = [];
    if( YAHOO.util.Dom.hasClass( 'drawer-comments', 'open' ) )
        fields.push( 'ping_urls' );
    if( YAHOO.util.Dom.hasClass( 'drawer-excerpt', 'open') )
        fields.push( 'excerpt' );
    if( !YAHOO.util.Dom.hasClass( 'drawer-publicize', 'open') )
        fields.push( 'share' );

    if( display ) {
        YAHOO.util.Connect.setDefaultPostHeader( 'content-type', 'text/javascript+json' );
        window.activeAsyncRequest = YAHOO.util.Connect.asyncRequest( 'POST', 'http://www.typepad.com/services/json-rpc', {
            success: function( ev ) { /* log( 'drawer set' ); */ },
            failure: function() { /* log( 'failed to set drawer' ); */ },
            scope: this,
            cache: false
        }, YAHOO.lang.JSON.stringify( {
            "method": "Blog.SetPreferences",
            "params": [ {
                "data": {
                    "blog_xid": '6a00e553e16897883300e553fcc7418834',
                    "blog_display_fields": fields
                }
            } ]
        } ) );
    }
}

function getHideWysiwygEditor() {
    var is_ipad = navigator.userAgent.match(/iPad/i) != null;
    var hide_wysiwyg_editor = false || is_ipad ? true : false;

    return hide_wysiwyg_editor;
}

function getCurrentFormat() {
    var format;
    var format_field = YAHOO.util.Dom.get( 'typepad_text_formatting' );
    var hide_wysiwyg_editor = getHideWysiwygEditor();
    var format_id = format_field.value == 'wysiwyg' && hide_wysiwyg_editor ? '0' : format_field.value;

    // get current format details
    for( var i = 0; i < editor_modes.length; i++ )
        if( editor_modes[ i ].id == format_id )
            format = editor_modes[ i ];

    if (!format) {
        format = editor_modes[0]; // fallback to wysiwyg
    }

    if( hide_wysiwyg_editor ) {
        format.showWysiwyg = false;
    }

    return format;
}

YAHOO.util.Event.on( 'format-option-wysiwyg', 'click', function( ev ) {
    YAHOO.util.Event.stopEvent( ev );

    var wysiwyg_tab      = YAHOO.util.Dom.get( 'format-tab-wysiwyg' );
    var source_tab       = YAHOO.util.Dom.get( 'format-tab-source' );
    var formatting_field = YAHOO.util.Dom.get( 'typepad_text_formatting' );

    YAHOO.util.Dom.addClass( wysiwyg_tab, 'selected' );
    YAHOO.util.Dom.removeClass( source_tab, 'selected' );
    YAHOO.util.Dom.removeClass( source_tab, 'flyout-focus' );

    formatting_field.value = 'wysiwyg';
    doSelectEditorMode();
} );

YAHOO.util.Event.on( 'format-option-source', 'click', function( ev ) {
    YAHOO.util.Event.stopEvent( ev );

    var wysiwyg_tab      = YAHOO.util.Dom.get( 'format-tab-wysiwyg' );
    var source_tab       = YAHOO.util.Dom.get( 'format-tab-source' );
    var formatting_field = YAHOO.util.Dom.get( 'typepad_text_formatting' );
    var current_format   = getCurrentFormat();

    if( current_format.enableMenu ) {
        YAHOO.util.Dom.addClass( source_tab, 'flyout-focus' );
    } else {
        YAHOO.util.Dom.removeClass( wysiwyg_tab, 'selected' );
        YAHOO.util.Dom.addClass( source_tab, 'selected' );

        formatting_field.value = '0';
        doSelectEditorMode();
    }
} );

YAHOO.util.Event.on( [ 'format-option-source-0', 'format-option-source-__default__', 'format-option-source-markdown' ], 'click', function( ev ) {
    YAHOO.util.Event.stopEvent( ev );

    var source_tab       = YAHOO.util.Dom.get( 'format-tab-source' );
    var formatting_field = YAHOO.util.Dom.get( 'typepad_text_formatting' );
    var menu             = YAHOO.util.Dom.get( 'format-menu' );
    var menu_items       = YAHOO.util.Dom.getChildren( menu );
    var selected_format;

    YAHOO.util.Dom.removeClass( source_tab, 'flyout-focus' );

    // get selected format details
    for( var i = 0; i < editor_modes.length; i++ )
        if( 'format-option-source-' + editor_modes[ i ].id == this.id )
            selected_format = editor_modes[ i ];

    // update the editor UI with the selected format
    formatting_field.value = selected_format.id;
    doSelectEditorMode();

    // update the default with the selected format
    modifyCustomize( {
        blog_xid: '6a00e553e16897883300e553fcc7418834',
        blog_text_formatting: selected_format.id
    } );

    // update the text formatting UI with the selected format
    for( var i = 0; i < menu_items.length; i++ )
        YAHOO.util.Dom.removeClass( menu_items[ i ], 'selected' );
    YAHOO.util.Dom.addClass( this, 'selected' );
} );

YAHOO.util.Event.on( 'autosave-recover', 'click', function( ev ) {
    YAHOO.util.Event.stopEvent( ev );

    if ( isDirty() ) {
        var yes = confirm( 'You have unsaved changes to your post that will be lost. Are you sure you want to replace this content with your recovered post?' );
        if ( !yes )
            return;
    }

    this.innerHTML = '<img src="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/spinner.gif" width="15" height="15" />';

    client.request( {
        method: 'Autosave.Recover',
        callback: function( r ) {
            YAHOO.util.Dom.get( 'name' ).value = r.result.name;
            atp_editor.insertHTML( r.result.body );
            YAHOO.util.Dom.addClass( 'autosave-recover-message', 'hidden' );
        }
    } );
} );

YAHOO.util.Event.on( 'autosave-clear', 'click', function( ev ) {
    YAHOO.util.Event.stopEvent( ev );

    this.innerHTML = '<img src="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/spinner.gif" width="15" height="15" />';

    client.request( {
        method: 'Autosave.Clear',
        callback: function( r ) {
            YAHOO.util.Dom.addClass( 'autosave-recover-message', 'hidden' );
        }
    } );
} );

function resizeEditor ( ed, delta ) {
    var iframe = ed.getContentAreaContainer().firstChild;
    tinymce.DOM.setStyle( iframe, 'height', iframe.clientHeight + delta );
}

YAHOO.util.Event.onDOMReady( function() {
YAHOO.util.Dom.getElementsByClassName( 'lite-switch', 'a', 'lite-switch-container', function( el ) {
    YAHOO.util.Event.on( el, 'click', function( ev ) {
        YAHOO.util.Event.stopEvent( ev );

        var editor = YAHOO.util.Event.getTarget( ev ).getAttribute( 'at:switch-to' ) || 'WYSIWYGLite';

        var ed = tinyMCE.get( 'body' );
        var cm = ed.controlManager, id = cm.get( 'toolbar2' ).id;

        if ( editor == 'WYSIWYG' ) {
            tinymce.DOM.show( id );
            resizeEditor( ed, -28 );

            YAHOO.util.Dom.removeClass( 'lite-switch-lite', 'hidden' );
            YAHOO.util.Dom.addClass( 'lite-switch-full', 'hidden' );
        } else {
            tinymce.DOM.hide( id );
            resizeEditor( ed, 28 );

            YAHOO.util.Dom.removeClass( 'lite-switch-full', 'hidden' );
            YAHOO.util.Dom.addClass( 'lite-switch-lite', 'hidden' );
        }

        YAHOO.util.Connect.setDefaultPostHeader( 'content-type', 'text/javascript+json' );
        window.activeAsyncRequest = YAHOO.util.Connect.asyncRequest( 'POST', 'http://www.typepad.com/services/json-rpc', {
            success: function( ev ) {
            },
            failure: function() { /* window.console.log( 'failed to switch editor' ) */ },
            scope: this,
            cache: false
        }, YAHOO.lang.JSON.stringify( {
            "id": "1",
            "method": "Blog.SetPreferences",
            "params": [ {
                "data": {
                    "blog_xid": '6a00e553e16897883300e553fcc7418834',
                    "blog_editor": editor
                }
            } ]
        } ) );
    } );
} );
} );
var catExpanded = 0;
YAHOO.util.Event.on( 'expand-catlist', 'click', function( ev ) {
    YAHOO.util.Event.stopEvent( ev );
    if( catExpanded == 0 ) {
        catExpanded = YAHOO.util.Dom.getStyle('category-list', 'height');
        YAHOO.util.Dom.setStyle('category-list', 'height', 'auto');
        YAHOO.util.Dom.addClass('expand-cat-img', 'hiddenBox');
        YAHOO.util.Dom.removeClass('collapse-cat-img', 'hiddenBox');
    } else {
        YAHOO.util.Dom.setStyle('category-list', 'height', catExpanded);
        catExpanded = 0;
        YAHOO.util.Dom.addClass('collapse-cat-img', 'hiddenBox');
        YAHOO.util.Dom.removeClass('expand-cat-img', 'hiddenBox');
    }
});
</script>

<div class="success-message message">
    <div class="message-content">

<p>Your changes have been saved.</p>
    </div>
</div>




<form id="entry-form" class="post-form" action="http://www.typepad.com/site/blogs/6a00e553e16897883300e553fcc7418834/post/6a00e553e1689788330192aa7d9f92970d/edit" method="post">
    <input type="hidden" id="entry-form-token" name="token" value="1369892383-b48b33831fce299defde04595b7a9b826aa257a9" />
    <input type="hidden" id="typepad_text_formatting" name="typepad_text_formatting" value="0" />
    <input type="hidden" name="zemanta_occured" value="1" />
    <input type="hidden" id="zemanta_viewed" name="zemanta_viewed" value="1"/>
    <input type="hidden" id="zemanta_post_settings" name="zemanta_post_settings" value="" />
    <div class="content-compose pkg">
        <div class="content-main col">
            <div class="editor">
                <div class="editor-header">
                    <div class="content-title">
                        <h3>Edit Post</h3>
                    </div>
                    <div class="header-actions">
                        <div class="action">
                             <a href="http://www.typepad.com/site/blogs/6a00e553e16897883300e553fcc7418834/post/6a00e553e1689788330191029cdbcd970c/edit">Previous Post</a>
                        </div>
                        <div class="action">
                            Next Post 
                        </div>

                        <div class="action">
                            <a href="http://www.typepad.com/site/blogs/6a00e553e16897883300e553fcc7418834/posts">List Posts</a>
                        </div>

                  </div>
                </div>
            </div>
            <div class="compose-group tpshadow">
                <div id="title-field" class="title-field field">
                    <div class="field-header">
                        <label for="name">Title</label>
                    </div>
                    <div class="field-content">
                        <input id="name" name="name" value="Exchange App Webinar and Travel Plans" maxlength="255" class="ti" />
                    </div>
                </div>
                <div id="permalink-field" class="permalink-field field">
                    <div class="field-content">
                        <span class="permalink-label">Permalink:</span>
                        http://thebuildingcoder.typepad.com/blog/<span id="permalink-year">YYYY</span>/<span id="permalink-month">MM</span>/<span id="permalink-text-preview">exchange-app-webinar-and-travel-plans.html</span><span id="permalink-text-field" class="hidden"><input id="filename" name="filename" value="exchange-app-webinar-and-travel-plans" maxlength="255" class="ti" />.html</span>
                        <a id="edit-permalink" href="#">Edit</a>
                        <a id="save-permalink" class="hidden" href="#">Done</a>
                    </div>
                </div>
                <div id="body-field" class="body-field field">
                    <div class="field-header pkg">
                        <label for="body">Body</label>
                        <div id="format-chooser">
                            <div id="format-tab-wysiwyg" class="selected format-tab">
                                <div class="format-tab-inner">
                                    <a id="format-option-wysiwyg" href="#">
                                        <span class="format-tab-label">
                                            Rich Text
                                        </span>
                                    </a>
                                </div>
                            </div>
                            <div id="format-tab-source" class="format-tab">
                                <div class="format-tab-inner">
                                    <a id="format-option-source" href="#">
                                        <span class="format-tab-arrow">
                                            <span class="format-tab-label" id="format-option-source-label">
                                                Loading
                                            </span>
                                        </span>
                                    </a>
                                </div>
                                <div id="format-menu">
                                    <a id="format-option-source-0" href="#">Rich Text / HTML</a>
                                    <a id="format-option-source-__default__" href="#">Convert Line Breaks</a>
                                    <a id="format-option-source-markdown" href="#">Markdown</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="field-content">
                        <div id="body-formatting-toolbar" class="typepadSkin hidden"></div>
                        <textarea class="typepadSkin tp-editor" id="body" name="body" style="width: 648px; height: 255px;">&lt;p&gt;Register and mark your calendar now for this upcoming webcast on making the most of the Autodesk Exchange Apps store:&lt;/p&gt;

&lt;center&gt;
&lt;p&gt;&lt;strong&gt;&quot;How developers can ride and profit from the &lt;br/&gt;Autodesk Exchange Apps adoption wave&quot;&lt;/strong&gt;&lt;/p&gt;
&lt;/center&gt;

&lt;p&gt;There are currently 15 Autodesk Exchange Apps stores.
They represent a huge opportunity for developers to gain direct access to the growing number of Autodesk customers using Exchange Apps.
In just one year they have enjoyed over one million visits and over 250,000 downloads.
With comments like &lt;em&gt;one of my most useful tools, love this app, saved me hours of work&lt;/em&gt;, theres no doubt that Exchange Apps has become a resource that Autodesk customers rely on to find useful apps of all types.&lt;/p&gt;

&lt;p&gt;If you develop apps and want to reach more customers quickly, easily and inexpensively but havent yet put your toe in the water with Exchange Apps, the Autodesk Developer Network (ADN) team is ready to help you.
Youre invited to attend a webinar on June 13&lt;sup&gt;th&lt;/sup&gt; hosted by Jim Quanci and Stephen Preston to learn how you can catch the wave and participate in the accelerating growth of Exchange Apps.&lt;/p&gt;

&lt;p&gt;Youll learn the tricks of the trade when publishing on Exchange Apps, get ideas on how to be successful and learn about the ability to publish localized apps.
Heres what you need to know:&lt;/p&gt;

&lt;h4&gt;Webinar details:&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;Date: Thursday, &amp;nbsp;June 13&lt;sup&gt;th&lt;/sup&gt;, &amp;nbsp;2013
&lt;li&gt;Time: 8 a.m. PDT (4 p.m. BST; 5 p.m. CET; 11 a.m. EDT)
&lt;li&gt;Duration: approximately one hour&lt;/p&gt;
&lt;/ul&gt;

&lt;p&gt;Open to anyone interested in publishing apps on Autodesk Exchange Apps &amp;ndash; ADN membership is not required :-)&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Registration:&lt;/strong&gt; Reserve your place by June 11 by sending an email to &lt;a href=&quot;mailto: adn-training-worldwide@autodesk.com?subject=Exchange_Apps_webinar&quot;&gt;adn-training-worldwide@autodesk.com&lt;/a&gt; with &lt;em&gt;Exchange Apps webinar&lt;/em&gt; as the subject.
Please make sure you include your full name, company name and email address.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Visit &lt;a href=&quot;http://www.autodesk.com/developapps&quot;&gt;www.autodesk.com/developapps&lt;/a&gt; right away if you want a head start in learning how to publish apps.&lt;/em&gt;


&lt;a name=&quot;2&quot;&gt;&lt;/a&gt;

&lt;h4&gt;On the Road Again&lt;/h4&gt;

&lt;p&gt;I am hopping on a plane to Boston this afternoon, for the upcomng Autodesk internal Tech Summit in Cambridge, where I finally get to present the

&lt;a href=&quot;http://thebuildingcoder.typepad.com/blog/2013/05/my-cloud-based-2d-editor-implementation-status.html&quot;&gt;
cloud-based simplified 2D Revit model editor&lt;/a&gt; that

I have been having so much fun researching and developing.&lt;/p&gt;

&lt;p&gt;I'll be staying on there for a while to meet and spend some time with my colleagues and the Revit API development team.&lt;/p&gt;

&lt;p&gt;Later this month, I will be heading to

&lt;a href=&quot;http://www.autodesk.ru/adsk/servlet/pc/index?id=21516340&amp;siteID=871736&quot;&gt;
Moscow for a Revit DevCamp&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Then, in July, I'll participate in the Autodesk football tournament in London and present the first hands-on Revit 2014 API training in Sydney, Australia.&lt;/p&gt;

&lt;p&gt;Lots to prepare before then!&lt;/p&gt;

&lt;p&gt;I will keep you posted and am looking forward to sharing all the exciting material this will generate  :-)&lt;/p&gt;
</textarea>
                    </div>
                    <div class="field-footer pkg">
                        <div class="autosave-status col">&nbsp;</div>
                        <div id="lite-switch-container" class="lite-switch col">
                            <span id="lite-switch-full" class="hidden"><a class="lite-switch" href="#" at:switch-to="WYSIWYG">Use the full editor</a> (best for fast computers)</span>
                            <span id="lite-switch-lite"><a class="lite-switch" href="#" at:switch-to="WYSIWYGLite">Use the lite editor</a> (best for slow computers)</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="compose-drawers">
                <div id="drawer-comments" class="drawer-comments tpshadow drawer open">
                    <p class="drawer-handle"><a href="javascript: toggleDrawer( 'drawer-comments', 'ping_urls' );">Comments and TrackBacks</a></p>
                    <div class="drawer-contents pkg">
                        <div class="comment-col col">
                            <div class="comment-field field">
                                <div class="field-header">
                                    Comments
                                </div>
                                <div class="field-content">
                                    <div class="field-item">
                                        <div>
                                            <label>
                                                <input type="radio" name="allow_comments" value="1" checked="checked" class="rb" id="allow-comments-1"/>
                                                Open
                                            </label>
                                        </div>
                                        <div>
                                            <label>
                                                <input type="radio" name="allow_comments" value="2" class="rb" id="allow-comments-2"/>
                                                Closed
                                            </label>
                                        </div>
                                        <div>
                                            <label>
                                                <input type="radio" name="allow_comments" value="0" class="rb" id="allow-comments-3" />
                                                Hidden
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="trackback-col col">
                            <div class="trackback-field field">
                                <div class="field-header">
                                    TrackBacks
                                </div>
                                <div class="field-content">
                                    <div class="field-item">
                                        <div>
                                            <label>
                                                <input type="radio" name="allow_pings" value="1" checked="checked" class="rb" id="allow-trackbacks-1"/>
                                                Display
                                            </label>
                                        </div>
                                        <div>
                                            <label>
                                                <input type="radio" name="allow_pings" value="0" class="rb" id="allow-trackbacks-2"/>
                                                Hide
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="drawer-publicize" class="drawer-publicize tpshadow drawer open">
                    <p class="drawer-handle"><a href="javascript: toggleDrawer( 'drawer-publicize', 'share' );">Keywords and Technorati Tags</a></p>
                    <div class="drawer-contents pkg">
                        <div class="keywords-col col">
                            <div class="keywords-field field">
                                <div class="field-header">
                                    <label for="keywords">Keywords</label>
                                </div>
                                <div class="field-content">
                                    <div class="field-item">
                                        <textarea name="keywords" class="ta" id="keywords-ta">Revit API, Jeremy Tammik</textarea>
                                    </div>
                                    <div class="field-description">
                                        <p>Optimize for search engines by entering descriptive words. (Separate words with commas.)</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="technoratitags-col col">
                            <div class="technoratitags-field field">
                                <div class="field-header">
                                    <label for="typepad_technorati_tags">Technorati Tags</label>
                                </div>
                                <div class="field-content">
                                    <div class="field-item">
                                        <textarea name="typepad_technorati_tags" class="ta" id="technorati-ta">Jeremy Tammik, Revit API</textarea>
                                    </div>
                                    <div class="field-description">
                                        <p>Link to similar posts on Technorati by entering descriptive words. (Separate words with commas.)</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="drawer-excerpt" class="drawer-excerpt tpshadow drawer">
                    <p class="drawer-handle"><a href="javascript: toggleDrawer( 'drawer-excerpt', 'excerpt' );">Excerpt</a></p>
                    <div class="drawer-contents">
                        <div class="excerpt-field field">
                            <div class="field-content">
                                <div class="field-item">
                                    <textarea id="summary" name="description" class="ta"></textarea>
                                </div>
                                <div class="field-description">
                                    <p>Enter a brief summary of your post. (Optional.) <a href="http://help.typepad.com/compose_overview.html" target="_blank">Learn more.</a></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="content-related col">
            <div class="related-module-bundle">
            <div class="bookmarklet-module related-module tpshadow">
                <div class="module-header">
                    Try the TypePad Bookmarklet
                </div>
                <div class="module-content">
                    <p>Post any web page to your blog in seconds. Drag the bookmarklet to your browsers bookmarks bar:</p>
                    <div class="bookmarklet">
                        <a href="javascript:var%20b=document.body;var%20TYPEPAD___bookmarklet_domain='http://www.typepad.com';if(b&&!document.xmlVersion){void(z=document.createElement('script'));void(z.type='text/javascript');void(z.src='http://static.typepad.com/.shared:va84928f:typepad:en_us/js/qp/loader-combined-min.js');void(b.appendChild(z));}else{}" onclick="alert( 'Drag this bookmarklet to your browsers bookmarks bar. (Right click and Add to Favorites if youre using Internet Explorer.)' ); return false;">Blog It</a>
                    </div>
                </div>
                <div class="module-remove">
                    <a id="bookmarklet-setup-close" href="#"><img src="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/app/promos/bookmarklet-close.png" alt="Remove" width="10" height="10" /></a>
                </div>
            </div>
            <div class="feedback-module related-module tpshadow">
                <div class="feedback-field field">
                    <div class="field-header">Feedback</div>
                    <div class="field-content">
                        <div class="feedback-favorites">0 Favorites</div>
                        <div class="feedback-comments">0 Comments</div>
                        <div class="feedback-reblogs">0 Reblogs</div>
                        <div class="feedback-trackbacks">0 TrackBacks</div>
                    </div>
                </div>
            </div>
            <div class="categories-module related-module tpshadow">
                <div class="categories-field field">
                    <div class="field-header">
                        <span class="header">Categories</span>
                        <a href="#" id="expand-catlist"><img id="expand-cat-img" src="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/category-list-expand.png" /><img id="collapse-cat-img" class="hiddenBox" src="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/category-list-collapse.png" /></a>
                        <div class="clear"></div>
                    </div>
                    <div class="field-content">
                        <div class="category-list-full category-list" id="category-list">
                            <label>
                                <input type="checkbox" name="category" value=".NET" class="cb" />
                                .NET
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="2010" class="cb" />
                                2010
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="2011" class="cb" />
                                2011
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="2012" class="cb" />
                                2012
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="2013" class="cb" />
                                2013
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="2014" checked="checked" class="cb" />
                                2014
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="ACA" class="cb" />
                                ACA
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Algorithm" class="cb" />
                                Algorithm
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="AU" class="cb" />
                                AU
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="AU 2008" class="cb" />
                                AU 2008
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="AU 2009" class="cb" />
                                AU 2009
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="AU 2010" class="cb" />
                                AU 2010
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="AU 2011" class="cb" />
                                AU 2011
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Automation" class="cb" />
                                Automation
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="AVF" class="cb" />
                                AVF
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="BIM" class="cb" />
                                BIM
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Climbing" class="cb" />
                                Climbing
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Cloud" class="cb" />
                                Cloud
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Data Access" class="cb" />
                                Data Access
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Debugging" class="cb" />
                                Debugging
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Deletion" class="cb" />
                                Deletion
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Desktop" class="cb" />
                                Desktop
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="DevTV" class="cb" />
                                DevTV
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Discipline" class="cb" />
                                Discipline
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Diving" class="cb" />
                                Diving
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="DMU" class="cb" />
                                DMU
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="DragDrop" class="cb" />
                                DragDrop
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="DWF" class="cb" />
                                DWF
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="DWG" class="cb" />
                                DWG
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Element Creation" class="cb" />
                                Element Creation
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Element Relationships" class="cb" />
                                Element Relationships
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Events" checked="checked" class="cb" />
                                Events
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Exchange" checked="checked" class="cb" />
                                Exchange
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="External" class="cb" />
                                External
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="F#" class="cb" />
                                F#
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Failure" class="cb" />
                                Failure
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Family" class="cb" />
                                Family
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="FBX" class="cb" />
                                FBX
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Filters" class="cb" />
                                Filters
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Fun" class="cb" />
                                Fun
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="gbXML" class="cb" />
                                gbXML
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Geometry" class="cb" />
                                Geometry
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Getting Started" checked="checked" class="cb" />
                                Getting Started
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Glue" class="cb" />
                                Glue
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Group" class="cb" />
                                Group
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="HTML" class="cb" />
                                HTML
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Idling" class="cb" />
                                Idling
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="IFC" class="cb" />
                                IFC
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Installation" class="cb" />
                                Installation
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="JavaScript" class="cb" />
                                JavaScript
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Journal" class="cb" />
                                Journal
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="JSON" class="cb" />
                                JSON
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Links" class="cb" />
                                Links
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="M3U" class="cb" />
                                M3U
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Mac" class="cb" />
                                Mac
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Macro" class="cb" />
                                Macro
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Material" class="cb" />
                                Material
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Migration" class="cb" />
                                Migration
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Mobile" class="cb" />
                                Mobile
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="MP3" class="cb" />
                                MP3
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Music" class="cb" />
                                Music
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="News" checked="checked" class="cb" />
                                News
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Parameters" class="cb" />
                                Parameters
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Parts" class="cb" />
                                Parts
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Performance" class="cb" />
                                Performance
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Photo" class="cb" />
                                Photo
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Plugin" class="cb" />
                                Plugin
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Python" class="cb" />
                                Python
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Regen" class="cb" />
                                Regen
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="REST" class="cb" />
                                REST
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="REX" class="cb" />
                                REX
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Ribbon" class="cb" />
                                Ribbon
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="RME" class="cb" />
                                RME
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="RST" class="cb" />
                                RST
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Sailing" class="cb" />
                                Sailing
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Schedule" class="cb" />
                                Schedule
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="SDK Samples" class="cb" />
                                SDK Samples
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Server" class="cb" />
                                Server
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Settings" class="cb" />
                                Settings
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Storage" class="cb" />
                                Storage
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Storm" class="cb" />
                                Storm
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="SVG" class="cb" />
                                SVG
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Training" checked="checked" class="cb" />
                                Training
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Transaction" class="cb" />
                                Transaction
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Travel" checked="checked" class="cb" />
                                Travel
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Units" class="cb" />
                                Units
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Update" class="cb" />
                                Update
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="User Interface" class="cb" />
                                User Interface
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Utilities" class="cb" />
                                Utilities
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Vasari" class="cb" />
                                Vasari
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="VB" class="cb" />
                                VB
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="View" class="cb" />
                                View
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="VSTA" class="cb" />
                                VSTA
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="WCF" class="cb" />
                                WCF
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Win32" class="cb" />
                                Win32
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Wizard" class="cb" />
                                Wizard
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="Workset" class="cb" />
                                Workset
                            </label>
                            <label>
                                <input type="checkbox" name="category" value="WPF" class="cb" />
                                WPF
                            </label>
                        </div>
                        <div id="added-categories" class="hidden added-categories"></div>
                    </div>
                    <div class="field-footer"><a id="add-category" href="#">Add a new category</a></div>
                </div>
            </div>
            <div class="share-module related-module tpshadow">
                <div id="publicize-setting" class="share-field field">
                    <div class="field-header">Share This Post</div>
                    <div class="field-content">
                        <div class="service-list">                            <div class="shareaccts">
                                <input type="checkbox" name="publicize" value="6a00e553e1689788330162fc538d30970d" class="cb publicize-acct" onclick="showTxtArea(this, 'Facebook');" id="publicize-6a00e553e1689788330162fc538d30970d" />
                                <img src="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/profile/service_icons/facebook.png" alt="Facebook" width="16" height="16" />
                                Facebook
                                (<a target="_blank" href="http://www.facebook.com/profile.php?id=1019863650">jeremytammik</a>)
                                
                                <textarea name="publicize_6a00e553e1689788330162fc538d30970d" maxlength="200" onBlur="rmvSpc(this,false)"  onfocus="pubTextFoc(this, false);" class="publicize-text-Facebook social-compose">Enter a short message about your blog post to get people excited to come read it.</textarea>
                                
                            </div>
                            <br class="clr" />
                        </div>
                    </div>
                    <div class="field-footer">
                        <a href="https://www.typepad.com/secure/account/profile/accounts">Manage accounts</a>
                    </div>
                </div>
            </div>
            <div class="feature-module related-module tpshadow">
                <div class="feature-field field">
                    <div class="field-header">Feature This Post</div>
                    <div class="field-content">
                        <input type="hidden" id="sticky_post-backup" name="sticky_post-backup" value="" />
                        <label>
                            <input type="checkbox" id="sticky_post" name="sticky_post" value="1" class="cb" />
                            Keep this post at the top of your blogs home page
                        </label>
                    </div>
                    <div id="sticky_post-warning" class="hidden field-footer">
                        Note: Featuring this post will displace any currently featured post.
                    </div>
                </div>
            </div>
            </div>
            <div class="publishing-module related-module tpshadow">
                <div class="publishing-field field pkg">
                    <div class="field-header">
                        <label for="status">Status:</label>
                        <select id="status" name="status">
                            <option value="publish">Publish Now</option>
                            <option value="draft">Draft</option>
                            <option value="future" selected="selected">Publish On</option>
                        </select>
                        
                    </div>
                    <div class="field-content">
                        <input type="hidden" id="issued-epoch" name="issued_epoch" value="1369904400" />
                        <div id="timestamp" class="timestamp hidden"><a id="issued-link" href="#"><span id="issued-text"></span></a></div>
                        <div class="publish-buttons pkg">
                            <div class="preview-col col"><a class="preview-entry" href="#">Preview</a></div>
                            <div class="save-col col"><a class="save-entry" href="#">Save</a></div>
                        </div>
                        <div class="delete-button"><a class="delete-entry" href="#">Delete this post</a></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
<form id="preview-form" class="preview-form" action="http://www.typepad.com/site/blogs/6a00e553e16897883300e553fcc7418834/compose/preview/post" method="post" target="preview" class="hidden">

    <input type="hidden" id="preview-form-token" name="token" value="1369892384-b48b33831fce299defde04595b7a9b826aa257a9" />
    <input type="hidden" name="body" value="" />
    <input type="hidden" name="name" value="" />
    <input type="hidden" name="typepad_text_formatting" value="" />
    <input type="hidden" name="entry_id" value="6a00e553e1689788330192aa7d9f92970d" />
    <input type="hidden" name="allow_comments" value="" />
    <input type="hidden" name="allow_pings" value="" />
    <input type="hidden" id="preview-issued-epoch" name="issued_epoch"/>
</form>

<div id="spellcheck-wait" class="hidden">
    <div class="hd">Spell Check</div>
    <div class="bd">
        <center><img src="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/ipb.gif" /></center>
    </div>
</div>
<script type="text/javascript">
SixApart.widget.UploadDialog = function() {
    SixApart.widget.UploadDialog.superclass.constructor.apply(this, arguments);
};

YAHOO.extend(SixApart.widget.UploadDialog, TC.EditorDialog, {
    defaults: {
        align: 'none',
        size: 'full',
        popup: true
    },

    show: function() {
        SixApart.widget.UploadDialog.superclass.show.apply(this, arguments);
        /* using the last state of the custom options, show or hide it */
        var form = YAHOO.util.Dom.get( 'upload-form' );
        if( form && form.use_defaults[1].checked )
            YAHOO.util.Dom.removeClass( 'insert-image-options', 'hidden' );
        this.center();
    },

    hide: function() {
        YAHOO.util.Dom.addClass( 'insert-image-options', 'hidden' );
        SixApart.widget.UploadDialog.superclass.hide.apply(this, arguments);
    },

    toggleOptionVisibility: function( t ) {
        var f = t.form;
        var o = YAHOO.util.Dom.get( 'insert-image-options' );
        if( t.value == '0' ) {
            YAHOO.util.Dom.removeClass( o, 'hidden' );
        } else {
            YAHOO.util.Dom.addClass( o, 'hidden' );
            this.resetCustomSettings( f );
        }
        this.center();
    },

    resetCustomSettings: function( f ) {
        for( var i = 0; i < f.alignment.length; i++ ) {
            if( f.alignment[i].value == this.defaults.align ) {
                f.alignment[i].checked = true;
            } else {
                f.alignment[i].checked = false;
            }
        }
        this.handleChangedAlignment( this.defaults.align );

        var format = this.defaults.size,
            size   = this.defaults.size;
        if ( size == parseInt( size ) ) {
            format = 'custom';
            f.width.value = size;
            YAHOO.util.Dom.removeClass( 'custom-image-width', 'hidden' );
        } else {
            YAHOO.util.Dom.addClass( 'custom-image-width', 'hidden' );
        }
        for( var i = 0; i < f.size.length; i++ ) {
            if( f.size.options[i].value == format ) {
                f.size.options[i].selected = true;
            } else {
                f.size.options[i].selected = false;
            }
        }
        this.resetAlignmentOptions( f.size.value );

        f.popup.checked = this.defaults.popup;

        if ( f.save ) {
            f.save.checked = false;
        }
    },

    resetAlignmentOptions: function( format ) {
        YAHOO.util.Dom.getElementsByClassName( 'rb', 'input', 'align-insert-image', function( el ) {
            if( format == 'text' ) {
                YAHOO.util.Dom.addClass( 'align-insert-image', 'align-insert-image-disabled' );
                el.disabled = "disabled";
                el.checked = el.value == 'none' ? true : false;
            } else {
                YAHOO.util.Dom.removeClass( 'align-insert-image', 'align-insert-image-disabled' );
                el.disabled = '';
            }
        } );

        if( format == 'custom' ) {
            YAHOO.util.Dom.removeClass( 'custom-image-width', 'hidden' );
        } else {
            YAHOO.util.Dom.addClass( 'custom-image-width', 'hidden' );
        } 
    },

    trackUpload: function() {
        if ( this.form.save && this.form.save.checked ) {
            this.saveImageDefaults();
        }

        var _this = this;
        var cb = {
            upload : function( o ) {
                TC.dialogs.uploadWaitDialog.hide();
                TC.dialogs.uploadImage.hide();

                var rsp = o.responseXML.getElementsByTagName( 'rsp' );
                var status = rsp[ 0 ].getAttribute( 'stat' );
                switch ( status ) {
                    case 'ok':
                        var ph = rsp[ 0 ].getElementsByTagName( 'photoid' );
                        var xids = new Array();
                        for( var i = 0; i < ph.length; i++ ) {
                            var id = ph[ i ].firstChild.nodeValue;
                            //console.log(ph[ i ].firstChild);
                            if( xids.length == 0 || ( xids.length > 0 && xids.indexOf( id ) == -1 ) )
                                xids.push( id );
                        }
                        _this.getAssetMarkup( xids, _this.getFormattingOptions() );
                        break;
                    case 'fail':
                        atp_editor.cancelInsertImage();
                        var err = rsp[ 0 ].getElementsByTagName( 'err' );
                        if ( err && err[ 0 ] ) {
                            if ( err[ 0 ].getAttribute( 'code' ) == 6 && TC.dialogs.quotaExceeded )
                                TC.dialogs.quotaExceeded.show();
                            else
                                alert( err[ 0 ].getAttribute( 'msg' ) );
                        } else {
                            alert( 'Upload failed.' );
                        }
                        break;
                    default:
                        atp_editor.cancelInsertImage();
                        alert( 'unknown status: ' + status );
                        break;
                }
            }
        };

        TC.dialogs.uploadWaitDialog.show();

        YAHOO.util.Connect.setForm( this.form, true );
        window.activeAsyncRequest = YAHOO.util.Connect.asyncRequest( 'POST', 'http://www.typepad.com/services/upload', cb );
    },

    getAssetMarkup: function( xids, args ) {
        var _this = this;
        doMethod( 'Library.Asset.AsEnclosure', { asset_ids: xids, args: args }, function(o) {
            _this.insertImageHTML( o.items.join('') );
            if ( window.updateUploadToken )
                window.updateUploadToken();
        } );
    },

    getFormattingOptions: function() {
        var d = this.getData();
        var opt = {
            format: d.size[ 0 ],
            align: d.alignment,
            popup: d.popup
        };
        if ( opt.format == 'custom' ) {
            opt.width = d.width;
        }
        return opt;
    },

    saveImageDefaults: function() {
        var opt = this.getFormattingOptions();
        var client = new TC.JSONRPCClient( 'http://www.typepad.com/services/json-rpc' );
        var _this = this;
        client.request( {
            method: 'Blog.SetImageDefaults',
            params: {
                blog_xid: '6a00e553e16897883300e553fcc7418834',
                image_default_size: opt.format == 'custom' ? opt.width : opt.format,
                image_default_align: opt.align,
                image_default_popup: opt.popup
            },
            callback: function ( r ) {
                if ( r.error ) {
                    alert( r.error );
                } else {
                    // Save the new settings in our locally-cached version
                    // of the defaults.
                    _this.defaults.popup = opt.popup;
                    _this.defaults.align = opt.align;
                    _this.defaults.size = opt.format == 'custom' ? opt.width : opt.format;
                }
            }
        } );
    },

    handleChangedAlignment: function( align ) {
        var p = YAHOO.util.Dom.get( 'align-insert-image' );
        var m = [ 'none', 'right', 'left' ];
        for( var i = 0; i < m.length; i++ )
            YAHOO.util.Dom.removeClass( p, 'align-insert-image-' + m[i] );
        YAHOO.util.Dom.addClass( p, 'align-insert-image-' + align );
    }
});

YAHOO.util.Event.onDOMReady( function() {
    var d = new SixApart.widget.UploadDialog( 'insert-image-dialog', {
        width: '400px',
        fixedcenter: false,
        y: 0,
        close: false,
        draggable: false,
        zindex: 40,
        modal: true,
        visible: false,
        buttons: [
            {
                text: 'Cancel',
                handler: function() {
                    this.cancel();
                    atp_editor.cancelInsertImage();
                },
                isDefault: false
            },
            {
                text: 'Insert Image',
                handler: function() {
                    this.trackUpload();
                },
                isDefault: true
            }
        ]
    } );
    d.render();
    TC.dialogs.uploadImage = d;

    d.showEvent.subscribe( function( type, args, me ) {
        me.resetCustomSettings( me.form );
    }, d );
    
    YAHOO.util.Event.on( [ 'use_defaults_0', 'use_defaults_1' ], 'click', function( e ) {
        d.toggleOptionVisibility( this );
    } );

    YAHOO.util.Event.on( 'size', 'change', function( e ) {
        d.resetAlignmentOptions( this.value );
    } );

    YAHOO.util.Dom.getElementsByClassName( 'rb', 'input', 'align-insert-image', function( elem ) {
        YAHOO.util.Event.on( elem, 'click', function( evt ) {
            d.handleChangedAlignment( this.value );
        } );
    } );

    var uploadWaitDialog = new YAHOO.widget.Dialog( 'insert-image-wait', {
        width: '240px',
        fixedcenter: true,
        close: false,
        draggable: false,
        zindex: 41,
        modal: true,
        visible: false,
        buttons: [ { text: 'Cancel', handler: function() {
            YAHOO.util.Connect.abort( window.activeAsyncRequest );
            TC.dialogs.uploadWaitDialog.hide();
            TC.dialogs.uploadImage.hide();
            atp_editor.cancelInsertImage();
        }, isDefault: false } ]
    } );
    uploadWaitDialog.setHeader( 'Uploading, please wait...' );
    uploadWaitDialog.render();
    TC.dialogs.uploadWaitDialog = uploadWaitDialog;
} );

function validate_upload() {
    if( window.no_file )
        alert( 'You did not choose a file to upload.' );
    if( window.no_space )
        alert( 'You do not have enough disk space left on your account to upload this file.' );
    if( window.not_an_image )
        alert( 'The file you chose is not an image.' );
    if( window.error_invalid_image )
        alert( 'The file you uploaded is not a supported type of image. The image must be a GIF, JPG, or PNG image.' );
    if( window.invalid_filename )
        alert( 'The file you chose had an invalid filename. Please rename the file so that its name contains only ASCII characters, then re-uploading it.' );
}
</script>

<div id="insert-image-wait">
    <div class="hd">Insert Image</div>
    <div class="bd">
        <center><img src="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/ipb.gif" /></center>
    </div>
</div>
<div id="insert-image-dialog">
    <div class="hd">Insert Image</div>
    <div class="bd">
        <form id="upload-form" method="post" enctype="multipart/form-data" action="http://www.typepad.com/services/upload">
            <input type="hidden" id="upload-form-token" name="token" value="1369892384-b48b33831fce299defde04595b7a9b826aa257a9" />
            <input type="hidden" name="upload_as.user" value="6p00e553e168978833" />
            <input type="hidden" name="upload_as.scope" value="collection" />
            <input type="hidden" name="upload_as.scope_id" value="64550114806564916" />
            <div class="dialog-section pkg">
                <div class="dialog-section-number">1</div>
                <div class="dialog-section-content">
                    <h4 class="dialog-section-header">Choose an image</h4>
                    <div class="dialog-field">
                        <div class="dialog-field-content"><input type="file" id="file" name="file" /></div>
                        <div class="dialog-field-notes">To insert an image into your post, click the button above and select an image file on your computer to upload.</div>
                    </div>
                </div>
            </div>
            <div class="dialog-section-last dialog-section pkg">
                <div class="dialog-section-number">2</div>
                <div class="dialog-section-content">
                    <h4 class="dialog-section-header">Set image options</h4>
                    <div class="dialog-toggle">
                        <ul class="pkg">
                            <li><label><input type="radio" id="use_defaults_1" name="use_defaults" value="1" checked="checked" class="rb" />
                                Defaults</label></li>
                            <li><label><input type="radio" id="use_defaults_0" name="use_defaults" value="0" class="rb" />
                                Custom</label></li>
                        </ul>
                    </div>
                    <div id="insert-image-options" class="hidden">
                        <div class="dialog-field">
                            <div class="dialog-field-content">
                                <label for="size">Image Size:</label>
                                <select id="size" name="size" size="1">
                                    <option value="full">Full Size</option>
                                    <option value="large">Large (500 px)</option>
                                    <option value="medium">Medium (320 px)</option>
                                    <option value="small">Small (120 px)</option>
                                    <option value="custom">Custom</option>
                                    <option value="text">Text Link</option>
                                </select>
                                <span id="custom-image-width"><input name="width" /> px</span>
                            </div>
                            <div class="dialog-field-notes">Display your image at full size, scaled to the width of the column, or use one of the alternate preset sizes.</div>
                        </div>
                        <div class="dialog-field">
                            <div class="dialog-field-content">
                                <div id="align-insert-image">
                                    <div>
                                        <label><input type="radio" name="alignment" value="none" class="rb" />
                                            No Wrap</label>
                                    </div>
                                    <div>
                                        <label><input type="radio" name="alignment" value="floatright" class="rb" />
                                            Float Image Right</label>
                                    </div>
                                    <div>
                                        <label><input type="radio" name="alignment" value="floatleft" class="rb" />
                                            Float Image Left</label>
                                    </div>
                                </div>
                            </div>
                            <div class="dialog-field-notes">Position your image as a block on its own line or wrapped in text by floating it right or left.</div>
                        </div>
                        <div class="dialog-field">
                            <div class="dialog-field-content">
                                <label><input type="checkbox" name="popup" value="1" class="cb" />
                                    Pop-up Window</label>
                            </div>
                            <div class="dialog-field-notes">Optionally link to the full-size version of the image in a pop-up window.</div>
                        </div>
                        <div class="dialog-field-last dialog-field">
                            <div class="dialog-field-content">
                                <label><input type="checkbox" name="save" value="1" class="cb" />
                                    Save settings as this weblog's defaults</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script type="text/javascript">
YAHOO.util.Event.onDOMReady( function() {
    var d = new YAHOO.widget.Dialog( 'upload-file-wait', {
        width: '240px',
        fixedcenter: true,
        close: false,
        draggable: false,
        zindex: 5,
        modal: true,
        visible: false,
        buttons: [ {
            text: 'Cancel',
            handler: function() {
                YAHOO.util.Connect.abort( window.activeAsyncRequest );
                this.hide();
            },
            isDefault: false
        } ]
    } );
    d.render();
    TC.dialogs.uploadFileWait = d;
} );
</script>

<div id="upload-file-wait">
    <div class="hd">Uploading, please wait...</div>
    <div class="bd">
        <center><img src="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/ipb.gif" /></center>
    </div>
</div>


<script type="text/javascript">
( function() {
    var Event = YAHOO.util.Event,
        Dom   = YAHOO.util.Dom;

    var AUDIO_EXT = /\.mp3$/;

    Event.onDOMReady( function() {
        var d = new TC.EditorDialog( 'insert-file-dialog', {
            buttons: [
                {
                    text: 'Cancel',
                    handler: function() { this.hide() },
                    isDefault: false
                },
                {
                    text: 'Upload File',
                    handler: function() {
                        var _this = this;

                        TC.dialogs.uploadFileWait.show();
                        YAHOO.util.Connect.setForm( this.form, true );

                        window.activeAsyncRequest = YAHOO.util.Connect.asyncRequest( 'POST', 'http://www.typepad.com/services/upload_file', {
                            upload : function( o ) {
                                TC.dialogs.uploadFileWait.hide();
                                TC.dialogs.uploadFile.hide();

                                var res = YAHOO.lang.JSON.parse( o.responseText );
                                var status = res.rsp.stat;
                                switch ( status ) {
                                    case 'ok':
                                        var xid = res.rsp.photoid[ 0 ]._content;
                                        var format = Dom.get( 'insert-file-audio-options' ) && !Dom.hasClass( 'insert-file-audio-options', 'hidden' ) ? _this.form.audio_format.value : 'text';
                                        doMethod( 'Library.Asset.AsEnclosure', { asset_ids: [ xid ], args: { format: format } }, function(o) {
                                            _this.insertHTML( o.items.join('') );
                                        } );
                                        break;
                                    case 'fail':
                                        var err = res.rsp.err;
                                        if ( err ) {
                                            if ( err.code == 6 && TC.dialogs.quotaExceeded )
                                                TC.dialogs.quotaExceeded.show();
                                            else
                                                alert( err.msg );
                                        } else {
                                            alert( 'Upload failed.' );
                                        }
                                        break;
                                    default:
                                        alert( 'unknown status: ' + status );
                                        break;
                                }
                            }
                        }, 'format=js&response_type=full'  );
                    },
                    isDefault: true
                }
            ]
        } );
        d.render();
        TC.dialogs.uploadFile = d;

        Event.on( 'insert-file-input', 'change', function( evt ) {
            if ( this.value.match( AUDIO_EXT ) ) {
                Dom.removeClass( 'insert-file-audio-options', 'hidden' );
            } else {
                Dom.addClass( 'insert-file-audio-options', 'hidden' );
            }
        } );
    } );
} )();
</script>

<div id="insert-file-dialog">
    <div class="hd">Upload a File</div>
    <div class="bd">
        <form method="post" enctype="multipart/form-data" action="http://www.typepad.com/services/upload_file">
            <input type="hidden" name="token" id="insert-file-token" value="1369892384-b48b33831fce299defde04595b7a9b826aa257a9" />
            <input type="hidden" name="parent_path" value="/files/" />
            <input type="hidden" name="upload_as.user" value="6p00e553e168978833" />
            <input type="hidden" name="upload_as.scope" value="collection" />
            <input type="hidden" name="upload_as.scope_id" value="64550114806564916" />
            <div class="dialog-section">
                <div class="dialog-field">
                    <div class="dialog-field-content"><input type="file" id="insert-file-input" name="file" /></div>
                    <div class="dialog-field-notes">To insert a file into your post, click the button above and select a file on your computer to upload.</div>
                </div>
            </div>
        </form>
    </div>
</div>

<script type="text/javascript">
YAHOO.util.Event.onDOMReady( function() {
    var d = new YAHOO.widget.Dialog( 'upload-video-wait', {
        width: '240px',
        fixedcenter: true,
        close: false,
        draggable: false,
        zindex: 5,
        modal: true,
        visible: false,
        buttons: [ {
            text: 'Cancel',
            handler: function() {
                YAHOO.util.Connect.abort( window.activeAsyncRequest );
                this.hide();
            },
            isDefault: false
        } ]
    } );
    d.render();
    TC.dialogs.uploadVideoWait = d;
} );
</script>

<div id="upload-video-wait">
    <div class="hd">Uploading, please wait...</div>
    <div class="bd">
        <center><img src="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/ipb.gif" /></center>
    </div>
</div>


<script type="text/javascript">
( function() {
    var Event = YAHOO.util.Event,
        Dom   = YAHOO.util.Dom;

    var client = new TC.JSONRPCClient( 'http://www.typepad.com/services/json-rpc' );

    Event.onDOMReady( function() {
        var d = new TC.EditorDialog( 'insert-video-dialog', {
            buttons: [
                {
                    text: 'Cancel',
                    handler: function() { this.hide() },
                    isDefault: false
                },
                {
                    text: 'Insert Video',
                    handler: function() {
                        var _this = this;
                        var enclose = function( src ) {
                            /* TinyMCE will remove <object></object> if
                               that's the only content inside <p>. Putting
                               a space to avoid that. */
                            return src + '&nbsp;';
                        };

                        TC.dialogs.uploadVideoWait.show();

                        if ( Dom.get('insert-video-radio-html').checked ) {
                            TC.dialogs.uploadVideoWait.hide();
                            
                            var checker = new RegExp( "<(embed|iframe)", "i" );
                            var html = Dom.get('insert-video-html').value;
                            if ( !html.match( checker ) && !confirm( 'You did not enter an Embed or IFrame tag. This may cause the video to fail to display. Click OK to continue or Cancel to update the embed block.' ) ) {
                                return;
                            }

                            _this.insertHTML( enclose( html ) );
                            Dom.get('insert-video-html').value = "";
                            TC.dialogs.uploadVideo.hide();
                            return;
                        }

                        // Now, try extracting an embed code from a uri
                        client.request( {
                            method: 'Post.ExtractEmbed',
                            params: {
                                url: Dom.get( 'insert-video-url' ).value,
                                options: { maxwidth: 500 }
                            },
                            callback: function( r ) {
                                TC.dialogs.uploadVideoWait.hide();

                                if ( r.error ) {
                                    alert( r.error );
                                } else {
                                    _this.insertHTML( enclose( r.result.source ) );
                                    TC.dialogs.uploadVideo.hide();
                                }
                            }
                        } );
                    },
                    isDefault: true
                }
            ]
        } );
        d.render();
        TC.dialogs.uploadVideo = d;

        Event.on( 'insert-video-url', 'focus', function( evt ) {
            Dom.get('insert-video-radio-url').checked = true;
        } );

        Event.on( 'insert-video-html', 'focus', function( evt ) {
            Dom.get('insert-video-radio-html').checked = true;
        } );
    } );
} )();
</script>

<div id="insert-video-dialog">
    <div class="hd">Insert Video</div>
    <div class="bd">
        <form></form>
        <form onSubmit="return false;">
            <div class="dialog-section pkg">
                <div class="dialog-section-number"><input type="radio" id="insert-video-radio-url" name="insert_video" value="url" checked="checked" class="rb" /></div>
                <div class="dialog-section-content">
                    <div class="dialog-field">
                        <div class="dialog-field-header"><label for="insert-video-radio-url">URL</label></div>
                        <div class="dialog-field-input"><input type="text" class="text" id="insert-video-url" name="insert_video_url" size="40" /></div>
                        <div class="dialog-field-notes">Enter the URL for a video on YouTube, Vimeo, etc and we'll insert the player into your post.</div>
                    </div>
                </div>
                <div class="dialog-section-number"><input type="radio" id="insert-video-radio-html" name="insert_video" value="html" class="rb" /></div>
                <div class="dialog-section-content">
                    <div class="dialog-field">
                        <div class="dialog-field-header"><label for="insert-video-radio-html">Embed</label></div>
                        <div class="dialog-field-input"><textarea id="insert-video-html" name="insert_video_html" rows="6" cols="40" class="ta"></textarea></div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script type="text/javascript">
YAHOO.util.Event.onDOMReady( function() {
    var d = new YAHOO.widget.Dialog( 'upload-audio-wait', {
        width: '240px',
        fixedcenter: true,
        close: false,
        draggable: false,
        zindex: 5,
        modal: true,
        visible: false,
        buttons: [ {
            text: 'Cancel',
            handler: function() {
                YAHOO.util.Connect.abort( window.activeAsyncRequest );
                this.hide();
            },
            isDefault: false
        } ]
    } );
    d.render();
    TC.dialogs.uploadAudioWait = d;
} );
</script>

<div id="upload-audio-wait">
    <div class="hd">Uploading, please wait...</div>
    <div class="bd">
        <center><img src="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/ipb.gif" /></center>
    </div>
</div>


<script type="text/javascript">
( function() {
    var Event = YAHOO.util.Event,
        Dom   = YAHOO.util.Dom;

    var AUDIO_EXT = /\.mp3$/;

    Event.onDOMReady( function() {
        var d = new TC.EditorDialog( 'insert-audio-dialog', {
            buttons: [
                {
                    text: 'Cancel',
                    handler: function() { this.hide() },
                    isDefault: false
                },
                {
                    text: 'Upload File',
                    handler: function() {
                        var _this = this;

                        TC.dialogs.uploadAudioWait.show();
                        YAHOO.util.Connect.setForm( this.form, true );

                        window.activeAsyncRequest = YAHOO.util.Connect.asyncRequest( 'POST', 'http://www.typepad.com/services/upload_file', {
                            upload : function( o ) {
                                TC.dialogs.uploadAudioWait.hide();
                                TC.dialogs.uploadAudio.hide();

                                var res = YAHOO.lang.JSON.parse( o.responseText );
                                var status = res.rsp.stat;
                                switch ( status ) {
                                    case 'ok':
                                        var xid = res.rsp.photoid[ 0 ]._content;
                                        var format = Dom.get('insert-audio-input').value.match( AUDIO_EXT ) ? 'small' : 'text';
                                        doMethod( 'Library.Asset.AsEnclosure', { asset_ids: [ xid ], args: { format: format } }, function(o) {
                                            _this.insertHTML( o.items.join('') + '<br />\n\n' );
                                            Dom.get('insert-audio-input').value = '';
                                        } );
                                        break;
                                    case 'fail':
                                        var err = res.rsp.err;
                                        if ( err ) {
                                            if ( err.code == 6 && TC.dialogs.quotaExceeded )
                                                TC.dialogs.quotaExceeded.show();
                                            else
                                                alert( err.msg );
                                        } else {
                                            alert( 'Upload failed.' );
                                        }
                                        break;
                                    default:
                                        alert( 'unknown status: ' + status );
                                        break;
                                }
                            }
                        }, 'format=js&response_type=full'  );
                    },
                    isDefault: true
                }
            ]
        } );
        d.render();
        TC.dialogs.uploadAudio = d;
    } );
} )();
</script>

<div id="insert-audio-dialog">
    <div class="hd">Upload an Audio File</div>
    <div class="bd">
        <form method="post" enctype="multipart/form-data" action="http://www.typepad.com/services/upload_file">
            <input type="hidden" name="token" id="insert-audio-token" value="1369892384-b48b33831fce299defde04595b7a9b826aa257a9" />
            <input type="hidden" name="parent_path" value="/files/" />
            <input type="hidden" name="upload_as.user" value="6p00e553e168978833" />
            <input type="hidden" name="upload_as.scope" value="collection" />
            <input type="hidden" name="upload_as.scope_id" value="64550114806564916" />
            <div class="dialog-section">
                <div class="dialog-field">
                    <div class="dialog-field-content"><input type="file" id="insert-audio-input" name="file" /></div>
                    <div class="dialog-field-notes">MP3s will display an inline audio player. Other formats will display a link to download.</div>
                </div>
            </div>
        </form>
    </div>
</div>


<script type="text/javascript">
YAHOO.util.Event.onDOMReady( function() {
    var d = new YAHOO.widget.Dialog( 'quota-exceeded-dialog', {
        width: '350px',
        fixedcenter: true,
        close: false,
        draggable: false,
        zindex: 4,
        modal: true,
        visible: false,
        buttons: [ { text: "Close", handler: function() { this.cancel() }, isDefault:true } ]
    } );
    d.render();

    TC.dialogs.quotaExceeded = d;
} );
</script>

<div id="quota-exceeded-dialog" style="visibility:hidden;">
    <div class="hd">Upload failed</div>
    <div class="bd">
        <p>Some of the files you are trying to upload exceed your monthly upload quota of 0B per month and cannot be added. The maximum amount of data you can upload through the end of the month is 0B. Alternatively, you can <a href="https://www.typepad.com/secure/account/info/upgrade">upgrade to a higher TypePad plan</a>.</p>
    </div>
</div>


<script type="text/javascript">
( function() {
    var Event = YAHOO.util.Event,
        Dom   = YAHOO.util.Dom;

    var insertLink = function( dialog ) {
        var f = dialog.form;

        var attrs = {
            href: f.url.value,
            title: f.title.value,
            target: f.target.checked ? f.target.value : '_self'
        };

        if ( Dom.hasClass( 'link-text', 'hidden' ) ) {
            dialog.execCommand( 'mceInsertLink', false, attrs );
        } else {
            var link = '<a href="' + attrs.href + '" title="' + attrs.title + '" target="' + attrs.target + '">' + f.text.value + '</a>';
            dialog.execCommand( 'mceInsertContent', false, link );
        }


        /* Place the cursor at the end of the selected word, collapsing
           the selection. This fixes an issue in FF where the selection
           doesn't get refreshed until it's reselected. */
        dialog.editor.focus();
        dialog.editor.selection.collapse();
    };

    Event.onDOMReady( function() {
        var d = new TC.EditorDialog( 'insert-link-dialog', {
            buttons: [
                {
                    text: 'Cancel',
                    handler: function() { this.hide() },
                    isDefault: false
                },
                {
                    text: 'Insert Link',
                    handler: function() {
                        insertLink( this );
                        this.hide();
                    },
                    isDefault: true
                }
            ]
        } );

        d.showEvent.subscribe( function( type, args, me ) {
            this.restoreSelection();

            var ed = this.editor,
                el = ed.dom.getParent( ed.selection.getNode(), 'A' );

            if ( !el && ed.selection.isCollapsed() ) {
                // show
                Dom.removeClass( 'link-text', 'hidden' );
                this.form.text.focus();
            } else {
                // hide
                Dom.addClass( 'link-text', 'hidden' );
                this.form.url.focus();
            }

            if ( el ) {
                this.form.url.value = ed.dom.getAttrib( el, 'href' );
                this.form.title.value = ed.dom.getAttrib( el, 'title' );
                this.form.target.checked = ed.dom.getAttrib( el, 'target' ) == '_blank' ? true : false;
            } else {
                this.form.text.value = '';
                this.form.url.value = '';
                this.form.title.value = '';
                this.form.target.checked = false;
            }

        } );

        d.render();
        TC.dialogs.insertLink = d;
    } );
} )();
</script>

<div id="insert-link-dialog">
    <div class="hd">Insert Link</div>
    <div class="bd">
        <form onSubmit="return false;">
            <div class="dialog-section pkg">
                <div id="link-text" class="dialog-section-content hidden">
                    <div class="dialog-field">
                        <div class="dialog-field-header"><label for="insert-link-text-input">Link Text</label></div>
                        <div class="dialog-field-input"><input type="text" class="text" id="insert-link-text-input" name="text" size="40" /></div>
                    </div>
                </div>

                <div class="dialog-section-content">
                    <div class="dialog-field">
                        <div class="dialog-field-header"><label for="insert-link-url-input">URL</label></div>
                        <div class="dialog-field-input"><input type="text" class="text" id="insert-link-url-input" name="url" size="40" /></div>
                    </div>
                </div>

                <div class="dialog-section-content">
                    <div class="dialog-field">
                        <div class="dialog-field-header"><label for="insert-link-title-input">Link Title</label></div>
                        <div class="dialog-field-input"><input type="text" class="text" id="insert-link-title-input" name="title" size="40" /></div>
                    </div>
                </div>

                <div class="dialog-section-content">
                    <div class="dialog-field">
                        <div class="dialog-field-input"><label><input type="checkbox" name="target" value="_blank" /> Open in a new window</label></div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script type="text/javascript">
// SETTINGS:
// invisible img tag in editor
// uncomment for final
IMG_PLACEHOLDER_ID = 'image_placeholder';

RUID = '';

user = {
    xid: '6p00e553e168978833',
    max_image_edit_size: '1200',
};

blog = {
    xid: '6a00e553e16897883300e553fcc7418834',
};
/*
Basic: Limit to 800px in max dimension. When editing image of >800px in max dimension,
       options are Upgrade to Premium or downscale image to the limit.
Plus: Limit to 800px in max dimension. When editing image of >800px in max dimension,
       options are Upgrade to Premium or downscale image to the limit.
Unlimited: Limit to 1200px in max dimension. When editing image of >1200px in max
       dimension, options are Upgrade to Premium or downscale image to the limit.
Premium: Allow user to edit any size of image but provide a warning when the image is
       >2000px and ask if we can downsize the image to 2000px. The warning is to let the
       user know that the editor may take a while to make their edits.
Business Class: Allow user to edit any size of image but provide a warning when the image
       is >2000px and ask if we can downsize the image to 2000px. The warning is to
       let the user know that the editor may take a while to make their edits.
*/
AVIARY_TIMEOUT_ID=0;
AVIARY_GETASSET_TRIES=0;
AVIARY_GETASSET_MAXTRIES=15;
</script>

<script type="text/javascript">
    function log(msg) {
         window.console && window.console.log && console.log(msg);
    }

    function getAviaryAsset(user_xid, ruid, callback) {
        log('Aviary saved, getting asset for RUID: ' + ruid);

        client.request({
            method: 'Aviary.GetAsset',
            params: { user: user_xid, ruid: ruid },
            callback: function( r ) {
                log(r);
                if ( r.error ) {
                    log('ERROR: ' + r.error);
                    alert( 'Something went wrong.');
                } else if (r.result.XID==null) {
                    log("getAviaryAsset("+user_xid+", "+ruid+") @ 2000");
                    if (AVIARY_GETASSET_TRIES > AVIARY_GETASSET_MAXTRIES) {
                        alert("There was an error or timeout trying to save your image.\nYou may try saving again or cancel.");
                        return;
                    }
                    AVIARY_TIMEOUT_ID = setTimeout(function(){
                        getAviaryAsset(user_xid,ruid);
                        AVIARY_GETASSET_TRIES += 1;
                    }, 2000.0);
                } else {
                    log('Got Aviary asset, updating editor');
                    // get XID back
                    var xid = r.result.XID;
                    log("Got XID: " + xid);

                    YAHOO.util.Dom.get('edit-image-dialog-xid').value = xid;
                    var d = TC.dialogs.editImage;
                    d.updateImage(xid);
                    AVIARY_GETASSET_TRIES = 0;

                    var btn = TC.dialogs.editImage.getButtons()[1];
                    btn.innerHTML = 'Update Image';
                    btn.removeAttribute('disabled');
                    YAHOO.util.Dom.removeClass(btn, 'disabled');
                }
            }
        });
    }

    function typeOf(value) {
        var s = typeof value;
        if (s === 'object') {
            if (value) {
                if (Object.prototype.toString.call(value) == '[object Array]') {
                    s = 'array';
                }
            } else {
                s = 'null';
            }
        }
        return s;
    }

    function initFeather() {
        if (typeof(Aviary)=='undefined') return;
        featherEditor = new Aviary.Feather({
            apiKey: 'f77694d11',
            apiVersion: '2',
            openType: 'inject',
            theme: 'typepad',

            tools: ['enhance', 'effects','orientation','crop','redeye',
                    'saturation','brightness','contrast','blemish',
                    'drawing','text','stickers','whiten','sharpness'],

            // set to 800 for next aviary release
            maxSize: 418,
            // un-comment for next aviary release
            // maxEditSize: 460,
            cropPresets: [
                             '320x240','640x480','800x600','1280x1024','1600x1200',
                             '240x320','480x640','600x800','1024x1280','1200x1600',
                             'Original',
                             ['Square', '1:1'],
                             'Custom',
                             '3:2', '3:5', '4:3', '4:6', '5:7', '8:10', '16:9'
                         ],
            noCloseButton: true,
            appendTo: 'feather',
            // comment on next aviary release
            forceFlash: false,
            postUrl: 'http://www.typepad.com/services/aviary_postback',

            onLoad: function() {},

            onSave: function(id, url, hiresUrl) {
                log("onSave: " + id + " url: " + url + " hiresUrl: " + hiresUrl);

                getAviaryAsset(user.xid, RUID);
            },

            onError: function (errObj) {
                log(errObj);
            }
        });
    }

    function launchEditor(imageid, appendTo) {
        var src = document.getElementById(imageid).src;
        client.request({
            method: 'Aviary.MakeRuidForUser',
            params: { user: user.xid },
            callback: function( r ) {
                if ( r.error ) {
                    log('ERROR: ' + r.error);
                    alert( 'Something went wrong.');
                } else {
                    log(r.result);
                    // get RUID back
                    RUID = r.result.RUID;
                    log('Got RUID: ' + RUID);
                    featherEditor.launch({
                        image: imageid,
                        url: src,
                        hiresUrl: src,
                        appendTo: appendTo,
                        postData: JSON.stringify({ user: user.xid, ruid: RUID, blog: blog.xid })
                    });
                    log('Got blog id: '+ blog.xid);
                }
            }
        });

    }

    YAHOO.util.Get.script('http://feather.aviary.com/js/feather.js', {
        onSuccess: function() {
            YAHOO.util.Event.onDOMReady(initFeather);
        },
        onFailure: function() {
            alert('Failed to load image editor');
        }
    });

</script>

<script type="text/javascript">
( function() {
    var Event = YAHOO.util.Event,
        Dom   = YAHOO.util.Dom;

    var EditImageDialog = function() {
        EditImageDialog.superclass.constructor.apply( this, arguments );
        this.colorPicker = null;
    };

    YAHOO.extend( EditImageDialog, TC.EditorDialog, {
        // Prevent the caption field from getting focused for IEs.
        _focusOnShow: function() {},

        setAlignment: function( align ) {
            this.form.align.value = align;
            log('setAlignment align: ' + align);
            Dom.getElementsByClassName( 'align-img', 'a', 'align-edit-image', function( el ) {
                var thisAlign = el.getAttribute( 'tp:imgalign' );
                if ( thisAlign == align ) {
                    el.firstChild.src = "http://static.typepad.com/.shared:va84928f:typepad:en_us/images/img-" + thisAlign + "-active.gif";
                } else {
                    el.firstChild.src = "http://static.typepad.com/.shared:va84928f:typepad:en_us/images/img-" + thisAlign + ".gif";
                }
            } );
        },

        setCaption: function (caption) {
            // set form value for saving later
            // this.form.caption.value = caption;
            // find the caption div/span and update
        },

        checkForCustomSize: function( format ) {
            if( format == 'custom' ) {
                Dom.removeClass( 'edit-image-custom-image-width', 'hidden' );
            } else {
                Dom.addClass( 'edit-image-custom-image-width', 'hidden' );
            }
        },

        checkForTextLink: function( format ) {
            if( format == 'text' ) {
                Dom.addClass( 'align-edit-image', 'hidden' );
                Dom.addClass( 'edit-image-description', 'hidden' );
                Dom.addClass( 'edit-image-border', 'hidden' );
            } else {
                Dom.removeClass( 'align-edit-image', 'hidden' );
                Dom.removeClass( 'edit-image-description', 'hidden' );
                Dom.removeClass( 'edit-image-border', 'hidden' );
            }
        },

        extractXid: function( el ) {
            var m = el.getAttribute( 'src' ).match( /(6a[0-9a-f]{32})\-(?:\d+)?[pw]i$/ );
            return m ? m[1] : null;
        },

        oldResetForm: function( el ) {
            var f = this.form,
                anchor = this.editor.dom.getParent( el, 'A' );

            /* Image xid */
            f.xid.value = this.extractXid( el );

            /* Size */
            var size;
            if ( el.style.width ) {
                size = 'custom';
                f.width.value = parseInt( el.style.width );
            } else {
                var m = el.getAttribute( 'src' ).match( /\-(\d+)?[pw]i$/ );

                /* Treat an empty "-pi" as full size. */
                if ( m && ( m[1] == undefined ) ) {
                    size = 'full';
                } else {
                    switch( m[1] ) {
                        case '800':
                            size = 'full';
                            break;
                        case '500':
                            size = 'large';
                            break;
                        case '320':
                            size = 'medium';
                            break;
                        case '120':
                            size = 'small';
                            break;
                        default:
                            size = 'custom';
                            f.width.value = parseInt( m[1] );
                            break;
                    }
                }
            }
            for ( var i = f.size.length; i--; ) {
                if ( f.size.options[i].value == size ) {
                    f.size.options[i].selected = true;
                } else {
                    f.size.options[i].selected = false;
                }
            }
            this.checkForCustomSize( f.size.value );
            this.checkForTextLink( f.size.value );

            /* Position */
            if ( el.style.display == 'block' ) {
                this.setAlignment( 'center' );
            } else if ( anchor && anchor.style.float != '' ) {
                this.setAlignment( 'float' + anchor.style.float );
            } else {
                this.setAlignment( 'none' );
            }

            /* Description/alt text */
            f.alt.value = el.getAttribute( 'alt' );

            /* caption text */
            var caption_id = 'caption-xid-' + f.xid.value;
            var caption_el = ed.dom.get( caption_id );
            f.caption.value = caption_el ? caption_el.innerHTML : "";

            /* Popup */
            if ( anchor && anchor.getAttribute( 'href' ).match( /-popup$/ ) ) {
                f.popup.checked = true;
            } else {
                f.popup.checked = false;
            }

            /* Border; note that we just use the left border since our
               interface allows only editing all border settings at once. */
            var width = parseInt( el.style.borderLeftWidth );
            f.border_width.value = width > 0 ? width : 0;
            f.border_style.value = el.style.borderLeftStyle;
            f.border_color.value = Dom.Color.toHex( el.style.borderLeftColor || '#000000' ).toUpperCase();
            if ( f.border_width.value > 0 ) {
                Dom.removeClass( 'edit-image-border-options', 'hidden' );
            } else {
                Dom.addClass( 'edit-image-border-options', 'hidden' );
            }
        },

        resetForm: function( el ) {
            var f = this.form,
                anchor = this.editor.dom.getParent( el, 'A' ),
                wrapper = this.editor.dom.getParent( el, 'DIV');

            /* Setup Image preview */
            var imgSrc = el.getAttribute( 'src' );
            var full_src = imgSrc.replace(/\-\d+?[pw]i$/,'');

            var img = document.getElementById(IMG_PLACEHOLDER_ID);
            img.src = full_src;

            var feather_preview_onclick;

            TC.callbacks.imageResizeConfirm = {
                handleImageEditResize: function( image ) {
                    /*
                    here's the decision point
                    two paths:
                        * the image is < 1024 pixels: load it!
                        * the image is > 1024 pixels: load the static resources and confirm in
                            onClick
                    */

                    var width = image.imageLink.width;
                    var height = image.imageLink.height;
                    log('editing image: ' + width + 'x' + height);
                    var maxdim = width > height ? width : height;
                    // debugger;
                    var max_image_edit_size = user.max_image_edit_size;
                    log("got max_image_edit_size: " + max_image_edit_size + " for user");
                    smallsrc = getsrcforsize(src, 500);

                    var preview_el = YAHOO.util.Dom.get('feather-preview');
                    var preview_img_el = YAHOO.util.Dom.get('feather-preview-image');
                    YAHOO.util.Dom.setAttribute(preview_img_el, 'src', smallsrc);

                    if (max_image_edit_size==0 && maxdim > 2000) {
                        // user is unlimited
                        feather_preview_onclick = Event.on(preview_el,
                            'click', function(evt) {
                                log('showing image resize confirm');
                                TC.dialogs.imageResizeConfirmPremium.show()
                        });
                        YAHOO.util.Dom.removeClass('feather-preview', 'hidden');

                    } else if ( max_image_edit_size!=0 && maxdim > max_image_edit_size ) {
                        feather_preview_onclick = Event.on(preview_el, 'click', function(evt) {
                            log('showing image resize confirm');
                            TC.dialogs.imageResizeConfirm.show()
                        });
                        // i miss jQuery().show/hide()
                        YAHOO.util.Dom.removeClass('feather-preview', 'hidden');
                    } else {
                        YAHOO.util.Dom.addClass('feather-preview', 'hidden');
                        launchEditor(IMG_PLACEHOLDER_ID, 'feather');
                    }
                },

                handleSubmit: function( d ) {
                    var max_image_edit_size = user.max_image_edit_size;
                    log('user requests to resize image: reload with '+max_image_edit_size+'pi image to feather');
                    // what's the image we're editing
                    var src = document.getElementById(IMG_PLACEHOLDER_ID).src;

                    // get lower-res version (max of 1024)
                    src = getsrcforsize(src, max_image_edit_size);
                    log('new src for feather editor: ' + src);

                    // set placeholder img to the new lower-res src
                    document.getElementById(IMG_PLACEHOLDER_ID).src = src;

                    // let's do this thing!
                    launchEditor(IMG_PLACEHOLDER_ID, 'feather');

                    // hide the static preview
                    YAHOO.util.Dom.addClass('feather-preview', 'hidden');
                    Event.removeListener("feather-preview", "click", feather_preview_onclick);

                    TC.dialogs.imageResizeConfirm.hide();
                },

                handleCancel: function() {
                    log('user cancels resize image: do not reload feather editor');
                    TC.dialogs.imageResizeConfirm.hide();
                },

                handleUpgrade: function() {
                    log('user upgrades!');
                    window.open('http://www.typepad.com/secure/account/info/upgrade?edit_image_options=true');
                    TC.dialogs.imageResizeConfirm.hide();
                },
            }

            TC.callbacks.imageResizeConfirmPremium = {
                handleSubmit: function( d ) {
                    log('user requests to edit image resized');

                    // what's the image we're editing
                    var src = document.getElementById(IMG_PLACEHOLDER_ID).src;

                    // get lower-res version (max of 1024)
                    src = getsrcforsize(src, 2000);
                    log('new src for feather editor: ' + src);

                    // set placeholder img to the new lower-res src
                    document.getElementById(IMG_PLACEHOLDER_ID).src = src;

                    // let's do this thing!
                    launchEditor(IMG_PLACEHOLDER_ID, 'feather');

                    // hide the static preview
                    YAHOO.util.Dom.addClass('feather-preview', 'hidden');
                    Event.removeListener("feather-preview", "click", feather_preview_onclick);

                    TC.dialogs.imageResizeConfirmPremium.hide();
                },

                handleCancel: function() {
                    log('user cancels resize image, edit full size');

                    // let's do this thing!
                    launchEditor(IMG_PLACEHOLDER_ID, 'feather');

                    // hide the static preview
                    YAHOO.util.Dom.addClass('feather-preview', 'hidden');
                    Event.removeListener("feather-preview", "click", feather_preview_onclick);
                    TC.dialogs.imageResizeConfirmPremium.hide();
                }
            }

            // Remove the strange border on the selected image.
            if (tinymce.isIE9) {
                tinymce.DOM.getRoot().document.body.focus();
                this.getButtons()[0].focus();
            }

            if (!wrapper || !wrapper.className.match(/photo\-wrap/)) {
                // grab form values from the old-style HTML,
                // but will be replaced with new-style HTML
                this.oldResetForm(el);
                this.handleDefaultTextValue('reset');

                // AVIARY
                var src = document.getElementById(IMG_PLACEHOLDER_ID).src;
                if (typeof(featherEditor)!="undefined") {
                    typepad.assets.get({
                        id: f.xid.value,
                        success: TC.callbacks.imageResizeConfirm.handleImageEditResize,
                        error: function (textStatus, err) {
                            log(err);
                        }
                    });
                }
                return;
            }

            /* Image xid */
            f.xid.value = this.extractXid( el );

            /* Size */
            var size;
            if ( el.style.width ) {
                size = 'custom';
                f.width.value = parseInt( el.style.width );
            } else {
                var m = el.getAttribute( 'src' ).match( /\-(\d+)?[pw]i$/ );

                /* Treat an empty "-pi" as full size. */
                if ( m && ( m[1] == undefined ) ) {
                    size = 'full';
                } else {
                    switch( m[1] ) {
                        case '800':
                            size = 'full';
                            break;
                        case '500':
                            size = 'large';
                            break;
                        case '320':
                            size = 'medium';
                            break;
                        case '120':
                            size = 'small';
                            break;
                        default:
                            size = 'custom';
                            f.width.value = parseInt( m[1] );
                            break;
                    }
                }
            }
            if (el.style.width) log ('image style width: ' + el.style.width);
            log('image size: ' + size);
            log('image width: ' + f.width.value);

            for ( var i = f.size.length; i--; ) {
                if ( f.size.options[i].value == size ) {
                    f.size.options[i].selected = true;
                } else {
                    f.size.options[i].selected = false;
                }
            }
            this.checkForCustomSize( f.size.value );
            this.checkForTextLink( f.size.value );
            log(wrapper);
            log("wrapper display val: " + wrapper.style.display);
            var wrap_float = YAHOO.util.Dom.getStyle(wrapper, 'float');
            log("wrapper float val: " + wrap_float);

            /* Position */
            if ( wrapper.style.display == 'block' ) {
                this.setAlignment( 'center' );
            } else if ( wrap_float && wrap_float != '' ) {
                this.setAlignment( 'float' + wrap_float );
            } else {
                this.setAlignment( 'none' );
            }

            /* Description/alt text */
            f.alt.value = el.getAttribute( 'alt' );

            /* caption text */
            var caption_id = 'caption-xid-' + f.xid.value;
            var caption_el = ed.dom.get( caption_id );
            f.caption.value = caption_el ? caption_el.innerHTML : "";

            /* Popup */
            if ( anchor && anchor.getAttribute( 'href' ).match( /-popup$/ ) ) {
                f.popup.checked = true;
            } else {
                f.popup.checked = false;
            }

            /* Border; note that we just use the left border since our
               interface allows only editing all border settings at once. */
            var width = parseInt( el.style.borderLeftWidth );
            f.border_width.value = width > 0 ? width : 0;
            f.border_style.value = el.style.borderLeftStyle;
            f.border_color.value = Dom.Color.toHex( el.style.borderLeftColor || '#000000' ).toUpperCase();
            if ( f.border_width.value > 0 ) {
                Dom.removeClass( 'edit-image-border-options', 'hidden' );
            } else {
                Dom.addClass( 'edit-image-border-options', 'hidden' );
            }

            this.handleDefaultTextValue('reset');

            // AVIARY
            var src = document.getElementById(IMG_PLACEHOLDER_ID).src;

            function getsrcforsize (src, size) {
                suffix = '-'+size+'pi';
                log(src + " -- new suffix: " + suffix);
                if (! src.match(/-\d+[wp]i$/) ) {
                    src = src + suffix;
                }
                else {
                    src = src.replace(/-\d+[wp]i$/, suffix);
                }
                log('returning src: ' + src);
                return src;
            }

            if (typeof(featherEditor)!="undefined") {
                typepad.assets.get({
                    id: f.xid.value,
                    success: TC.callbacks.imageResizeConfirm.handleImageEditResize,
                    error: function (textStatus, err) {
                        log(err);
                    }
                });
            }
        },

        handleDefaultTextValue: function(mode) {
            Dom.getElementsBy(
                function(el) {
                    return el.getAttribute('at:default-value') ? 1 : 0;
                },
                'input',
                'edit-image-dialog',
                function(el) {
                    var text = el.getAttribute('at:default-value');

                    switch(mode) {
                        case 'init':
                            Event.on(el, 'focus', function(evt) {
                                Dom.removeClass(el, 'input-default');
                                if (this.value == text)
                                    this.value = '';
                            });
                            Event.on(el, 'blur', function(evt) {
                                if (this.value == '') {
                                    Dom.addClass(el, 'input-default');
                                    this.value = text;
                                }
                            });
                            break;
                        case 'reset':
                            if (el.value == '') {
                                el.value = text;
                                Dom.addClass(el, 'input-default');
                            } else {
                                Dom.removeClass(el, 'input-default');
                            }
                            break;
                        case 'clear':
                            // Clear before a default value gets captured by getData()
                            if (el.value == text)
                                el.value = '';
                            break;
                    }
                }
            );
        },

        getFormattingOptions: function() {
            this.handleDefaultTextValue('clear');
            var d = this.getData();
            var opt = {
                mode: 'edit',
                format: d.size[ 0 ],
                align: d.align,
                popup: d.popup,
                description: d.alt,
                caption: d.caption // no trailing comma for IE
            };
            if ( opt.format == 'custom' ) {
                opt.width = d.width;
            }
            if ( d.border_width > 0 ) {
                opt.border = {
                    width: parseInt( d.border_width ),
                    style: d.border_style[0],
                    color: d.border_color
                };
            }
            return opt;
        },

        saveImage: function() {
           // click hidden feather save button
            var btn = this.getButtons()[1];
            Dom.setAttribute(btn, 'disabled', 'disabled');
            Dom.addClass(btn, 'disabled');
            btn.innerHTML = 'Saving...';

            var feather_save = document.getElementById('avpw_save_button'); // save!
            if (feather_save) {
                YAHOO.util.UserAction.click(feather_save);
            }
        },

        updateImage: function(xid) {
            var options = this.getFormattingOptions();
            var _this = this;

            // get img src
            var new_url = document.getElementById(IMG_PLACEHOLDER_ID).src;

            // update editor image with new content
            client.request( {
                method: 'Library.Asset.AsEnclosure',
                params: { asset_ids: [ xid ], args: options },
                callback: function( r ) {
                    if ( r.error ) {
                        log(r);
                        log('ERROR: ' + r.error);
                        alert( 'Something went wrong.' );
                    } else {

                        var ed = _this.editor,
                            el, anchor, newEl;

                        // restoreSelection does not work for IE for some reason.
                        if (tinymce.isIE9) {
                            var els = YAHOO.util.Dom.getChildrenBy(
                                YAHOO.util.Dom.get(_this.bookmark.rng.startContainer),
                                function( el ){
                                    // This may need to be more precise.
                                    if( el.nodeName == "IMG" ) return true;
                                }
                            );
                            if (els.length) {
                                el = els[0];
                            } else {
                                alert('Something went wrong.');
                                return;
                            }
                        } else if (tinymce.isIE) {
                            el = _this.bookmark.rng.item(0);
                        } else {
                            _this.restoreSelection();
                            el = ed.selection.getNode();
                        }

                        if ( anchor = ed.dom.getParent( el, 'A' ) ) {
                           el = anchor;
                        }

                        items = r.result.items;

                        var replace_el = ed.dom.getParent(el, 'div.photo-wrap'); // new-style div wrapper
                        if (!replace_el) {
                            // el has already been assigned the <a> if it exists
                            // now assign the wrapper div if it exists
                            replace_el = el
                        }
                        ed.dom.setOuterHTML( replace_el, items.join( '\n\n' ) );

                        var new_el = ed.dom.select('.photo-xid-'+xid);
                        if (new_el==null) {
                            new_el = ed.dom.select('.at-xid-'+xid);
                            if ( a_el = ed.dom.getParent( el, 'A' ) ) {
                                new_el = a_el;
                            }
                        }

                        tinymce.activeEditor.plugins.typepad._add_div_events(new_el);

                        ed.undoManager.add();

                        var new_el = ed.dom.get('photo-xid-'+xid);
                        if (new_el==null) {
                            new_el = ed.dom.select('.at-xid-'+xid);
                            if ( a_el = ed.dom.getParent( new_el, 'A' ) ) {
                                new_el = a_el;
                            }
                        }
                        if (typeOf(new_el)=='array') {
                            new_el = new_el[0];
                        }
                        if (new_el.className.match('photo-xid-')) {
                            tinymce.activeEditor.plugins.typepad._add_div_events(new_el);
                        }

                        _this.hide();
                        if (typeof(featherEditor)!="undefined") {
                            log('closing feather');
                            featherEditor.close(true); // true doesn't fade #ocd
                        }
                    }
                }
            } );
        }
    } );

    Event.onDOMReady( function() {
        var d = new EditImageDialog( 'edit-image-dialog', {
            width: "770px",
            fixedcenter: "contained",
            buttons: [
                {
                    text: 'Cancel',
                    handler: function() {
                        this.hide();
                        if (typeof(featherEditor)!="undefined") {
                            featherEditor.close(); // true doesn't fade #ocd
                        }
                        if (AVIARY_TIMEOUT_ID) {
                            clearTimeout(AVIARY_TIMEOUT_ID);
                        }
                        var btn = this.getButtons()[1];
                        if (btn.innHTML=='Saving...') {
                            Dom.setAttribute(btn, 'disabled', '');
                            Dom.addClass(btn, '');
                            btn.innerHTML = 'Update Image';
                        }
                    },
                    isDefault: false
                },
                {
                    text: 'Update Image',
                    handler: function() {
                        // If the color panel is open, close that
                        if (document.getElementById('edit-image-border-color-panel_c')) {
                              document.getElementById('edit-image-border-color-panel_c').style.visibility="hidden";
                        }
                        // triggers Feather_OnSave which saves the image, then calls
                        // library/asset/external_image
                        var should_save = false;
                        try {
                            if (typeof(Aviary)!='undefined' && Aviary.paintWidgetInstance.dirty) {
                               should_save = true;
                            }
                        } catch (e) {}
                        if (should_save) {
                            this.saveImage();
                        } else {
                            // get the xid of the original image here
                            xid = YAHOO.util.Dom.get('edit-image-dialog-xid').value;
                            this.updateImage(xid);
                        }
                    },
                    isDefault: true
                }
            ]
        } );

        d.render();
        TC.dialogs.editImage = d;

        d.colorPicker = typepad.colorPicker( 'edit-image-border-color', {
            context: [ 'edit-image-border-width', 'bl', 'tl' ],
            zindex: 10000
        } );

        d.showEvent.subscribe( function( type, args, me ) {
            this.restoreSelection();

            /* Get the selected image, and use it to initialize the dialog. */
            var el = this.editor.selection.getNode();
            this.resetForm( el );
        } );

        d.handleDefaultTextValue('init');

        Event.on( 'edit-image-size', 'change', function( evt ) {
            d.checkForCustomSize( this.value );
            d.checkForTextLink( this.value );
        } );

        Dom.getElementsByClassName( 'align-img', 'a', 'align-edit-image', function( el ) {
            Event.on( el, 'click', function( evt ) {
                Event.stopEvent( evt );
                d.setAlignment( el.getAttribute( 'tp:imgalign' ) );
            } );
        } );

        Event.on( 'edit-image-border-width', 'change', function( evt ) {
            if ( this.value > 0 ) {
                Dom.removeClass( 'edit-image-border-options', 'hidden' );
            } else {
                Dom.addClass( 'edit-image-border-options', 'hidden' );
            }
        } );
    } );

    Event.onDOMReady( function() {
        var d = new YAHOO.widget.Dialog( 'image-resize-confirm', {
            width: '320px',
            fixedcenter: true,
            close: false,
            draggable: false,
            zindex: 200020,
            modal: true,
            visible: false,
            buttons: [
                {
                    text: 'Cancel',
                    handler: function() {
                        TC.callbacks.imageResizeConfirm.handleCancel();
                    }
                },
                {
                    text: 'Upgrade',
                    handler: function() {
                        TC.callbacks.imageResizeConfirm.handleUpgrade();
                    },
                    isDefault: true
                },
                {
                    text: 'Resize Image',
                    handler: function() {
                        TC.callbacks.imageResizeConfirm.handleSubmit( this.getData() );
                    },
                    isDefault: true
                }
            ]

        });

        d.render();

        TC.dialogs.imageResizeConfirm = d;

        var d2 = new YAHOO.widget.Dialog( 'image-resize-confirm-premium', {
            width: '300px',
            fixedcenter: true,
            close: false,
            draggable: false,
            zindex: 200020,
            modal: true,
            visible: false,
            buttons: [ { text: 'Ignore', handler: function() { TC.callbacks.imageResizeConfirmPremium.handleCancel(); } },
                       { text: 'Resize', handler: function() { TC.callbacks.imageResizeConfirmPremium.handleSubmit( this.getData() ); }, isDefault: true } ]
        } );
        d2.render();
        TC.dialogs.imageResizeConfirmPremium = d2;
    } );
} )();
</script>

<style type="text/css">

.yui-skin-tp2 .yui-panel {
    border:none;
}

.yui-skin-tp2 .yui-dialog {
    -webkit-border-radius: 3px;
    -moz-border-radius: 3px;
    border-radius: 3px;
}

.yui-skin-tp2 .yui-dialog .hd {
    -webkit-border-top-left-radius: 4px;
    -webkit-border-top-right-radius: 4px;
    -moz-border-radius-topleft: 4px;
    -moz-border-radius-topright: 4px;
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
    background: none; /* reset */
    background-color: #d5e9f5;
    border: none;
    height: 34px;
    font-weight: 500;
    font-size: 1.4em;
    color: #333;
}

.yui-picker-controls .hd {
    height: 0px !important;
}

.yui-skin-tp2 .yui-dialog .ft button {
    border: none;
    background: none;
    color: #287098;
    font-size: 13px;
    font-family: Helvetica, Arial, sans-serif;
}

.yui-skin-tp2 .yui-dialog .ft button.default {
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    border-radius: 5px;
    border: 1px solid #ff9900;
    background-color: #fc3;
    padding: 4px 10px;
    color: #442200;
    font-weight: 500;
    text-shadow: #ffff00 1px -1px 2px;
    background-image: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#FFCA00), to(#FF9900));
    background-image: -moz-linear-gradient(100% 90deg,#FFCA00, #FF9900);
    /* Button - #FFCA00 to #FF9900 // Stroke: #ff9900  */
}
.yui-skin-tp2 .yui-dialog .ft button.default.disabled] {
    background-image: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#eee), to(#ccc));
    background-image: -moz-linear-gradient(100% 90deg,#eee, #ccc);

}

.yui-skin-tp2 .yui-panel .hd, .yui-skin-tp2 .yui-panel .bd,
.yui-skin-tp2 .yui-panel .ft {
    border: none;
}

.photo-wrap {
    position:relative;
}
.photo-wrap .edit-button {
    display:block;
    position: fixed;
    top: -9999px;
    left: -9999px;
}
.photo-wrap:hover .edit-button {
    position: absolute;
    z-index: 1;
    top: 10px;
    left: 10px;
}

.edit-image-options {
    background-color: #E8F2F7;
    margin-top: 10px;
}

.edit-image-option-column {
    width: 49%;
    float: left;
}

.yui-skin-tp2 .yui-dialog #edit-image-dialog .field-contents {
    display: inline;
    float: left;
    width: 220px;
}

#edit-image-caption input[type=text],
#edit-image-description input[type=text]{
    width: 200px;
}

.editor-wrapper {
    overflow: hidden;
    height: 460px;
    margin: -10px -10px;
}

#advanced-editor {
    width: 781px;
    height: 460px;
    margin: -10px 0 0 -10px;
}

#advanced-editor #avpw_filter_eggs_panel {
    /* top: 370px; */
}


#avpw_controls {
    margin-top: 36px;
    margin-bottom: 183px;
    margin-left: 3px;
}

#avpw_close_aftersave {
    display: none;
}

#avpw_resume_aftersave {
    display: none;
}

#image-resize-confirm .bd,
#image-resize-confirm-premium .bd {
    line-height: 1.2em;
}

.bd .c1,
.bd .c2 {
    width:136px;
    background-color: #fff;
    padding:4px;
    margin: 10px 0 4px;
}

.bd .c1 h4.header,
.bd .c2 h4.header {
    color: #287098;
    font-size: 110%;
    font-weight: normal;
    margin-bottom: 3px;
}
.bd .c1 {
    float: left;
}
.bd .c2 {
    float: right;
}
</style>

<div id="image-resize-confirm">
    <div class="hd">Upgrade or Resize</div>
    <div class="bd">
        The largest image you can edit is 1200 pixels.<br />Please choose one of the following options:
        <div style="clear:both"></div>
        <div class="c1">
        <h4 class="header">Upgrade Account</h4> Upgrade to edit higher resolution images.
        </div>
        <div class="c2">
        <h4 class="header">Resize Image</h4> Allow us to resize your image to 1200 pixels.
        </div>
        <div style="clear:both"></div>
    </div>
</div>

<div id="image-resize-confirm-premium">
    <div class="hd">Resize Image?</div>
    <div class="bd">
        Editing an image greater than 2000 pixels may cause the image editor to become slow or unresponsive. Can we resize your image to 2000 pixels?
    </div>
</div>

<div id="edit-image-dialog">
    <div class="hd">Edit Image</div>
    <div class="bd">

         <div class="editor-wrapper"><div id="advanced-editor" style="overflow: hidden;"><div id="feather">
            <div id="feather-preview" class="hidden" style="background-color: #fff; margin: 11px 0 0 10px">
            <img src="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/static_aviary.png" width="100%" style="float:right" />
            <img id="feather-preview-image" src="" width="418" height="261" style="margin: 130px 0 0 185px; position:absolute"/>
            <br style="clear:both" />
            </div>
         </div></div>
         <img src='' id="image_placeholder" style="display:none" />
         </div>
        <form>
            <input type="hidden" name="align" value="" />
            <input type="hidden" id="edit-image-dialog-xid" name="xid" value="" />
            <!-- caption -->
            <div class="edit-image-options tpshadow">
            <div class="edit-image-option-column">

            <div class="input-field field" id="edit-image-caption">
                <div class="field-label">
                    <label>Caption:</label>
                </div>
                <div class="field-contents">
                    <input name="caption" type="text" at:default-value="Text displayed below your image" />
                </div>
            </div>

            <!-- position -->
            <div class="field" id="align-edit-image">
                <div class="field-label">
                    Alignment:
                </div>
                <div class="field-contents">
                    <a href="#" class="align-img" tp:imgalign="none"><img src="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/img-none.gif" width="48" /></a>
                    <a href="#" class="align-img" tp:imgalign="center"><img src="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/img-center.gif" width="48" /></a>
                    <a href="#" class="align-img" tp:imgalign="floatleft"><img src="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/img-floatleft.gif" width="48" /></a>
                    <a href="#" class="align-img" tp:imgalign="floatright"><img src="http://static.typepad.com/.shared:va84928f:typepad:en_us/images/img-floatright.gif" width="48" /></a>
                </div>
            </div>

            <!-- image size -->
            <div class="select-field field">
                <div class="field-label">
                    <label>Image Size:</label>
                </div>
                <div class="field-contents">
                    <select id="edit-image-size" name="size" size="1">
                        <option value="full">Full Size</option>
                        <option value="large">Large (500 px)</option>
                        <option value="medium">Medium (320 px)</option>
                        <option value="small">Small (120 px)</option>
                        <option value="custom">Custom</option>
                        <option value="text">Text Link</option>
                    </select>
                    <span id="edit-image-custom-image-width" class="hidden"><input name="width" size="5" /> px</span>
                </div>
            </div>

           </div> <!-- edit-image-option-column -->
            <div class="edit-image-option-column">

            <!-- description -->
            <div class="input-field field" id="edit-image-description">
                <div class="field-label">
                    <label>Description:</label>
                </div>
                <div class="field-contents">
                    <input name="alt" type="text" at:default-value="Text seen by search engines" />
                </div>
            </div>

            <!-- border -->
            <div class="select-field field" id="edit-image-border">
                <div class="field-label">
                    <label for="size">Border:</label>
                </div>
                <div class="field-contents">
                    <select id="edit-image-border-width" name="border_width">
                        <option value="0">None</option>
                        <option value="1">1px</option>
                        <option value="2">2px</option>
                        <option value="3">3px</option>
                        <option value="4">4px</option>
                        <option value="5">5px</option>
                    </select>
                    <span id="edit-image-border-options" class="hidden">
                        <select name="border_style">
                            <option value="solid">Solid</option>
                            <option value="dotted">Dotted</option>
                            <option value="dashed">Dashed</option>
                        </select>
                        <input id="edit-image-border-color" name="border_color" size="7" />
                    </span>
                </div>
            </div>

            <!-- link to image -->
            <div class="nolabel-field field">
                <div class="field-contents">
                    <label>
                        <input type="checkbox" name="popup" value="1" class="cb" />
                        Link to full-size image
                    </label>
                </div>
            </div>

            </div><!-- edit-image-option-column -->
            <br style="clear:both" />
            </div><!-- edit-image-options -->
        </form>
    </div>
</div>

<script type="text/javascript">
YAHOO.util.Event.onDOMReady( function() {
    var d = new YAHOO.widget.Dialog( 'view-pings-dialog', {
        width: '350px',
        fixedcenter: true,
        close: false,
        draggable: false,
        zindex: 4,
        modal: true,
        visible: false,
        buttons: [ { text: "Close", handler: function() { this.cancel() }, isDefault:true } ]
    } );
    d.render();

    TC.dialogs.viewPings = d;
} );
</script>

<div id="view-pings-dialog" style="visibility:hidden;">
    <div class="hd">Previously sent TrackBacks</div>
    <div class="bd">
        <p>You have no sent trackbacks. Trackbacks can take a few minutes to send. Try again if your trackback does not appear soon.</p>
    </div>
</div>

<script type="text/javascript">
YAHOO.util.Event.on( 'view-previous-pings', 'click', function( ev ) {
    YAHOO.util.Event.stopEvent( ev );
    if( TC.dialogs.viewPings ) {
        TC.dialogs.viewPings.show();
    }
} );
</script>
<script type="text/javascript">
YAHOO.util.Event.onDOMReady( function() {
    var d = new YAHOO.widget.Dialog( 'category-creator', {
        width: '300px',
        fixedcenter: true,
        close: false,
        draggable: false,
        zindex: 4,
        modal: true,
        visible: false,
        buttons: [ { text: 'Cancel', handler: function() { TC.callbacks.categoryCreator.handleCancel(); } },
                   { text: 'Create', handler: function() { TC.callbacks.categoryCreator.handleSubmit( this.getData() ); }, isDefault: true } ]
    } );

    d.render();

    TC.dialogs.categoryCreator = d;
} );
</script>

<div id="category-creator">
    <div class="hd">Create Category</div>
    <div class="bd">
        <form>
            <input name="label" style="width: 200px;" />
        </form>
    </div>
</div>

<script type="text/javascript">
TC.callbacks.categoryCreator = {
    handleSubmit: function( d ) {
        if( d.label.match(/\S/) ) { // make sure we actually have text, not spaces or nothing
            var el = YAHOO.util.Dom.get( 'added-categories' );
            if( !el ) {
                return;
            }
            YAHOO.util.Dom.removeClass( el, 'hidden' );
            var category = document.createElement( 'label' );
            var category_checkbox = document.createElement( 'input' );
            category_checkbox.setAttribute( 'type', 'checkbox' );
            category_checkbox.setAttribute( 'name', 'category' );
            category_checkbox.setAttribute( 'value', d.label );
            category_checkbox.setAttribute( 'checked', 'checked' );
            category_checkbox.setAttribute( 'class', 'cb' );
            var category_label = document.createTextNode( ' ' + d.label );
            category.appendChild( category_checkbox );
            category.appendChild( category_label );
            el.appendChild( category );
            // Find or Create this category on the backend
            typepad.blogs.addCategory({
                id: '6a00e553e16897883300e553fcc7418834',
                category: d.label,
                success: function() {
                    // nothing!
                },
                error: function( o ) {
                    alert("Sorry, you\'ve reached the maximum number of categories on this blog.");
                    el.removeChild(category);
                    category_checkbox = null;
                    category_label = null;
                    category = null;
                }
            });
            TC.dialogs.categoryCreator.hide();
            TC.dialogs.categoryCreator.form.label.value = '';
        } else {
            alert( 'Please enter a category name.' );
        }
    },
    handleCancel: function() {
        TC.dialogs.categoryCreator.hide();
        TC.dialogs.categoryCreator.form.label.value = '';
    }
}
</script>
<script type="text/javascript">
TC.scheduler = function( id, config ) {
    TC.scheduler.superclass.constructor.call( this, id, config );

    this.calendar = new YAHOO.widget.Calendar( 'schedule-calendar' );
    this.calendar.selectEvent.subscribe( this.handleSelect, this.calendar, true );

    this.setDate( config.date || new Date() );
};

YAHOO.extend( TC.scheduler, YAHOO.widget.Dialog, {
    setDate: function( dt ) {
        this.date = dt;
        this.calendar.select( this.date );
        this.calendar.cfg.setProperty( 'pagedate', ( this.date.getMonth() + 1 ) + '/' + this.date.getFullYear() );
        var h = dt.getHours();
        var m = dt.getMinutes();
        if ( h >= 12 ) {
            YAHOO.util.Dom.get( 'schedule-hour' ).value = (h > 12) ? (h - 12) : h;
            YAHOO.util.Dom.get( 'schedule-ampm' ).value = 'pm';
        } else {
            YAHOO.util.Dom.get( 'schedule-hour' ).value = h == 0 ? 12 : h;
            YAHOO.util.Dom.get( 'schedule-ampm' ).value = 'am';
        }
        YAHOO.util.Dom.get( 'schedule-minute' ).value = (m < 10) ? ("0" + m) : m;
        this.calendar.render();
    },

    /* fix for IE, so the calendar grid isn't visible on the page */
    show: function() {
        YAHOO.util.Dom.removeClass( 'schedule-dialog', 'hidden' );
        TC.scheduler.superclass.show.apply(this, arguments);
    },

    handleSelect: function( type, args, obj ) {
        if( this.updatingCalendar )
            return;

        var dates = args[ 0 ];
        var date = dates[ 0 ];
        var year = date[ 0 ], month = date[ 1 ], day = date[ 2 ];

        var date_field = document.getElementById( 'schedule-date' );
        date_field.value = month + '/' + day + '/' + year;
    },

    updateCal: function() {
        var date_field = document.getElementById( 'schedule-date' );
        var date = this.calendar._parseDate( date_field.value );
        var year_str;

        if( isNaN( date[ 0 ] ) || isNaN( date[ 1 ] ) || isNaN( date[ 2 ] ) )
            return;

        year_str = date[ 0 ].toString();

        if( year_str.length != 4 )
            return;

        this.calendar.updatingCalendar = true;
        this.calendar.select( date_field.value );
        this.calendar.updatingCalendar = false;
        var selected_dates = this.calendar.getSelectedDates();
        if( selected_dates.length > 0 ) {
            var first_date = selected_dates[ 0 ];
            this.calendar.cfg.setProperty( 'pagedate', ( first_date.getMonth() + 1 ) + '/' + first_date.getFullYear() );
            this.calendar.render();
        } else {
            alert( 'No date was selected.' );
        }
    }
} );

YAHOO.util.Event.onDOMReady( function() {
    var d = new TC.scheduler( 'schedule-dialog', {
        width: '210px',
        fixedcenter: true,
        close: false,
        draggable: false,
        zindex: 4,
        modal: true,
        visible: false,
        buttons: [
            {
                text: "Cancel",
                handler: function() {
                    this.cancel();
                },
                isDefault: false
            },
            {
                text: "OK",
                handler: function() {
                    var d = this.getData();
                    var dates = this.calendar.getSelectedDates();
                    var dt = dates[ 0 ];
                    var df = this.calendar._parseDate( d.date );
                    if( dt.getFullYear() != df[ 0 ] ) {
                        alert( 'Please make sure you entered a four-digit year.' );
                        return;
                    }
                    var h = parseInt( d.hour, 10 ); 
                    if( d.ampm == 'am' ) {
                        dt.setHours( h >= 12 ? 0 : h );
                    } else {
                        dt.setHours( h >= 12 ? 12 : h + 12 );
                    }
                    dt.setMinutes( d.minute );
                    TC.callbacks.schedule.handleSubmit( dt );
                },
                isDefault: true
            }
        ]
    } );
    d.render();

    TC.dialogs.schedule = d;
} );

YAHOO.util.Event.on( 'schedule-date', 'keyup', function( ev ) {
    TC.dialogs.schedule.updateCal();
} );
</script>

<div id="schedule-dialog" class="hidden">
    <div class="hd">Published Date and Time</div>
    <div class="bd">
        <div class="schedule-calendar pkg">
            <div id="schedule-calendar"></div>
        </div>
        <form>
            <div class="schedule-date pkg">
                <div class="dialog-label">Date:</div>
                <div class="dialog-field"><input id="schedule-date" name="date" size="10" maxlength="10" /></div>
            </div>
            <div class="schedule-time pkg">
                <div class="dialog-label">Time:</div>
                <div class="dialog-field">
                    <input id="schedule-hour" name="hour" size="2" maxlength="2" /> :
                    <input id="schedule-minute" name="minute" size="2" maxlength="2" />
                    <select id="schedule-ampm" name="ampm">
                        <option value="am">AM</option>
                        <option value="pm">PM</option>
                    </select>
                </div>
            </div>
        </form>
    </div>
</div>

<script type="text/javascript">
function doOpenSchedule() {
    if( TC.dialogs.schedule ) {
        TC.dialogs.schedule.show();
    }
}

YAHOO.util.Event.onDOMReady( function() {
    var dt = new Date();
    dt.setTime( 1369904400000 );
    TC.dialogs.schedule.setDate( dt );
    doSetTimestamp( 1369904400, dt.toLocaleString(), true );
} );

TC.callbacks.schedule = {
    handleSubmit: function( dt ) {
        doSetTimestamp( dt.getTime() / 1000, dt.toLocaleString(), true );
        TC.dialogs.schedule.hide();
    }
};

// Periodic token retrieval
(function() {

var Lang = YAHOO.lang,
    Dom = YAHOO.util.Dom,
    Connect = YAHOO.util.Connect,
    timerId = null,
    tokenRequest = null,
    updateTime = ( 1000 * 60 * 5 ),
    updateElements = [ 'entry-form-token', 'insert-file-token', 'insert-audio-token', 'upload-form-token', 'preview-form-token' ];

    function retrieveToken() {
        /* clear timers and outstanding requests */
        if ( timerId )
            window.clearTimeout( timerId );
        if ( tokenRequest ) {
            try { Connect.abort( tokenRequest ); } catch(e) { };
        }
        /* retrieve token */
        Connect.setDefaultPostHeader('content-type','text/javascript+json');
        tokenRequest = Connect.asyncRequest('POST', 'http://www.typepad.com/services/json-rpc', {
                success: updateToken,
                failure: updateTokenFailed,
                cache: false
        }, '{"id":"1","method":"System.GenerateToken"}' );
    }

    function updateToken( o ) {
        tokenRequest = null;
        var json = o.responseText.substring(o.responseText.indexOf('{'), o.responseText.lastIndexOf('}') + 1);
        var data;
        try {
            data = eval('(' + json + ')');
        } catch(e) {
            return updateTokenFailed();
        };
        if ( data.result && data.result.token ) {
            for ( var i = 0, len = updateElements.length; i < len; i++ ) {
                var el = Dom.get( updateElements[ i ] );
                if ( el )
                    el.value = data.result.token;
            }
        }

        // Fire IE's garbage collection
        //if ( window.CollectGarbage )
        //    window.CollectGarbage();

        start();
    }

    function updateTokenFailed() {
        tokenRequest = null;
        start();
    }

    function start() {
        if ( timerId )
            window.clearTimeout( timerId );
        timerId = window.setTimeout( retrieveToken, updateTime );
    }

    window.updateUploadToken = function() { retrieveToken(); };

    YAHOO.util.Event.onDOMReady( start );
})();
</script>



        </div>
    </div>
    <div id="bumper"></div>
</div><div id="footer">
    <div id="footer-inner">
        <div class="copyright"><div class="pkg">
    <p><a href="http://www.typepad.com/">TypePad</a> &#169; 2003-2013 <a href="http://www.typepad.com/">TypePad, Inc.</a> All Rights Reserved.</p>
    <ul class="pkg">
        <li class="first"><a href="http://www.typepad.com/services/tos" target="_blank">Terms of Service</a></li>
        <li><a href="http://www.typepad.com/services/privacy" target="_blank">Privacy Policy</a></li>
    </ul>
</div>

        </div>
    </div>
</div>



<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>

<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-225723-24");
pageTracker._setVar( 'account=Unlimited;ui=2' );
pageTracker._trackPageview( 'site/blogs/edit_post' );
} catch(err) {}</script>


<!-- Begin comScore Tag -->
<script>
document.write(unescape("%3Cscript src='" + (document.location.protocol == "https:" ? "https://sb" : "http://b") + ".scorecardresearch.com/beacon.js'%3E%3C/script%3E"));
</script>
<script>
COMSCORE.beacon({
  c1: 2,
  c2: "6035669",
  c3: "",
  c4: "http://www.typepad.com/site/blogs/6a00e553e16897883300e553fcc7418834/post/6a00e553e1689788330192aa7d9f92970d/edit",
  c5: "",
  c6: "",
  c15: ""
});
</script>
<noscript>
  <img src="http://b.scorecardresearch.com/b?c1=2&c2=6035669&c3=&c4=http%3A%2F%2Fwww.typepad.com%2Fsite%2Fblogs%2F6a00e553e16897883300e553fcc7418834%2Fpost%2F6a00e553e1689788330192aa7d9f92970d%2Fedit&c5=&c6=&c15=&cv=1.3&cj=1" style="display:none" width="0" height="0" alt="" />
</noscript>
<!-- End comScore Tag -->
        
<script type="text/javascript" src="http://thebuildingcoder.typepad.com/blog/services/cache-bust.js"></script>



</body>
</html>


