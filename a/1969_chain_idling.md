<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="bc.css">
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js" type="text/javascript"></script>
</head>

<!---

- Andrea Tassera @dre_tas
You wanted to see my presentation at #AU2022 on #DevoOps for 
@AutodeskRevit
 plugins, but missed it for some reason (sore feet and hungover as the most common)? No judgement here. We've all been there.
You can now find the recording here
https://www.autodesk.com/autodesk-university/class/Deploy-Better-Plugins-Faster-Through-CICD-and-Unit-Testing-Azure-DevOps-2022

- Paul F. Aubin @paulfaubin
Were you at #autodeskuniversity2022? 
https://twitter.com/hashtag/autodeskuniversity2022?src=hashtag_click

Recorded classes are now posted. You can see mine (Taming Parametric Curvature in the Revit Family Editor) right here (complete with downloadable sample files and a step-by-step handout):
#rev
https://twitter.com/hashtag/rev?src=hashtag_click

https://www.autodesk.com/autodesk-university/class/Taming-Parametric-Curved-Geometry-Revit-Family-Editor-2022

- Chuong Ho
https://www.linkedin.com/posts/chuongmep_dynamo-bim-developer-activity-6984467588034543616-U7b6?utm_source=share&utm_medium=member_desktop
Hi everyone, I'm happy to tell you today that I've published a book online about Dynamo called Awesome Dynamo.
The Awesome Dynamo project celebrates and aggregates authors, essential and complete content with a large contribution from the community, the main purpose of which is to store dynamo core values and make it easy to learn, apply to work and explore power of Dynamo.
I'm in the process of working and perfecting it, so please help me if you can.
Ebook Online : https://lnkd.in/gHM3XVFn -- https://chuongmep.github.io/Awesome-Dynamo/intro.html
Github : https://lnkd.in/gHNqyjKH -- https://github.com/chuongmep/Awesome-Dynamo
#Dynamo #BIM #Developer #Autodesk #NoteBook

- https://forums.autodesk.com/t5/revit-api-forum/ilist-vs-list/m-p/11483464

- I would like to launch a Command After the Export File Form Closes
  https://forums.autodesk.com/t5/revit-api-forum/i-would-like-to-launch-a-command-after-the-export-file-form/td-p/11494782

The standard Revit API approach to launch a command after the previous one has been completed is to use the Idling event:

https://www.revitapidocs.com/2023/56145d84-e948-730a-dc72-2a7b88a50a99.htm
https://thebuildingcoder.typepad.com/blog/about-the-author.html#5.28

However, there are other possibilities as well. For example, check out these recent discussions on similar topics:

https://forums.autodesk.com/t5/revit-api-forum/can-you-chain-idling-events/m-p/11484370

[Exporting to DWG after Dynamo script being executed](https://forums.autodesk.com/t5/revit-api-forum/exporting-to-dwg-after-dynamo-script-being-executed/m-p/11487750)

- ricaun solves
  Can you chain Idling events?
  https://forums.autodesk.com/t5/revit-api-forum/can-you-chain-idling-events/m-p/11484370

- This is pretty mind-blowing: a podcast that is entirely generated by artificial intelligence where Joe Rogan interviews Steve Jobs. 
  https://podcast.ai

 twitter:

 the #RevitAPI @AutodeskForge @AutodeskRevit #bim #DynamoBim #ForgeDevCon 

&ndash; 
...

linkedin:

#bim #DynamoBim #ForgeDevCon #Revit #API #IFC #SDK #AI #VisualStudio #Autodesk #AEC #adsk

the [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread

<center>
<img src="img/" alt="" title="" width="600" height=""/>
<p style="font-size: 80%; font-style:italic"></p>
</center>

<pre class="code">
</pre>

-->

### Chain Idling and Avoid Doing So

A couple of notes on interesting contributions from AU and on Dynamo, and some nitty-gritty discussions on Idling stuff:

####<a name="2"></a> Deployment and Testing

Andrea [@dre_tas](https://twitter.com/dre_tas) Tassera shared a very inspiring class
You wanted to see my presentation at #AU2022 on #DevoOps for 
@AutodeskRevit
 plugins, but missed it for some reason (sore feet and hungover as the most common)? No judgement here. We've all been there.
You can now find the recording here
[Deploy Better Plugins Faster Through CI/CD and Unit Testing in Azure DevOps](https://www.autodesk.com/autodesk-university/class/Deploy-Better-Plugins-Faster-Through-CICD-and-Unit-Testing-Azure-DevOps-2022)

> At Woods Bagot we managed to cut the deployment time of our tools from days to minutes, while increasing quality and reliability, by repurposing common concepts and tools from the Software Development world.
By implementing a DevOps philosophy in your workflow, not only do you deliver automation tools quicker, but you also empower your teams from the start, improving communication and collaboration and promoting professional growth.
You increase quality and reliability of the software product deployed, thanks to automated testing and a faster feedback cycle.
Moreover, with the ability of more frequent faster releases, backed up by live monitoring systems, developers can deploy tools that are tailored to the users and really respond to their needs.
The session will showcase how Woods Bagot has developed a full workflow for their Revit toolbar through the use an Azure DevOps pipeline, but the principles can be applied to any platform that benefits from automation tools.

####<a name="3"></a> Parametric Curvature in Families

Paul F. [@paulfaubin](https://twitter.com/paulfaubin) Aubin
discussed [Taming Parametric Curvature in the Revit Family Editor](https://www.autodesk.com/autodesk-university/class/Taming-Parametric-Curved-Geometry-Revit-Family-Editor-2022),
complete with downloadable sample files and a step-by-step handout:

> Have you ever tried to control the shape of a curved form parametrically in the Family Editor?
If so, you’ve no doubt discovered that flexing them sometimes throws you a curveball.
In this session we’ll explore several techniques to tame your unruly parametric curves.
We’ll look at examples of circles, arcs, quarter round, half round, arches, and we’ll even check out some splines.
We’ll look at both simple and compound curves.
We’ll work primarily in the traditional Family Editor but most techniques apply to the massing Family Editor environment as well. We’ll explore curvature and rotation, using both armatures (or rigs) and formulas to constrain flexing behavior. We’ll even throw in some trigonometry for good measure! After this session, I cannot guarantee that you’ll never have another misbehaving curve in your family content, but what I can promise is that you’ll come away with several useful tools to help you tame them when curve-mischief strikes!

####<a name="4"></a> Awesome Dynamo Online Book Project

Chuong Ho [initiated](https://www.linkedin.com/posts/chuongmep_dynamo-bim-developer-activity-6984467588034543616-U7b6)
the online book project Awesome Dynamo.

> The Awesome Dynamo project celebrates and aggregates authors, essential and complete content with a large contribution from the community, the main purpose of which is to store dynamo core values and make it easy to learn, apply to work and explore power of Dynamo.

> I'm in the process of working and perfecting it, so please help me if you can:

- [Ebook Online](https://chuongmep.github.io/Awesome-Dynamo/intro.html)
- [GitHub repository](https://github.com/chuongmep/Awesome-Dynamo)


####<a name="5"></a> 

<pre class="code">
</pre>

[Can you chain Idling events?
(https://forums.autodesk.com/t5/revit-api-forum/can-you-chain-idling-events/m-p/11489054)

Is it possible to chain Idling events?

Say I have two functions, FuncA and FuncB. I want to run FuncA the first time revit idles, then run FuncB after FuncA is done running and revit idles again. Inside my FuncA handler, I am removing the handler to FuncA from UIApp.Idling, but I can not assign a new handler because I don't have a valid API context.

Is there a way for me to achieve my intended behavior?

NOTE: The reason I'm doing any of this at all is because of this referenced post. For some reason, Revit throws an internal exception if my FuncA and FuncB are called one after the other. So I am separating them with an idling event. Now I need to add another idling event before FuncA.

Tags (1)
Tags:idling
 
Add tags
Report
8 REPLIES 
Sort: 
MESSAGE 2 OF 9
RPTHOMAS108
 Mentor RPTHOMAS108 in reply to: ariWZRFQ
‎2022-10-16 05:29 PM 
It doesn't sound like a good idea in general, however.

When Revit idles you want to run FunctionA when it idles again you want to run FunctionA but with different settings i.e. subscribe to FunctionA and change what FunctionA does based on what it did last. Then after a set number of things that FunctionA does unsubscribe. In the end you are waiting for the same event in-between doing tasks with the same function.

You can use static variable etc. to store stage of FunctionA.

Tags (0)
Add tags
Report
MESSAGE 3 OF 9
jeremy.tammik
 Employee jeremy.tammik in reply to: ariWZRFQ
‎2022-10-17 01:36 AM 
Afaik, you cannot chain them directly, but you can easily achieve the same effect:

Subscribe to the Idling event and attach handlerA
In handlerA, unsubscribe from the Idling event, then subscribe to the Idling event and attach handlerB

Depending on other factors, Revit may or may not execute other actions in between the two event handler calls, but their relative order should be preserved.

You say, I cannot assign a new handler because I don't have a valid API context.

Why not? Within the Idling event handler, I thought you do have a valid Revit API context.

Question: why do the actions A and B have to be executed separately? Can't you just execute them both within the same Idling event handler?

Jeremy Tammik,  Developer Advocacy and Support, The Building Coder, Autodesk Developer Network, ADN Open
Tags (0)
Add tags
Report
MESSAGE 4 OF 9
ricaun
 Advocate ricaun in reply to: ariWZRFQ
‎2022-10-17 07:13 AM 
You should create a queue service for that, subscribing and unsubscribing Revit events in your App as static.

Something like this maybe helps: https://gist.github.com/ricaun/11b272c5bec46f05c3fe49525fcc3fdf

You can register the service in your IExternalApplication.

public class App : IExternalApplication
{
    public static IdlingQueueService IdlingActionService { get; private set; }
    public Result OnStartup(UIControlledApplication application)
    {
        IdlingActionService = new IdlingQueueService(application);
        return Result.Succeeded;
    }

    public Result OnShutdown(UIControlledApplication application)
    {
        IdlingActionService?.Dispose();
        return Result.Succeeded;
    }
}

Then you could add some Action to run on the Idling Event, each one gonna run in a different Idling Event.

[Transaction(TransactionMode.Manual)]
public class Command : IExternalCommand
{
    public Result Execute(ExternalCommandData commandData, ref string message, ElementSet elementSet)
    {
        App.IdlingActionService.Add((uiapp) => { System.Windows.MessageBox.Show("1"); });
        App.IdlingActionService.Add((uiapp) => { System.Windows.MessageBox.Show("2"); });

        return Result.Succeeded;
    }
}

I hope this helps.

Luiz Henrique Cassettari

ricaun.com - Revit API Developer

AppLoader EasyConduit WireInConduit ConduitMaterial CircuitName ElectricalUtils
IdlingQueueService is a class to run actions in the Idling Revit event in a queue.
IdlingQueueService is a class to run actions in the Idling Revit event in a queue.
gist.github.com/ricaun/11b272c5bec46f05c3fe4952...
Instantly share code, notes, and snippets. IdlingQueueService is a class to run actions in the Idling Revit event in a queue. You can't perform that action at this time. You signed in with another tab or window. You signed out in another tab or window. Reload to refresh your session. Reload to ...
Tags (0)
Add tags
Report
Success!

Click to go to your post.
MESSAGE 5 OF 9
ariWZRFQ
 Explorer ariWZRFQ in reply to: ariWZRFQ
‎2022-10-17 03:26 PM 
Thank you all for your responses. I have tried 3 different solutions all to no success.

I tried running 1 idling event with block if statements just to perform different actions based on some state variables.
This fails because one of my functions also ends up giving Revit the opportunity to idle. This causes a never ending idling loop.
I retried subscribing to a new handler inside of handler A.
This fails with an error "Cannot subscribe to an event during execution of that event". I am attempting to subscribe to a different handler function with code in the form of below.

public async void OnIdlingA(object sender, IdlingEventArgs e)
{
     Autodesk.Revit.UI.UIApplication uiapp = sender as 
     Autodesk.Revit.UI.UIApplication;

     Debug.Assert(null != uiapp,
         "expected a valid Revit application instance");

     if (uiapp != null)
     {
          uiapp.Idling -= OnIdlingA;
          uiapp.Idling += new
                EventHandler<Autodesk.Revit.UI.Events.IdlingEventArgs>
                (OnIdlingB);

          await FuncA();
     }
}
​

Finally, I tried the Idling Queue service
This also fails due the the fact that I am getting extra idling events while my functions are running causing the execution to dive into the idling functions before finishing the current function.

If I step back from all the details of my implementation, my problem is really not too complicated. I just wish I could run the Execute function of IExternalCommand like below.

public Result Execute(ExternalCommandData commandData, ref string message, ElementSet elements)
{
      Object1 obj1 = new Object1(commandData)
      
      await obj1.func1;
      await obj1.func2;
      obj1.func3;  //THIS IS THE ONLY REVIT INTERACTION

      return Autodesk.Revit.UI.Result.Succeeded;
}

This doesn't work because I can not make the Execute function async but this is the theory. Not being able to await func1 and func2 is what is causing me to dive so deep into idling events. Func1 and Func2 have nothing to do with Revit.

Func1 calls a web server to do authentication in a webview

Func2 calls a web server to download Revit files

Func3 opens those files and uses that data to manipulate the current document.

Thank you all for the guidance

Tags (0)
Add tags
Report
MESSAGE 6 OF 9
ricaun
 Advocate ricaun in reply to: ariWZRFQ
‎2022-10-17 03:51 PM 
You forgot to explain that you are using 'await' functions.

Revit does not like async stuff, and your code looks odd. How can you add an await without an async method...

To work with async and Revit use the Revit.Async package, so the package gonna manage the Idling stuff.

Luiz Henrique Cassettari

ricaun.com - Revit API Developer

AppLoader EasyConduit WireInConduit ConduitMaterial CircuitName ElectricalUtils
Tags (0)
Add tags
Report
MESSAGE 7 OF 9
ariWZRFQ
 Explorer ariWZRFQ in reply to: ricaun
‎2022-10-17 03:55 PM 
Sorry, I just edited my reply for clarity. I am not actually running the functions with await as shown. That is how I would do it if the Execute function could be made async.

Func1 and Func2 are async functions which is why I am/was trying to run them in idling events.

Tags (0)
Add tags
Report
MESSAGE 8 OF 9
ricaun
 Advocate ricaun in reply to: ariWZRFQ
‎2022-10-17 04:22 PM 
One thing that is important is that when an IExternalCommand is running the Idling is not gonna trigger until the command ends. The Idling means the Revit is not busy doing something and is ready to receive some user interaction.

I guess the best approach in your case should be to use Revit.Async package with something like this.

public async Task Execute()
{
      await func1;
      await func2;
      await RevitTask.RunAsync(func3);  //THIS IS THE ONLY REVIT INTERACTION
}

Using the RevitTask you can run the func3 in Revit context.

Luiz Henrique Cassettari

ricaun.com - Revit API Developer

AppLoader EasyConduit WireInConduit ConduitMaterial CircuitName ElectricalUtils
Tags (0)
Add tags
Report
MESSAGE 9 OF 9
jeremy.tammik
 Employee jeremy.tammik in reply to: ariWZRFQ
‎2022-10-20 02:47 AM 
One correct, reliable and effective approach to address the situation you describe is to implement an external event:

https://thebuildingcoder.typepad.com/blog/about-the-author.html#5.28

In the event handler, simply run the code to execute func3.

All the rest has nothing to do with Revit and does not require the Revit API.

Therefore, you can execute it independently, externally, and simply raise the external event after func1 and func2 have completed successfully.

Oh dear. I just noticed your statement:

> Func1 and Func2 are async functions which is why I am/was trying to run them in idling events.

Well, that is just about the opposite of what you could or should do. Or at least it is not intended, afaict.

Revit and its API is single threaded. The Idling event handler is single threaded. So, as long as that event handler is busy executing, e.g., your func1 and func2, it will block Revit from doing anything else.

The purpose of the Idling event is to enable you to execute some action as soon as Revit has stopped being occupied with and therefore blocked by other tasks.

This confirms my preceding answer: it seems to me that an appropriate way to handle this would be to disconnect func1 and func2 from Revit and your add-in as much as possible, and let them trigger an external event when they are completed, to execute func3.


**Question:** 

**Answer:** 

<center>
<img src="img/.png" alt="" title="" width="100" height=""/> <!-- 872 x 556 -->
</center>

Many thanks to ??? for the useful explanation!
