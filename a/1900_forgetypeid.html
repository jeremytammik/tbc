<p><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="bc.css">
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js" type="text/javascript"></script>
</head></p>
<!---

- revit 2022 migrate ParameterType
  https://autodesk.slack.com/archives/C0SR6NAP8/p1615984937008800
  https://wiki.autodesk.com/pages/viewpage.action?spaceKey=aeceng&title=Revit+API+Changes+2022
  ForgeTypeId how to use https://forums.autodesk.com/t5/revit-api-forum/forgetypeid-how-to-use/td-p/9439210
  Revit 2022: ParameterType.Text to ForgeTypeId https://forums.autodesk.com/t5/revit-api-forum/revit-2022-parametertype-text-to-forgetypeid/m-p/10225741
  https://forums.autodesk.com/t5/revit-api-forum/revit-2022-parametertype-text-to-forgetypeid/m-p/10227398

- josiah comment
  https://thebuildingcoder.typepad.com/blog/2018/06/multi-targeting-revit-versions-cad-terms-texture-maps.html#comment-5339799009
  Multi-Target 2021 and 2022 Using MSBuild
  https://forums.autodesk.com/t5/revit-api-forum/multi-target-2021-and-2022-using-msbuild/m-p/10235037

- PDF Export fails with Paper Format set as Default with other parameters
  Revit 2022 PDF Export Fails with Paper Format set as Default with Other Parameters
  https://forums.autodesk.com/t5/revit-api-forum/revit-2022-pdf-export-fails-with-paper-format-set-as-default/m-p/10223281

- 2022 PDF exporter cant use "sheet number" parameter
https://forums.autodesk.com/t5/revit-api-forum/2022-pdf-exporter-cant-use-quot-sheet-number-quot-parameter/m-p/10220287

- https://www.freecodecamp.org/news/common-mistakes-beginning-web-development-students-make/
  5 Mistakes Beginner Web Developers Make ‚Äì And How to Fix Them
  Avoid spaces in file names
  Respect case sensitivity
  Understand file paths
  Name the default page `index`
  Take a break

twitter:

 #RevitAPI @AutodeskForge @AutodeskRevit #bim #DynamoBim #ForgeDevCon 

&ndash; 
...

linkedin:

#bim #DynamoBim #ForgeDevCon #Revit #API #IFC #SDK #AI #VisualStudio #Autodesk #AEC #adsk

the [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread

<center>
<img src="img/" alt="" title="" width="600"/>
<p style="font-size: 80%; font-style:italic"></p>
<p style="font-size: 80%; font-style:italic">
<a href=""></a>
</p>
</center>

-->

<h3>Replace Deprecated ParameterType with ForgeTypeId</h3>
<p>Revit 2022 has been released and the time has come to migrate to the new version.
Two important new features are changes to the parameter API and a new built-in PDF export functionality.
Some initiual issues with these two have already been discussed:</p>
<h4><a name="2"></a> Replace Deprecated ParameterType with ForgeTypeId</h4>
<p>David Becroft of Autodesk 
and Maxim Stepannikov of BIM Planet, aka –ú–∞–∫—Å–∏–º –°—Ç–µ–ø–∞–Ω–Ω–∏–∫–æ–≤ or <a href="https://forums.autodesk.com/t5/user/viewprofilepage/user-id/4552025">architect.bim</a>,
helped address 
the <a href="http://forums.autodesk.com/t5/revit-api-forum/bd-p/160">Revit API discussion forum</a> question
on <a href="https://forums.autodesk.com/t5/revit-api-forum/revit-2022-parametertype-text-to-forgetypeid/m-p/10225741">Revit 2022 ParameterType.Text to ForgeTypeId</a>:</p>
<p><strong>Question:</strong> Could somebody please help me out with this conversion from the deprecated <code>ParameterType</code> to <code>ForgeTypeId</code> for the Revit 2022 API?</p>
<p>The 'old' code has a line like this:</p>
<pre class="code">
if (parameter.Definition.ParameterType == ParameterType.Text)  ....
</pre>

<p>What would be the 2022 equivalent for it?</p>
<p>It seems that the left side may be:</p>
<pre class="code">
if (parameter.Definition.GetDataType() == ????)  ....

but for some reason I cannot find what do I have to use on right side of the operation üòû There must be something I am overlooking.

**Answer:** To perform this check you need to create instance of ForgeTypeId class. Use one of the SpecTypeId's properties to get value to compare with. In your case (for text parameter) you need Number property:

<pre class="code">
>>> element.Parameter[BuiltInParameter.ALL_MODEL_MARK].Definition.GetSpecTypeId() == SpecTypeId.Number
True
</pre>

 Also take a look at the conversation
 on [how to use `ForgeTypeId`](https://forums.autodesk.com/t5/revit-api-forum/forgetypeid-how-to-use/td-p/9439210).

**Response:** Oh dear!
This is super confusing.
I've just checked and parameter definitions that store TEXT have a `SpecTypeId` = `SpecTypeId.Number`.

Now how do you distinguish between actual Numbers and Text?

It looks like the problem is this:

The `Autodesk.Revit.DB.InternalDefinition` class has:

- `ParameterType` &ndash; this can be: Invalid | Text | Integer | Number
- `UnitType` &ndash; seemingly, for Text type parameters, this is `UT_Number`

Now with `ParameterType` becoming obsolete, we have to use `Parameter.GetSpecTypeId` that SEEMINGLY coresponds to the `UnitType` member above, and for Text parameters like `Comment`, it has a value of `SpecTypeId.Number`!

The question is: How can I know if a Parameter is Text or not in Revit 2022 &ndash; without using Definition.ParameterType ?

Same would apply to `YesNo` type parameters... `SpecTypeId` cannot be used to determine if a `ParameterDefinition` is for a `YesNo` type parameter...  

And even more: The ONLY place where I can see if a parameter is a YesNo parameter is in the Parameter.Definition.ParameterType !! If ParameterType is obsolete... how to determine if a parameter is YesNo or something else?

**Answer:** It is a well-known fact that unit type of text is number.
Actually I don't know why &nbsp; :-)
But you definnitely should use the `Number` property.
Each Parameter object also has a `StorageType` property.
In case of a Yes/No parameter, its value is `Integer`.
In case of Text parameter, `String`.
I hope this solves your problem.

**Response:** Well, sorry for my ignorance but seemingly there is still one 'minor' issue left for me to be answered:

<pre class="code">
var option = new ExternalDefinitionCreationOptions("ExampleParamForge", SpecTypeId.XXX???);
var definition = definitionGroup.Definitions.Create(option);
</pre>

Using SpecTypeId.Number creates a Parameter that has the "Type of Parameter" set to Number (obviously!, right?)

How do I create a simple TEXT Parameter definition using the Revit 2022 API?

There must be something here that I am missing.

**Answer:** To create a text parameter, please use `SpecTypeId.String.Text`.

For context, the `ForgeTypeId` properties directly in the `SpecTypeId` class identify the measurable data types, like `SpecTypeId.Length` or `SpecTypeId.Mass`.
The non-measurable data types are organized into nested classes within `SpecTypeId`, like `SpecTypeId.String.Text`, `SpecTypeId.Boolean.YesNo`, `SpecTypeId.Int.Integer`, or `SpecTypeId.Reference.Material`.

Regarding text parameters that report their type as "Number", here's the history:

- Prior to Revit 2021, a `Definition` had a `UnitType` and a `ParameterType`.
  The `UnitType` property was only meaningful for parameters with measurable `ParameterType` values, and a parameter with `ParameterType.Text` would report a meaningless `UnitType.Number` value.
- Revit 2021 deprecated the `UnitType` property and replaced it with the `GetSpecTypeId` method.
  But the behavior remained the same &ndash; a parameter with `ParameterType.Text` would have `GetSpecTypeId` == `SpecTypeId.Number`.
- Revit 2022 deprecated the `ParameterType` property and the `GetSpecTypeId` method, replacing them both with the `GetDataType` method.
  A parameter with `ParameterType.Text` will report `GetDataType()` == `SpecTypeId.String.Text`.
  Side note: The `GetDataType` method can also return a category identifier, indicating a Family Type parameter of that category.

Many thanks to Maxim and David for their clarification!

####<a name="3"></a> Multi-Target 2021 and 2022 Using MSBuild

Josiah Offord very kindly shared hiw solution to implement a multi-target add-in for several releases of Revit
using [the Microsoft Build Engine MSBuild](https://docs.microsoft.com/en-us/visualstudio/msbuild/msbuild) in both
a [comment](https://thebuildingcoder.typepad.com/blog/2018/06/multi-targeting-revit-versions-cad-terms-texture-maps.html#comment-5339799009)
on [multi-targeting Revit Versions using `TargetFrameworks`](https://thebuildingcoder.typepad.com/blog/2018/06/multi-targeting-revit-versions-cad-terms-texture-maps.html#2) and in a dedicated [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread
on [multi-targeting 2021 and 2022 using `MSBuild`](https://forums.autodesk.com/t5/revit-api-forum/multi-target-2021-and-2022-using-msbuild/m-p/10235037):

For those interested, you can configure a `.csproj` to multi-target both 2021 and 2022 on .NET Framework 4.8 using MSBuild.
I posted this on a comment in The Building Codeer blog and figured it'd be useful here too.

The first task is to choose what .NET 4.8 add-in you want to actively program against.
There can only be one active add-in per .NET framework as far as I know.
In this example, I'm setting my default to Revit 2022 using the custom `RevitVersion` property if it hasn't been configured yet.

<pre class="code">
<Project Sdk="Microsoft.NET.Sdk.WindowsDesktop" InitialTargets="Test">
  ...
  <PropertyGroup>
    <TargetFrameworks>net461;net47;net472;net48</TargetFrameworks>
    <Configurations>Debug;Release</Configurations>
    <OutputPath>bin\$(Configuration)\</OutputPath>
    <UseWindowsForms>true</UseWindowsForms>
    <RevitVersion Condition=" '$(RevitVersion)' == '' ">2022</RevitVersion>
    ...
  </PropertyGroup>
</pre>

 Next, define configurations changes per each version.

<pre class="code">
  <PropertyGroup Condition=" '$(TargetFramework)' == 'net461' ">
    <PlatformTarget>x64</PlatformTarget>
    <DefineConstants>DEBUG;REVIT2018</DefineConstants>
    <OutputPath>bin\$(Configuration)\2018\</OutputPath>
  </PropertyGroup>

  <PropertyGroup Condition=" '$(TargetFramework)' == 'net47' ">
    <PlatformTarget>x64</PlatformTarget>
    <DefineConstants>$(DefineConstants);REVIT2019</DefineConstants>
    <OutputPath>bin\$(Configuration)\2019</OutputPath>
  </PropertyGroup>

  <PropertyGroup Condition=" '$(TargetFramework)' == 'net472' ">
    <PlatformTarget>x64</PlatformTarget>
    <DefineConstants>$(DefineConstants);REVIT2020</DefineConstants>
    <OutputPath>bin\$(Configuration)\2020\</OutputPath>
  </PropertyGroup>

  <PropertyGroup Condition=" '$(TargetFramework)' == 'net48' And '$(RevitVersion)' == '2021' ">
    <PlatformTarget>x64</PlatformTarget>
    <DefineConstants>$(DefineConstants);REVIT2021</DefineConstants>
    <OutputPath>bin\$(Configuration)\2021</OutputPath>
  </PropertyGroup>

  <PropertyGroup Condition=" '$(TargetFramework)' == 'net48' And '$(RevitVersion)' == '2022' ">
    <PlatformTarget>x64</PlatformTarget>
    <DefineConstants>$(DefineConstants);REVIT2022</DefineConstants>
    <OutputPath>bin\$(Configuration)\2022</OutputPath>
  </PropertyGroup>
</pre>

Next, load the proper dll references for each version.

<pre class="code">
  <ItemGroup Condition=" '$(TargetFramework)' == 'net461' ">
    <Reference Include="AdWindows">
      <HintPath>C:\Program Files\Autodesk\Revit 2018\AdWindows.dll</HintPath>
      <EmbedInteropTypes>false</EmbedInteropTypes>
      <Private>false</Private>
    </Reference>
    <Reference Include="RevitAPI">
      <HintPath>C:\Program Files\Autodesk\Revit 2018\RevitAPI.dll</HintPath>
      <EmbedInteropTypes>false</EmbedInteropTypes>
      <Private>false</Private>
    </Reference>
    <Reference Include="RevitAPIUI">
      <HintPath>C:\Program Files\Autodesk\Revit 2018\RevitAPIUI.dll</HintPath>
      <EmbedInteropTypes>false</EmbedInteropTypes>
      <Private>false</Private>
    </Reference>
  </ItemGroup>

  <ItemGroup Condition=" '$(TargetFramework)' == 'net47' ">
    <Reference Include="AdWindows">
      <HintPath>C:\Program Files\Autodesk\Revit 2019\AdWindows.dll</HintPath>
      <EmbedInteropTypes>false</EmbedInteropTypes>
      <Private>false</Private>
    </Reference>
    <Reference Include="RevitAPI">
      <HintPath>C:\Program Files\Autodesk\Revit 2019\RevitAPI.dll</HintPath>
      <Private>False</Private>
      <EmbedInteropTypes>false</EmbedInteropTypes>
    </Reference>
    <Reference Include="RevitAPIUI">
      <HintPath>C:\Program Files\Autodesk\Revit 2019\RevitAPIUI.dll</HintPath>
      <EmbedInteropTypes>false</EmbedInteropTypes>
      <Private>false</Private>
    </Reference>
  </ItemGroup>

  <ItemGroup Condition=" '$(TargetFramework)' == 'net472' ">
    <Reference Include="AdWindows">
      <HintPath>C:\Program Files\Autodesk\Revit 2020\AdWindows.dll</HintPath>
      <EmbedInteropTypes>false</EmbedInteropTypes>
      <Private>false</Private>
    </Reference>
    <Reference Include="RevitAPI">
      <HintPath>C:\Program Files\Autodesk\Revit 2020\RevitAPI.dll</HintPath>
      <EmbedInteropTypes>false</EmbedInteropTypes>
      <Private>false</Private>
    </Reference>
    <Reference Include="RevitAPIUI">
      <HintPath>C:\Program Files\Autodesk\Revit 2020\RevitAPIUI.dll</HintPath>
      <EmbedInteropTypes>false</EmbedInteropTypes>
      <Private>false</Private>
    </Reference>
  </ItemGroup>

  <ItemGroup Condition=" '$(TargetFramework)' == 'net48' And '$(RevitVersion)' == '2021' ">
    <Reference Include="AdWindows">
      <HintPath>C:\Program Files\Autodesk\Revit 2021\AdWindows.dll</HintPath>
      <EmbedInteropTypes>false</EmbedInteropTypes>
      <Private>false</Private>
    </Reference>
    <Reference Include="RevitAPI">
      <HintPath>C:\Program Files\Autodesk\Revit 2021\RevitAPI.dll</HintPath>
      <EmbedInteropTypes>false</EmbedInteropTypes>
      <Private>false</Private>
    </Reference>
    <Reference Include="RevitAPIUI">
      <HintPath>C:\Program Files\Autodesk\Revit 2021\RevitAPIUI.dll</HintPath>
      <EmbedInteropTypes>false</EmbedInteropTypes>
      <Private>false</Private>
    </Reference>
  </ItemGroup>

  <ItemGroup Condition=" '$(TargetFramework)' == 'net48' And '$(RevitVersion)' == '2022' ">
    <Reference Include="AdWindows">
      <HintPath>C:\Program Files\Autodesk\Revit 2022\AdWindows.dll</HintPath>
      <EmbedInteropTypes>false</EmbedInteropTypes>
      <Private>false</Private>
    </Reference>
    <Reference Include="RevitAPI">
      <HintPath>C:\Program Files\Autodesk\Revit 2022\RevitAPI.dll</HintPath>
      <EmbedInteropTypes>false</EmbedInteropTypes>
      <Private>false</Private>
    </Reference>
    <Reference Include="RevitAPIUI">
      <HintPath>C:\Program Files\Autodesk\Revit 2022\RevitAPIUI.dll</HintPath>
      <EmbedInteropTypes>false</EmbedInteropTypes>
      <Private>false</Private>
    </Reference>
  </ItemGroup>
</pre>

At the end, you need to configure an additional build for whatever .NET 4.8 Revit add-in you didn't set as the default above. This is nice because it will catch build errors even though the active .NET 4.8 version is something else.

<pre class="code">
  <Target Name="Test">
    <Message Importance="high" Text="-- Building $(MSBuildProjectFile), TF = $(TargetFramework), Config = $(Configuration), Revit Version = $(RevitVersion) --" />
  </Target>
  <Target Name="Build2021" BeforeTargets="DispatchToInnerBuilds">
    <Message Importance="high" Text="*** running pre-dispatch builds ***" />
    <MSBuild Projects="myProject.csproj" Properties="Configuration=$(Configuration);TargetFramework=net48;RevitVersion=2021"></MSBuild>
  </Target>
</pre>

Side note:
Using a multi-target solution means you need to keep references to all the old versions of Revit.
Be sure to copy out the needed dlls before removing that Revit version from your machine.

Hope this helps.

Thank you very much, Josiah, for this important and timely advice!

####<a name="4"></a> PDF Export Default Paper Format Can Fail

The new built-in PDF export is a certainly a very useful feature in Revit 2022 and has gathered a lot of interest.

Unfortunately, it also caused some misunderstandings, and a first problem was discovered and described in the thread 
on [Revit 2022 PDF export fails with paper format set as default with other parameters](https://forums.autodesk.com/t5/revit-api-forum/revit-2022-pdf-export-fails-with-paper-format-set-as-default/m-p/10223281).

The title says it all, and the development team explain:

By design, if PaperFormat is default, then PaperPlacement should always be Center.
However, there is no restriction ensuring this on the API side.
We should either silently set PaperPlacement to Center during export, or throw  an exception notifying the add-in about this.

Currently, in this case, nothing happens and no warning or eror is raised.

####<a name="5"></a> PDF Export Output File Naming

Another thread question
why [2022 PDF exporter can't use the "sheet number" parameter](https://forums.autodesk.com/t5/revit-api-forum/2022-pdf-exporter-cant-use-quot-sheet-number-quot-parameter/m-p/10220287).

Apparently, you have to be sure that the Sheet Number parameter from the "Parameter Type" drop down menu is selected from the Sheet type fields.

Also, if the sheet has no revision the filename, the words 'Current revision' may be inserted into the filename instead.

The development team confirm this fallback behaviour; if the parameter you selected is empty, it will fill the parameter name (Sample Value) in the filename.

The sheet number in the parameter set is confusing due to the parameter type.
The designed scenario is: the customer will use this parameter only in either sheet or view, not in both of them.
If you select a mixed type of both view and sheet with this parameter, one parameter will fallback to its name due to its absence in the view type.

####<a name="6"></a> Five Beginner Mistakes

Taing a quick look beyond Revit and .NET development for the desktop, the article
on [5 mistakes beginner web developers make &ndash; and how to fix them](https://www.freecodecamp.org/news/common-mistakes-beginning-web-development-students-make) addresses
topics that are of use in a non-web environment as well, and that I actually adhere to pretty strictly myself on all platforms
&ndash; possibly excepting the last &ndash; I am still practicing that:

- Avoid spaces in file names
- Respect case sensitivity
- Understand file paths
- Name the default page `index`
- Take a break

<center>
<img src="/p/2016/2016-01-03_wildhaus/791_jeremy_reading_cropped.jpg" alt="Taking a break and reading in the Swiss winter sun" width="500">
</center>

<!-- mexico siesta  sombrero -->