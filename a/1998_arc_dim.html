<p><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="bc.css"></p>
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js" type="text/javascript"></script>
<p></head></p>
<!---

- dimension arc endpoint references


twitter:

the @AutodeskRevit #RevitAPI #BIM @DynamoBIM @AutodeskAPS

&ndash;
...

linkedin:

#BIM #DynamoBIM #AutodeskAPS #Revit #API #IFC #SDK #Autodesk #AEC #adsk

the [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread

<center>
<img src="img/" alt="" title="" width="600"/>
<p style="font-size: 80%; font-style:italic"></p>
</center>

-->

<h3>Arc Dimensioning</h3>
<h4><a name="2"></a> Revit Add-In Unit Testing</h4>
<p><a href="https://speckle.systems/">Speckle</a> shared
<a href="https://speckle.systems/blog/xunitrevit">xUnitRevit: a test runner for Revit</a> that
looks very promising.</p>
<h4><a name="3"></a> Arc Dimensioning</h4>
<p>I made an interesting discovery working on a dimensioning issue that involved chain dimensioning of a circle placement within a rectangle, displaying its diameter and offsets from the four edges.
The circle is generated by creating two 180 degree arcs with a centre point <code>p</code> and half width and height vectors <code>vw2</code> and <code>vh2</code>:</p>
<pre class="prettyprint">
  arc = Arc.Create(p - vw2, p + vh2, p + vw2);
  curve = doc.Create.NewModelCurve( arc, sketchPlane);
  arc = Arc.Create(p + vw2, p - vh2, p - vw2);
  curve = doc.Create.NewModelCurve(arc, sketchPlane);
</pre>

<p>Chain dimensioning model line segments is straightforward, simply adding all the line endpoint references to the <code>ReferenceArray</code>.</p>
<p>I attempted a similar approach with the arcs like this:</p>
<pre class="prettyprint">
  arc = Arc.Create(p - vw2, p + vh2, p + vw2);
  curve = doc.Create.NewModelCurve( arc, sketchPlane);

  // Vertical

  ra.Clear();
  ra.Append(mc_front_left.GeometryCurve.GetEndPointReference(0));
  ra.Append(curve.GeometryCurve.GetEndPointReference(0));
  ra.Append(curve.GeometryCurve.GetEndPointReference(1));
  ra.Append(mc_front_left.GeometryCurve.GetEndPointReference(1));
  doc.Create.NewDimension(viewForDimension, Line.CreateUnbound(pForVerticalDimension, vz), ra);

  // Horizontal

  ra.Clear();
  ra.Append(ductEdgeForDimHor.GeometryCurve.GetEndPointReference(0));
  ra.Append(curve.GeometryCurve.GetEndPointReference(0));
  ra.Append(curve.GeometryCurve.GetEndPointReference(1));
  ra.Append(ductEdgeForDimHor.GeometryCurve.GetEndPointReference(1));
  doc.Create.NewDimension(viewForDimension, Line.CreateUnbound(pForHorDim, vForHorDim), ra);
</pre>

<p>To my surprise, this code creates dimensions to one endpoint and one midpoint of the arc:</p>
<p><center>
<img src="img/dim_180_deg_arc_end_point_a0_r01.png" alt="Arc dimensioning" title="Arc dimensioning" width="300"/> <!-- Pixel Height: 1,064 Pixel Width: 1,026 -->
</center></p>
<p>To obtain the other endpoint, I need to grab a reference from the second arc as well, like this:</p>
<pre class="prettyprint">
  arc = Arc.Create(p - vw2, p + vh2, p + vw2);
  curve = doc.Create.NewModelCurve( arc, sketchPlane);
  Reference r1 = curve.GeometryCurve.GetEndPointReference(0);
  arc = Arc.Create(p + vw2, p - vh2, p - vw2);
  curve = doc.Create.NewModelCurve(arc, sketchPlane);
  Reference r2 = curve.GeometryCurve.GetEndPointReference(0);

  // Vertical

  ra.Clear();
  ra.Append(mc_front_left.GeometryCurve.GetEndPointReference(0));
  ra.Append(r1);
  ra.Append(r2);
  ra.Append(mc_front_left.GeometryCurve.GetEndPointReference(1));
  doc.Create.NewDimension(viewForDimension, Line.CreateUnbound(pForVerticalDimension, vz), ra);

  // Horizontal

  ra.Clear();
  ra.Append(ductEdgeForDimHor.GeometryCurve.GetEndPointReference(0));
  ra.Append(r1);
  ra.Append(r2);
  ra.Append(ductEdgeForDimHor.GeometryCurve.GetEndPointReference(1));
  doc.Create.NewDimension(viewForDimension, Line.CreateUnbound(pForHorDim, vForHorDim), ra);
</pre>

<p>With this code, the vertical dimension correctly dimensions the circle diameter, but the horizontal dimensioning collapses the two endpoint into one:</p>
<p><center>
<img src="img/dim_two_180_deg_arcs_a01_r0.png" alt="Arc dimensioning" title="Arc dimensioning" width="300"/>
</center></p>
<p>So, finally, we arrive at the working solution with successful diameter chain dimensioning both horizontal and vertical by using both endpoint references of both arcs, specifying different endpoints for the horizontal and vertical direction:</p>
<pre class="prettyprint">
  arc = Arc.Create(p - vw2, p + vh2, p + vw2);
  curve = doc.Create.NewModelCurve( arc, sketchPlane);
  Reference a0r0 = curve.GeometryCurve.GetEndPointReference(0);
  Reference a0r1 = curve.GeometryCurve.GetEndPointReference(1);

  arc = Arc.Create(p + vw2, p - vh2, p - vw2);
  curve = doc.Create.NewModelCurve(arc, sketchPlane);
  Reference a1r0 = curve.GeometryCurve.GetEndPointReference(0);
  Reference a1r1 = curve.GeometryCurve.GetEndPointReference(1);

  // Vertical

  ra.Clear();
  ra.Append(mc_front_left.GeometryCurve.GetEndPointReference(0));
  ra.Append(a0r0);
  ra.Append(a1r0);
  ra.Append(mc_front_left.GeometryCurve.GetEndPointReference(1));
  doc.Create.NewDimension(viewForDimension, Line.CreateUnbound(pForVerticalDimension, vz), ra);

  // Horizontal

  ra.Clear();
  ra.Append(ductEdgeForDimHor.GeometryCurve.GetEndPointReference(0));
  ra.Append(a0r1);
  ra.Append(a1r1);
  ra.Append(ductEdgeForDimHor.GeometryCurve.GetEndPointReference(1));
  doc.Create.NewDimension(viewForDimension, Line.CreateUnbound(pForHorDim, vForHorDim), ra);
</pre>

<p>The result is as desired:</p>
<p><center>
<img src="img/dim_two_180_deg_arcs_a01_r01.png" alt="Arc dimensioning" title="Arc dimensioning" width="300"/>
</center></p>
<p>In summary, the tests above include:</p>
<ul>
<li>Arc 0, references 0 + 1</li>
<li>Arc 0 + 1, reference 0 on each</li>
<li>Arc 0 + 1, references 0 + 1, depending on the dimensioning orientation</li>
</ul>
<p>My interpretation is that the chain dimensioning does not use the specified endpoint reference in the way I expect.</p>
<p>Rather, the most extreme endpoint towards the start or end of the curve is dynamically determined depending on the dimension line orientation, resulting in the endpoint in one direction and the midpoint in the other.</p>
<h4><a name="3"></a></h4>
<p><strong>Question:</strong></p>
<p><strong>Answer:</strong></p>
<p><strong>Response:</strong></p>
<h4><a name="6"></a> Rotate Your File</h4>
<p><a href="https://funct.app/">Rotate Your File</a> provides a handy little service to Safely send someone a file:</p>
<ul>
<li><a href="https://funct.app/start">Start here</a></li>
<li><a href="https://funct.app/faq">Frequently asked questions</a></li>
</ul>
<p>The FAQ is pleasantly readable, succinct, and includes nice descriptions of the design philosophy, GDPR, data collection, security and encryption aspects.</p>