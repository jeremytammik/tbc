<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="bc.css">
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js" type="text/javascript"></script>
</head>

<!---

- dimension arc endpoint references


twitter:

the @AutodeskRevit #RevitAPI #BIM @DynamoBIM @AutodeskAPS

&ndash;
...

linkedin:

#BIM #DynamoBIM #AutodeskAPS #Revit #API #IFC #SDK #Autodesk #AEC #adsk

the [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread

<center>
<img src="img/" alt="" title="" width="600"/>
<p style="font-size: 80%; font-style:italic"></p>
</center>

-->

### Arc Dimensioning



####<a name="2"></a> Arc Dimensioning

I made an interesting discovery working on a dimensioning issue that involved chain dimensioning of a circle placement within a rectangle, displaying its diameter and offset from the four edges.
The circle was generated by creating two 180 degree arcs like this with a centre point `p` and half width and height vectors `vw2` and `vh2`:

<pre class="prettyprint">
  Arc arc = Arc.Create(p - vw2, p + vh2, p + vw2);
  Curve curve = doc.Create.NewModelCurve( arc, sketchPlane);
  arc = Arc.Create(p + vw2, p - vh2, p - vw2);
  curve = doc.Create.NewModelCurve(arc, sketchPlane);
</pre>

Chain dimensioning model line segments was straightforward, by simply adding all the line endpoint references to the `ReferenceArray`.

I attempted the same approach with arcs like this:

<pre class="prettyprint">
  arc = Arc.Create(p - vw2, p + vh2, p + vw2);
  curve = doc.Create.NewModelCurve( arc, sketchPlane);

  // Vertical

  ra.Clear();
  ra.Append(mc_front_left.GeometryCurve.GetEndPointReference(0));
  ra.Append(curve.GeometryCurve.GetEndPointReference(0));
  ra.Append(curve.GeometryCurve.GetEndPointReference(1));
  ra.Append(mc_front_left.GeometryCurve.GetEndPointReference(1));
  doc.Create.NewDimension(viewForDimension, Line.CreateUnbound(pForVerticalDimension, vz), ra);

  // Horizontal

  ra.Clear();
  ra.Append(ductEdgeForDimHor.GeometryCurve.GetEndPointReference(0));
  ra.Append(curve.GeometryCurve.GetEndPointReference(0));
  ra.Append(curve.GeometryCurve.GetEndPointReference(1));
  ra.Append(ductEdgeForDimHor.GeometryCurve.GetEndPointReference(1));
  doc.Create.NewDimension(viewForDimension, Line.CreateUnbound(pForHorDim, vForHorDim), ra);
</pre>

To my surprise, this code creates dimensions to one endpoint and one midpoint of the arc:

<center>
<img src="img/dim_180_deg_arc_end_point_a0_r01.png" alt="Arc dimensioning" title="Arc dimensioning" width="300"/> <!-- Pixel Height: 1,064 Pixel Width: 1,026 -->
</center>

To obtain the other endpoint, I need to grab a reference from the second arc as well, like this:

<pre class="prettyprint">
  arc = Arc.Create(p - vw2, p + vh2, p + vw2);
  curve = doc.Create.NewModelCurve( arc, sketchPlane);
  Reference r1 = curve.GeometryCurve.GetEndPointReference(0);
  arc = Arc.Create(p + vw2, p - vh2, p - vw2);
  curve = doc.Create.NewModelCurve(arc, sketchPlane);
  Reference r2 = curve.GeometryCurve.GetEndPointReference(0);

  // Vertical

  ra.Clear();
  ra.Append(mc_front_left.GeometryCurve.GetEndPointReference(0));
  ra.Append(r1);
  ra.Append(r2);
  ra.Append(mc_front_left.GeometryCurve.GetEndPointReference(1));
  doc.Create.NewDimension(viewForDimension, Line.CreateUnbound(pForVerticalDimension, vz), ra);

  // Horizontal

  ra.Clear();
  ra.Append(ductEdgeForDimHor.GeometryCurve.GetEndPointReference(0));
  ra.Append(r1);
  ra.Append(r2);
  ra.Append(ductEdgeForDimHor.GeometryCurve.GetEndPointReference(1));
  doc.Create.NewDimension(viewForDimension, Line.CreateUnbound(pForHorDim, vForHorDim), ra);
</pre>

With this code, the vertical dimension correctly dimensions the circle diameter, but the horizontal dimensioning collapses the two endpoint into one:

<center>
<img src="img/dim_two_180_deg_arcs_a01_r0.png" alt="Arc dimensioning" title="Arc dimensioning" width="300"/>
</center>

So, finally, we arrive at the working solution with successful diameter chain dimensioning both horizontal and vertical by using both endpoint references of both arcs, specifying different endpoints for the horizontal and vertical direction:

<pre class="prettyprint">
  arc = Arc.Create(p - vw2, p + vh2, p + vw2);
  curve = doc.Create.NewModelCurve( arc, sketchPlane);
  Reference a0r0 = curve.GeometryCurve.GetEndPointReference(0);
  Reference a0r1 = curve.GeometryCurve.GetEndPointReference(1);

  arc = Arc.Create(p + vw2, p - vh2, p - vw2);
  curve = doc.Create.NewModelCurve(arc, sketchPlane);
  Reference a1r0 = curve.GeometryCurve.GetEndPointReference(0);
  Reference a1r1 = curve.GeometryCurve.GetEndPointReference(1);

  // Vertical

  ra.Clear();
  ra.Append(mc_front_left.GeometryCurve.GetEndPointReference(0));
  ra.Append(a0r0);
  ra.Append(a1r0);
  ra.Append(mc_front_left.GeometryCurve.GetEndPointReference(1));
  doc.Create.NewDimension(viewForDimension, Line.CreateUnbound(pForVerticalDimension, vz), ra);

  // Horizontal

  ra.Clear();
  ra.Append(ductEdgeForDimHor.GeometryCurve.GetEndPointReference(0));
  ra.Append(a0r1);
  ra.Append(a1r1);
  ra.Append(ductEdgeForDimHor.GeometryCurve.GetEndPointReference(1));
  doc.Create.NewDimension(viewForDimension, Line.CreateUnbound(pForHorDim, vForHorDim), ra);
</pre>

The result is as desired:

<center>
<img src="img/dim_two_180_deg_arcs_a01_r01.png" alt="Arc dimensioning" title="Arc dimensioning" width="300"/>
</center>

In summary, the tests above include:

- Arc 0, references 0 + 1
- Arc 0 + 1, reference 0 on each
- Arc 0 + 1, references 0 + 1, depending on the dimensioning orientation

My interpretation is that the chain dimensioning does not use the specified endpoint reference in the way I expect.

Rather, the most extreme endpoint towards the start or end of the curve is dynamically determined depending on the dimension line orientation, resulting in the endpoint in one direction and the midpoint in the other.


####<a name="3"></a>

**Question:**

**Answer:**

**Response:**

