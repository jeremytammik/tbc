<p><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="bc.css">
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js" type="text/javascript"></script>
</head></p>
<!---

- get duct shape:
https://autodesk.slack.com/archives/C2F55JKC6/p1544635935006700
https://autodesk.slack.com/archives/C2F55JKC6/p1592411013057400?thread_ts=1544635935.006700&cid=C2F55JKC6
Q: Hi, does anyone know how can I figure out the duct shape (oval, rectangular or round) from DuctType and not depending on its FamilyName? The FamilyName is a localized string so cannot get the shape info out from it.
A: You can get the shape based on the connectors. Let me see if i can dig some code out.
R: does DuctType have connector?
A: I'm not sure..... are you using FabricationParts or generics? Check to see if your element has a connector manager, then check the shape property on your connectors.
A:
var fabPart = myElement as FabricationPart;
foreach (Connector conn in fabPart.ConnectorManager.Connectors)
{
    var shape = conn.Shape;
}
R: I am using generics duct, not FabricationParts, in this case
I found this link (by @tammikj) has sample to get shape from DuctType. But, if I open a projet file using construction template then that function failed.
https://github.com/jeremytammik/the_building_coder_samples/blob/master/BuildingCoder/BuildingCoder/CmdMepElementShape.cs
A: perhaps you could take some of the code found in here?
DuctType dt = doc.GetElement( tid )
            as DuctType;

          if( null != dt )
          {
            if( HasInvalidElementIdValue( e, BuiltInParameter
              .RBS_CURVETYPE_MULTISHAPE_TRANSITION_OVALROUND_PARAM ) )
            {
              shape = "rectangular";
            }
            else if( HasInvalidElementIdValue( e, BuiltInParameter
              .RBS_CURVETYPE_MULTISHAPE_TRANSITION_RECTOVAL_PARAM ) )
            {
              shape = "round";
            }
            else if( HasInvalidElementIdValue( e, BuiltInParameter
              .RBS_CURVETYPE_MULTISHAPE_TRANSITION_PARAM ) )
            {
              shape = "oval";
            }
R: this is the same code I found on the link above, it failed when open a new project not using mechanical template
A: You should be able to call getProfileType that is defined in the base class from the type to get the shape. If for some reason that doesn't work you can use Jaz's example if you replace the FabricationPart with Duct  or FamilyInstance  (for fittings) you can get the profile shape from the connectors.
The profile type is an enum so there should be no string related issues.
R: old version of revit api
- cannot find getProfileType in base class of DuctType.
- the example code above only works when opening a new project using mechanical template
A: It should be defined in the MEPCurveType class, it was exposed to the API in 2019.
R: Thanks, we are switching to 2019 soon, I will use it after that, finding a workaround for now.
on Revit 2018, I found that if I create a new project file using Architectural Template, its three DuctType only have "Default" on each. In this case the sample code above does not work. Which API function can create duct types just as like I create new project using Mechanical Template? (edited) 
A: I don't think using the duct type will work for what you are trying to do (unless you are using 2019). If you access the duct or duct fitting (familyInstance) and get the connectors from the connector manager from the element you should be able to get the shape. That shape is the same for both.
R: our plugin is trying to recreate duct type from the data stored in hfdm before draw duct instance. for example if plugin stores an oval duct type in hfdm called newDuctType1, for plugin to insert this duct instance into drawing, it needs to create this duct type in Oval Duct first. The plugin can hard code "Oval" string to find FamilyName "Oval Duct" In English version Revit, but our client in French using other language Revit shows localized FamilyName "Oval Duct" string so hard code "Oval" in English will not work. This is why I am looking for a solution/workaround in 2018 to determine the shape from duct type.
I have not found any solution for 2018. We decide to use the sample routine (see above) you created but it works only if all three duct types (oval, rectangular and round) have real duct type in them. The workaround on 2018,
1. When the all three parameters in sample routine does not return valid element id which means the drawing does not have real duct type except the one called “Default”, then it prompts warning to the user.
2. Ask the user to transfer duct type from other drawing and delete the one called “Default”.
A: i am sure the workaround can be improved, and i am sure that a reliable algorithm to distinguish mep element shapes can be devised. for instance, you could look at the number, geometrical location and direction of the connectors. that will provide a lot of information. you can look at the geometry.
Here are the three methods implemented so far by The Building Coder; however, I am sure they can be improved!
- https://thebuildingcoder.typepad.com/blog/2011/03/distinguishing-mep-element-shape.html
- https://thebuildingcoder.typepad.com/blog/2011/05/improved-mep-element-shape-and-mount-ararat.html
- https://thebuildingcoder.typepad.com/blog/2016/02/ifc-import-levels-and-mep-element-shapes.html#3

<!-- 0554 0578 1406 -->

<ul>
<li><a href="http://thebuildingcoder.typepad.com/blog/2011/03/distinguishing-mep-element-shape.html">Distinguishing MEP Element Shape</a></li>
<li><a href="http://thebuildingcoder.typepad.com/blog/2011/05/improved-mep-element-shape-and-mount-ararat.html">Improved MEP Element Shape and Mount Ararat</a></li>
<li><a href="http://thebuildingcoder.typepad.com/blog/2016/02/ifc-import-levels-and-mep-element-shapes.html">IFC Import Levels and MEP Element Shapes</a></li>
</ul>

<!-- 0554 0578 1406 -->

<p><ul> - <a href="http://thebuildingcoder.typepad.com/blog/2011/03/distinguishing-mep-element-shape.html">Distinguishing MEP Element Shape</a> == - <a href="http://thebuildingcoder.typepad.com/blog/2011/05/improved-mep-element-shape-and-mount-ararat.html">Improved MEP Element Shape and Mount Ararat</a> == - <a href="http://thebuildingcoder.typepad.com/blog/2016/02/ifc-import-levels-and-mep-element-shapes.html">IFC Import Levels and MEP Element Shapes</a> == </ul></p>
<p>Later: did you ever resolve this?
R: for Revit 2019 and newer, there is a new DuctType property for it, DuctType.Shape,
for Revit 2018 and older, we get the value from RoutingPreferenceRuleGroupType.TransitionsOvalToRound, RoutingPreferenceRuleGroupType.TransitionsRectangularToOval and RoutingPreferenceRuleGroupType.TransitionsRectangularToRound, then check if returned list has count 0 (the solution from internet search)</p>
<ul>
<li>
<p>find out changes between version of .NET assembly DLL
  Q: How can I identify recent additions to the public API? Is there a better way than manually looking at changed files in the commit history?
  A: You can compare the public interfaces in two different versions of the DLL:
  <a href="http://patelshailesh.com/index.php/free-tools-to-compare-net-assemblies">Free tools to compare .net assemblies</a></p>
</li>
<li>
<p>I gave Jeremys BIP checker a facelift
  https://forums.autodesk.com/t5/revit-api-forum/i-gave-jeremys-bip-checker-a-facelift/m-p/9566362/highlight/false#M47645
  BipCheckerWpf.png</p>
</li>
<li>
<p>Fonts starting with "@"
  https://adndevblog.typepad.com/aec/2012/09/fonts-starting-with-.html
  Fonts that begin with '@' 
  https://forums.autodesk.com/t5/revit-api-forum/fonts-that-begin-with/m-p/9566993</p>
</li>
</ul>
<p>twitter:</p>
<p>with the #RevitAPI @AutodeskForge @AutodeskRevit #bim #DynamoBim #ForgeDevCon </p>
<p>&ndash; 
...</p>
<p>linkedin:</p>
<h1>bim #DynamoBim #ForgeDevCon #Revit #API #IFC #SDK #AI #VisualStudio #Autodesk #AEC #adsk</h1>
<p>the <a href="http://forums.autodesk.com/t5/revit-api-forum/bd-p/160">Revit API discussion forum</a> thread</p>
<p><center>
<img src="img/" alt="" title="" width="600"/>
<p style="font-size: 80%; font-style:italic"></p>
</center></p>
<p>--&gt;</p>
<h3>BipChecker Facelift and DuctType Shape</h3>
<h4><a name="2"></a></h4>
<h4><a name="3"></a></h4>
<pre class="code">
</pre>

<h4><a name="4"></a></h4>
<p><strong>Question:</strong> </p>
<p><strong>Answer:</strong></p>
<h4><a name="5"></a></h4>
<p><center>
<img src="img/cool_physics.png" alt="Physics is cool" title="Physics is cool" width="125"/> <!-- 125 -->
</center></p>
<h4><a name="6"></a></h4>