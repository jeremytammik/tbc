<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="bc.css">
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js" type="text/javascript"></script>
</head>

<!---

- implemented level and area export, area in sqm with 2 decimal places, levels analysed and determined from Z
  https://github.com/jeremytammik/IfcSpaceZoneBoundaries/releases/tag/2019.0.1.1
  practical use of the method to Retrieve Levels Sorted by Elevation:
  https://thebuildingcoder.typepad.com/blog/2014/11/webgl-goes-mobile-and-sorted-level-retrieval.html#3

- https://youtu.be/GW9cbFYnKAc
<iframe width="560" height="315" src="https://www.youtube.com/embed/GW9cbFYnKAc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
TITAN VS ROBO-CAR - The Multi-Billion Dollar Company You’ve Never Heard Of
Titan travels to Zoox to meet with Chairman Carl Bass and discuss their incredible self-driving car. Not only do they have the artificial intelligence (AI) to autonomously drive the car through the streets of San Francisco, they are manufacturing their own vehicle to compete with the biggest names in ride-sharing. CNC machining, Advanced 3D printing, and 7-Axis robots to name a few of their production capabilities. Check out how their technology works, and why it is the future of driving. 

- https://youtu.be/EH-z9gE2uGY
<iframe width="560" height="315" src="https://www.youtube.com/embed/EH-z9gE2uGY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
The Mystery at the Bottom of Physics
Actually gets deep enough into physics to wax philosophical on gratitude for life and the reason to be grateful and happy for every moment of my own personal existence.

twitter:

Assigning a Level to an element missing it in the #RevitAPI @AutodeskForge @AutodeskRevit #bim #DynamoBim #ForgeDevCon http://bit.ly/determinelevel

I recently implemented the IfcSpaceZoneBoundaries add-in to link in and analyse IFC file zones and spaces, then prepared it for use in Forge Design Automation. Now I want to add level information to the CSV export. However, the <code>DirectShape</code> elements created to represent the rooms and zones have no valid level assigned, so their <code>Level</code> property is invalid.
Happily, we can easily analyse the BIM and generate the equivalent information ourselves
&ndash; Retrieve levels sorted by elevation
&ndash; Determine level from element elevation
&ndash; Carl Bass and Zoox autonomous vehicles
&ndash; Physical reasons to be happy to be alive...

linkedin:

Assigning a Level to an element missing it in the #RevitAPI @AutodeskForge @AutodeskRevit #bim #DynamoBim #ForgeDevCon http://bit.ly/determinelevel

I recently implemented the IfcSpaceZoneBoundaries add-in to link in and analyse IFC file zones and spaces, then prepared it for use in Forge Design Automation. Now I want to add level information to the CSV export. However, the <code>DirectShape</code> elements created to represent the rooms and zones have no valid level assigned, so their Level property is invalid.

Happily, we can easily analyse the BIM and generate the equivalent information ourselves

- Retrieve levels sorted by elevation
- Determine level from element elevation
- Carl Bass and Zoox autonomous vehicles
- Physical reasons to be happy to be alive...

of [The Building Coder samples](https://github.com/jeremytammik/the_building_coder_samples/releases/tag/2019.0.145.4).
the [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) recently

-->

### Assigning a Level to an Element Missing It

I recently implemented 
the [IfcSpaceZoneBoundaries add-in](https://github.com/jeremytammik/IfcSpaceZoneBoundaries)
to [link in and analyse IFC file zones and spaces](https://thebuildingcoder.typepad.com/blog/2019/02/link-in-and-analyse-ifc-file-zones-and-spaces.html),
then [prepared it for use in Forge Design Automation](https://thebuildingcoder.typepad.com/blog/2019/02/preparing-a-revit-add-in-for-design-automation.html).

The app bundle implementing the Design Automation for Revit or DA4R workitem functionality reads the `.ifc.RVT` file generated by the IFC linking command and exports its room and zone information to CSV.

My colleague Petr Broz worked on the DA4R side of things and requested the addition of level information and areas in square metres.

At first glance, this seems completely trivial.

However, the `DirectShape` elements created to represent the rooms and zones have no valid level assigned, so their `Level` property is invalid.

Happily, we can easily analyse the BIM and generate the equivalent information ourselves;
afterwards, I'll quickly mention two technology and science related videos I happened across:

- [Retrieve levels sorted by elevation](#2) 
- [Determine level from element elevation](#3) 
- [Carl Bass and Zoox autonomous vehicles](#4) 
- [Physical reasons to be happy to be alive](#5) 

<center>
<img src="img/ifc_sample_levels.png" alt="IFC sample levels" width="500"> <!-- 771 -->
</center>

#### <a name="2"></a> Retrieve Levels Sorted by Elevation

This provides a nice opportunity for a live demonstration of using the algorithm we already implemented 
to [retrieve levels sorted by elevation](https://thebuildingcoder.typepad.com/blog/2014/11/webgl-goes-mobile-and-sorted-level-retrieval.html#3).

It simply calls a filtered element collector to retrieve all levels and applies `OrderBy` to their elevations:

<pre class="code">
<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;</span><span style="color:gray;">summary</span><span style="color:gray;">&gt;</span>
<span style="color:gray;">///</span><span style="color:green;">&nbsp;Retrieve&nbsp;all&nbsp;levels&nbsp;sorted&nbsp;by&nbsp;elevation</span>
<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/</span><span style="color:gray;">summary</span><span style="color:gray;">&gt;</span>
<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:#2b91af;">IOrderedEnumerable</span>&lt;<span style="color:#2b91af;">Level</span>&gt;&nbsp;GetSortedLevels(&nbsp;
&nbsp;&nbsp;<span style="color:#2b91af;">Document</span>&nbsp;doc&nbsp;)
{
&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;<span style="color:blue;">new</span>&nbsp;<span style="color:#2b91af;">FilteredElementCollector</span>(&nbsp;doc&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;.OfClass(&nbsp;<span style="color:blue;">typeof</span>(&nbsp;<span style="color:#2b91af;">Level</span>&nbsp;)&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;.Cast&lt;<span style="color:#2b91af;">Level</span>&gt;()
&nbsp;&nbsp;&nbsp;&nbsp;.OrderBy(&nbsp;lev&nbsp;=&gt;&nbsp;lev.Elevation&nbsp;);
}
</pre>

#### <a name="3"></a> Determine Level from Element Elevation

The resulting levels are stored and passed into the method used to determine each element's level name as follows:

Initially, we check the element's `LevelId` property.

If it returns a valid element id, we can retrieve the level name from that.

Otherwise, we make use of the element's `Z` elevation and the sorted list of all levels.

Since the levels are already sorted by elevation, can can simply loop through them from the bottom up and break as soon as the target `Z` elevation is reached.

<pre class="code">
<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;</span><span style="color:gray;">summary</span><span style="color:gray;">&gt;</span>
<span style="color:gray;">///</span><span style="color:green;">&nbsp;Return&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;level&nbsp;of&nbsp;the&nbsp;given&nbsp;element.</span>
<span style="color:gray;">///</span><span style="color:green;">&nbsp;</span><span style="color:gray;">&lt;/</span><span style="color:gray;">summary</span><span style="color:gray;">&gt;</span>
<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:blue;">string</span>&nbsp;GetLevelName(
&nbsp;&nbsp;<span style="color:#2b91af;">Element</span>&nbsp;e,
&nbsp;&nbsp;<span style="color:blue;">double</span>&nbsp;z,
&nbsp;&nbsp;<span style="color:#2b91af;">IOrderedEnumerable</span>&lt;<span style="color:#2b91af;">Level</span>&gt;&nbsp;levels&nbsp;)
{
&nbsp;&nbsp;<span style="color:#2b91af;">Level</span>&nbsp;level&nbsp;=&nbsp;<span style="color:blue;">null</span>;
 
&nbsp;&nbsp;<span style="color:green;">//&nbsp;Retrieve&nbsp;the&nbsp;element&#39;s&nbsp;Level&nbsp;property:</span>
 
&nbsp;&nbsp;<span style="color:#2b91af;">ElementId</span>&nbsp;lid&nbsp;=&nbsp;e.LevelId;
 
&nbsp;&nbsp;<span style="color:blue;">if</span>(&nbsp;<span style="color:blue;">null</span>&nbsp;==&nbsp;lid
&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;<span style="color:#2b91af;">ElementId</span>.InvalidElementId&nbsp;==&nbsp;lid&nbsp;)
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;If&nbsp;no&nbsp;level&nbsp;is&nbsp;defined,&nbsp;grab&nbsp;the&nbsp;first</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;one&nbsp;from&nbsp;the&nbsp;list&nbsp;sorted&nbsp;by&nbsp;elevation:</span>
 
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">foreach</span>(&nbsp;<span style="color:#2b91af;">Level</span>&nbsp;l&nbsp;<span style="color:blue;">in</span>&nbsp;levels&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">double</span>&nbsp;elev&nbsp;=&nbsp;l.Elevation;
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>(&nbsp;<span style="color:#2b91af;">Util</span>.IsEqual(&nbsp;z,&nbsp;elev&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||&nbsp;z&nbsp;&lt;=&nbsp;l.Elevation&nbsp;)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;level&nbsp;=&nbsp;l;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">break</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;}
&nbsp;&nbsp;<span style="color:blue;">else</span>
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af;">Document</span>&nbsp;doc&nbsp;=&nbsp;e.Document;
&nbsp;&nbsp;&nbsp;&nbsp;level&nbsp;=&nbsp;doc.GetElement(&nbsp;lid&nbsp;)&nbsp;<span style="color:blue;">as</span>&nbsp;<span style="color:#2b91af;">Level</span>;
&nbsp;&nbsp;}
&nbsp;&nbsp;<span style="color:blue;">return</span>&nbsp;level.Name;
}
</pre>


#### <a name="4"></a> Carl Bass and Zoox Autonomous Vehicles

Moving away from the Revit API to Autodesk, and from Autodesk to technological trends and possibilities:

Have you ever wondered what the ex-Autodesk-CEO Carl Bass is up to now?

He is involved in an exciting new project documented in the 12-minute documentary video
on [Titan vs Robo-car &ndash; The Multi-Billion Dollar Company You’ve Never Heard Of](https://youtu.be/GW9cbFYnKAc):

> Titan travels to Zoox to meet with Chairman Carl Bass and discuss their incredible self-driving car.

> Not only do they have the artificial intelligence (AI) to autonomously drive the car through the streets of San Francisco, they are manufacturing their own vehicle to compete with the biggest names in ride-sharing.

> CNC machining, Advanced 3D printing, and 7-Axis robots to name a few of their production capabilities.

> Check out how their technology works, and why it is the future of driving. 

<center>
<iframe width="480" height="270" src="https://www.youtube.com/embed/GW9cbFYnKAc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>


#### <a name="5"></a> Physical Reasons to be Happy to be Alive

One step further, from technology to physics and philosophy:

The 12-minute video
on [The Mystery at the Bottom of Physics](https://youtu.be/EH-z9gE2uGY) dives
deep enough into physics to wax philosophical on gratitude for life and the reason to be grateful and happy for every moment of my own personal existence:

<center>
<iframe width="480" height="270" src="https://www.youtube.com/embed/EH-z9gE2uGY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>

