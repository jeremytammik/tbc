<p><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="bc.css"></p>
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js" type="text/javascript"></script>
<p></head></p>
<!---


twitter:

 @AutodeskRevit  #RevitAPI  #BIM @AutodeskAPS 

&ndash; 
...

linkedin:


#bim #DynamoBim #AutodeskAPS #Revit #API #IFC #SDK #AI #VisualStudio #Autodesk #AEC #adsk

the [Revit API discussion forum](http://forums.autodesk.com/t5/revit-api-forum/bd-p/160) thread

<center>
<img src="img/" alt="" title="" width="600" height=""/>
<p style="font-size: 80%; font-style:italic"></p>
</center>

<pre class="code">
</pre>

-->

<h3>Dark Theme Possibility Looming</h3>
<p>Happy New Year of the Rabbit, xīnnián hǎo, 新年好!</p>
<p><center>
<img src="img/2023_year_of_the_rabbit_1.jpg" alt="Happy New Year of the Rabbit!" title="Happy New Year of the Rabbit!" width="400"/> <!-- 800 × 514 pixels -->
</center></p>
<p>The Spring Festival is coming up this weekend, starting on Sunday, January 22, celebrating 
the <a href="https://en.wikipedia.org/wiki/Chinese_New_Year">Chinese New Year</a> and 
another <a href="https://en.wikipedia.org/wiki/Rabbit_(zodiac)">Year of the Rabbit</a>.</p>
<p>In the lunar calendar, 2023 is a Water Rabbit Year.
The sign of the Rabbit is a symbol of longevity, peace, and prosperity in Chinese culture.
2023 is predicted to be a year of hope, especially after the long pandemic period.
Wishing all of us lots of health, energy and happiness in the new year!</p>
<h4><a name="2"></a> Dark Theme Possibility Looming</h4>
<p>We recently announced internal thoughts on possibly switching the</p>
<p>In a similar vein, here is another</p>
<p>PLease not the important safe harbor statement:</p>
<blockquote>
<p>Roadmaps are plans, not promises.
We’re as excited as you to see new functionality make it into the products, but the development, releases, and timing of any features or functionality remains at our sole discretion.
These updates should not be used to make purchasing decisions.</p>
</blockquote>
<p>So, the possibility that I would like to present today concers supporting Dark Theme in Revit add-ins:</p>
<h4><a name="2.1"></a> Dark Theme Switching</h4>
<p>Setting the UI Active Theme will switch the appearance of the Ribbon between light gray and dark blue, with three options:</p>
<ul>
<li>Light</li>
<li>Dark </li>
<li>Use system setting
&ndash; Windows supports light and dark color schemes.
If you choose this option, Revit will use the Windows color scheme and switch to a matching theme accordingly.</li>
</ul>
<p>Light:</p>
<p><center>
<img src="img/dark_theme_2.png" alt="Dark theme &ndash; light" title="Dark theme &ndash; light" width="624"/> <!-- 624 × 162 pixels -->
</center></p>
<p>Dark:</p>
<p><center>
<img src="img/dark_theme_3.png" alt="Dark theme &ndash; dark" title="Dark theme &ndash; dark" width="624"/> <!-- 624 × 160 pixels -->
</center></p>
<p>The UI Active Theme options can define other colour settings to override the default settings:</p>
<p><center>
<img src="img/dark_theme_1.png" alt="Dark theme" title="Dark theme" width="584"/> <!-- 584 × 692 pixels -->
</center></p>
<h4><a name="2.2"></a> Dark Theme API Information</h4>
<p>New properties and events may be added for dark theme support:</p>
<ul>
<li>ThemeChangedEventArgs &ndash; Arguments for the ThemeChanged event</li>
<li>UIThemeManager.CurrentTheme &ndash; Allows you to set /get the overall theme for the Revit session</li>
<li>UIThemeManager.FollowSystemColorTheme &ndash; Allows you to set /get if the overall theme follows operating system color theme </li>
<li>UIThemeManager.CurrentCanvasTheme &ndash; Allows you to set/get a canvas theme for the current Revit session (as opposed to the default theme)</li>
<li>ColorOption &ndash; Allows you to set/get the colors in the current canvas theme</li>
</ul>
<h4><a name="2.3"></a> Dark Theme Add-In Considerations</h4>
<p>Here are examples of the default dark theme ribbon background and button colour settings:</p>
<p>Light ribbon background:</p>
<p><center>
<img src="img/dark_theme_4.png" alt="Dark theme &ndash; light ribbon background" title="Dark theme &ndash; light ribbon background" width="508"/> <!-- 508 × 160 pixels -->
</center></p>
<p>Dark ribbon background:</p>
<p><center>
<img src="img/dark_theme_5.png" alt="Dark theme &ndash; light ribbon background" title="Dark theme &ndash; light ribbon background" width="496"/> <!-- 496 × 160 pixels -->
</center></p>
<p>Light ribbon buttons:</p>
<p><center>
<img src="img/dark_theme_6.png" alt="Dark theme &ndash; light ribbon button" title="Dark theme &ndash; light ribbon button" width="1430"/> <!-- 1430 × 415 pixels -->
</center></p>
<p>Dark ribbon buttons:</p>
<p><center>
<img src="img/dark_theme_7.png" alt="Dark theme &ndash; dark ribbon button" title="Dark theme &ndash; dark ribbon button" width="1430"/> <!-- 1430 × 394 pixels -->
</center></p>
<ul>
<li>Size: small button &ndash; 16x16px, large button &ndash; 32x32px</li>
<li>Resolution: 96 DPI</li>
<li>Icons</li>
</ul>
<h4><a name="2.4"></a> Code Example: Handling Themed Ribbon Icons</h4>
<p>internal class TestRibbon : IExternalApplication
{
    private PushButton m_ribbonBtn;
    public Result OnStartup(UIControlledApplication application)
    {
        var ribbonPanel = application.CreateRibbonPanel("33900745-04F5-4CC2-9BAC-3230716E3A54", "Test");
        var buttonData = new PushButtonData("Test", "Test", typeof(CmdEntry).Assembly.Location, typeof(CmdEntry).FullName);
        buttonData.AvailabilityClassName = typeof(CmdEntry).FullName;
        m_ribbonBtn = ribbonPanel.AddItem(buttonData) as PushButton;
        updateImageByTheme();
        application.ThemeChanged += ThemeChanged;
        return Result.Succeeded;
    }
    private void setButtonImage(string pic, string largePic)
    {
        var assemblyLocation = typeof(TestRibbon).Assembly.Location;
        var assemblyDirectory = Path.GetDirectoryName(assemblyLocation);
        var imagePath = Path.Combine(assemblyDirectory, pic);
        var largeImagePath = Path.Combine(assemblyDirectory, largePic);
        if (File.Exists(imagePath))
            m_ribbonBtn.Image = new System.Windows.Media.Imaging.BitmapImage(new Uri(imagePath));
        if (File.Exists(largeImagePath))
            m_ribbonBtn.LargeImage = new System.Windows.Media.Imaging.BitmapImage(new Uri(largeImagePath));
    }
    private void updateImageByTheme()
    {
        UITheme theme = UIThemeManager.CurrentTheme;
        switch (theme)
        {
            case UITheme.Dark:
                setButtonImage("dark.png", "darkLarge.png");
                break;
            case UITheme.Light:
                setButtonImage("light.png", "lightLarge.png");
                break;
        }
    }
    private void ThemeChanged(object sender, Autodesk.Revit.UI.Events.ThemeChangedEventArgs e)
    {
        updateImageByTheme();
    }
}</p>
<div style="border: #000080 1px solid; color: #000; font-family: 'Cascadia Mono', Consolas, 'Courier New', Courier, Monospace; font-size: 10pt">
<div style="background: #000080; color: #fff; font-family: Verdana, Tahoma, Arial, sans-serif; font-weight: bold; padding: 2px 5px">Code Snippet</div>
<div style="background: #f3f3f3; color: #000000; max-height: 300px; overflow: auto">
<ol start="18" style="background: #ffffff; margin: 0 0 0 3em; padding: 0;">
<li><span style="color:#0000ff">internal</span> <span style="color:#0000ff">class</span> <span style="color:#2b91af">TestRibbon</span> : IExternalApplication</li>
<li style="background: #f3f3f3">{</li>
<li>&#160; <span style="color:#0000ff">private</span> PushButton m_ribbonBtn;</li>
<li style="background: #f3f3f3">&#160; <span style="color:#0000ff">public</span> Result OnStartup(UIControlledApplication application)</li>
<li>&#160; {</li>
<li style="background: #f3f3f3">&#160;&#160;&#160; <span style="color:#0000ff">var</span> ribbonPanel = application.CreateRibbonPanel(<span style="color:#a31515">&quot;33900745-04F5-4CC2-9BAC-3230716E3A54&quot;</span>, <span style="color:#a31515">&quot;Test&quot;</span>);</li>
<li>&#160;&#160;&#160; <span style="color:#0000ff">var</span> buttonData = <span style="color:#0000ff">new</span> PushButtonData(<span style="color:#a31515">&quot;Test&quot;</span>, <span style="color:#a31515">&quot;Test&quot;</span>, <span style="color:#0000ff">typeof</span>(CmdEntry).Assembly.Location, <span style="color:#0000ff">typeof</span>(CmdEntry).FullName);</li>
<li style="background: #f3f3f3">&#160;&#160;&#160; buttonData.AvailabilityClassName = <span style="color:#0000ff">typeof</span>(CmdEntry).FullName;</li>
<li>&#160;&#160;&#160; m_ribbonBtn = ribbonPanel.AddItem(buttonData) <span style="color:#0000ff">as</span> PushButton;</li>
<li style="background: #f3f3f3">&#160;&#160;&#160; updateImageByTheme();</li>
<li>&#160;&#160;&#160; application.ThemeChanged += ThemeChanged;</li>
<li style="background: #f3f3f3">&#160;&#160;&#160; <span style="color:#0000ff">return</span> Result.Succeeded;</li>
<li>&#160; }</li>
<li style="background: #f3f3f3">&#160; <span style="color:#0000ff">private</span> <span style="color:#0000ff">void</span> setButtonImage(<span style="color:#0000ff">string</span> pic, <span style="color:#0000ff">string</span> largePic)</li>
<li>&#160; {</li>
<li style="background: #f3f3f3">&#160;&#160;&#160; <span style="color:#0000ff">var</span> assemblyLocation = <span style="color:#0000ff">typeof</span>(TestRibbon).Assembly.Location;</li>
<li>&#160;&#160;&#160; <span style="color:#0000ff">var</span> assemblyDirectory = Path.GetDirectoryName(assemblyLocation);</li>
<li style="background: #f3f3f3">&#160;&#160;&#160; <span style="color:#0000ff">var</span> imagePath = Path.Combine(assemblyDirectory, pic);</li>
<li>&#160;&#160;&#160; <span style="color:#0000ff">var</span> largeImagePath = Path.Combine(assemblyDirectory, largePic);</li>
<li style="background: #f3f3f3">&#160;&#160;&#160; <span style="color:#0000ff">if</span> (File.Exists(imagePath))</li>
<li>&#160;&#160;&#160;&#160;&#160; m_ribbonBtn.Image = <span style="color:#0000ff">new</span> System.Windows.Media.Imaging.BitmapImage(<span style="color:#0000ff">new</span> Uri(imagePath));</li>
<li style="background: #f3f3f3">&#160;&#160;&#160; <span style="color:#0000ff">if</span> (File.Exists(largeImagePath))</li>
<li>&#160;&#160;&#160;&#160;&#160; m_ribbonBtn.LargeImage = <span style="color:#0000ff">new</span> System.Windows.Media.Imaging.BitmapImage(<span style="color:#0000ff">new</span> Uri(largeImagePath));</li>
<li style="background: #f3f3f3">&#160; }</li>
<li>&#160; <span style="color:#0000ff">private</span> <span style="color:#0000ff">void</span> updateImageByTheme()</li>
<li style="background: #f3f3f3">&#160; {</li>
<li>&#160;&#160;&#160; UITheme theme = UIThemeManager.CurrentTheme;</li>
<li style="background: #f3f3f3">&#160;&#160;&#160; <span style="color:#0000ff">switch</span> (theme)</li>
<li>&#160;&#160;&#160; {</li>
<li style="background: #f3f3f3">&#160;&#160;&#160;&#160;&#160; <span style="color:#0000ff">case</span> UITheme.Dark:</li>
<li>&#160;&#160;&#160;&#160;&#160;&#160;&#160; setButtonImage(<span style="color:#a31515">&quot;dark.png&quot;</span>, <span style="color:#a31515">&quot;darkLarge.png&quot;</span>);</li>
<li style="background: #f3f3f3">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color:#0000ff">break</span>;</li>
<li>&#160;&#160;&#160;&#160;&#160; <span style="color:#0000ff">case</span> UITheme.Light:</li>
<li style="background: #f3f3f3">&#160;&#160;&#160;&#160;&#160;&#160;&#160; setButtonImage(<span style="color:#a31515">&quot;light.png&quot;</span>, <span style="color:#a31515">&quot;lightLarge.png&quot;</span>);</li>
<li>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color:#0000ff">break</span>;</li>
<li style="background: #f3f3f3">&#160;&#160;&#160; }</li>
<li>&#160; }</li>
<li style="background: #f3f3f3">&#160; <span style="color:#0000ff">private</span> <span style="color:#0000ff">void</span> ThemeChanged(<span style="color:#0000ff">object</span> sender, Autodesk.Revit.UI.Events.ThemeChangedEventArgs e)</li>
<li>&#160; {</li>
<li style="background: #f3f3f3">&#160;&#160;&#160; updateImageByTheme();</li>
<li>&#160; }</li>
<li style="background: #f3f3f3">}</li>
</ol>
</div>
</div>

<h4><a name="2.5"></a> Dark Theme Additional Notes</h4>
<p>Please note that only the 1st level UI supports the dark theme option.</p>
<h4><a name="3"></a></h4>
<h4><a name="4"></a></h4>
<p><strong>Question:</strong> </p>
<p><strong>Answer:</strong> </p>
<p><strong>Response:</strong> </p>